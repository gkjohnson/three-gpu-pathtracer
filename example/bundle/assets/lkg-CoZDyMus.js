import"./modulepreload-polyfill-B5Qt9EMX.js";import{b as vs,V as Ar,aR as fr,a1 as ws,a2 as Ht,aO as pr,m as mr,l as gs,at as ys,au as bs,av as Es,G as xs,E as Ss,aG as _s,X as Ms,aF as Rs,M as Cs,A as Ts,ah as Fs,ai as Ps,a0 as Ds,h as Is}from"./MaterialBase-byhyp4gt.js";import{H as Ls}from"./HDRLoader-uXUM045B.js";import{L as Bs,a as Os}from"./LDrawUtils-D5m1mivQ.js";import{g as Gs}from"./lil-gui.module.min-BH_YJbPT.js";import{S as ks}from"./stats.module--VATS4Kh.js";import{g as Vs}from"./__vite-browser-external-C8XJ56jx.js";import{F as Gi,P as Ns}from"./pcg.glsl-Dh-2-BlJ.js";import{O as Us}from"./OrbitControls-BDTesZS8.js";import{a as Ws,P as zs}from"./PathTracingRenderer-N-9Lxrjr.js";import{c as ki,g as Qs}from"./_commonjsHelpers-Cpj98o6Y.js";import"./BufferGeometryUtils-DMgFFDwZ.js";import"./ggx_functions.glsl-BPuHaSoe.js";class Xs extends vs{constructor(e){super({depthWrite:!1,blending:fr,uniforms:{quiltMap:{value:null},quiltDimensions:{value:new Ar},displayIndex:{value:0},aspectRatio:{value:1},heightScale:{value:.75}},vertexShader:`

				varying vec2 vUv;
				void main() {

					vec4 mvPosition = vec4( position, 1.0 );
					mvPosition = modelViewMatrix * mvPosition;
					gl_Position = projectionMatrix * mvPosition;

					vUv = uv;

				}

			`,fragmentShader:`

				varying vec2 vUv;
				uniform sampler2D quiltMap;
				uniform ivec2 quiltDimensions;
				uniform int displayIndex;
				uniform float aspectRatio;
				uniform float heightScale;

				void main() {

					vec2 tileUv = vUv;
					tileUv.x -= ( 1.0 - aspectRatio * heightScale ) * 0.5;
					tileUv.x /= aspectRatio;

					tileUv.y -= ( 1.0 - heightScale ) * 0.5;
					tileUv /= heightScale;

					if ( tileUv.x < 0.0 || tileUv.x > 1.0 || tileUv.y < 0.0 || tileUv.y > 1.0 ) {

						gl_FragColor = vec4( 0.05, 0.05, 0.05, 1.0 );
						return;

					}

					ivec2 size = textureSize( quiltMap, 0 );
					vec2 texelWidth = 1.0 / vec2( size );
					vec2 tileTexelHalfWidth = 0.5 * vec2( quiltDimensions ) * texelWidth;
					tileUv = max( tileTexelHalfWidth, min( 1.0 - tileTexelHalfWidth, tileUv ) );

					ivec2 tileIndex = ivec2( 0 );
					tileIndex.x = displayIndex % quiltDimensions.x;
					tileIndex.y = ( displayIndex - tileIndex.x ) / quiltDimensions.x;

					vec2 tileWidth = 1.0 / vec2( quiltDimensions );
					vec2 quiltUv = tileWidth * ( vec2( tileIndex ) + tileUv );

					gl_FragColor = texture( quiltMap, quiltUv );

					#include <tonemapping_fragment>
					#include <colorspace_fragment>

				}

			`}),this.setValues(e)}}function*Hs(i){const{viewCount:e,_camera:t,_quiltUtility:n,_subframe:l}=this,c={subframe:l,projectionMatrix:t.projectionMatrix,offsetDirection:new mr};for(;;){for(let d=0;d<e;d++){n.near=this.camera.near,n.far=this.camera.far,n.getCameraViewInfo(d,c),c.offsetDirection.transformDirection(this.camera.matrixWorld),this.camera.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.position.addScaledVector(c.offsetDirection,c.offset),t.updateMatrixWorld(),t.projectionMatrixInverse.copy(t.projectionMatrix).invert(),this._opacityFactor=Math.floor(this._samples+1)/Math.floor(this._quiltSamples+1);do{const A=this.camera;this.camera=t,i(),this.camera=A,yield}while(this._samples%1!==0);this._quiltSamples+=1/e}this._quiltSamples=Math.round(this._quiltSamples)}}class qs{constructor(){this.viewCount=48,this.quiltDimensions=new Ar(8,6),this.viewCone=35*Ht.DEG2RAD,this.viewFoV=14*Ht.DEG2RAD,this.displayDistance=1,this.displayAspect=.75,this.near=.01,this.far=10}getCameraViewInfo(e,t={}){const{quiltDimensions:n,viewCone:l,displayDistance:c,viewCount:d,viewFoV:A,displayAspect:m,near:f,far:w}=this;t.subframe=t.subframe||new pr,t.offsetDirection=t.offsetDirection||new mr,t.projectionMatrix=t.projectionMatrix||new gs;const E=Math.tan(.5*l)*c,_=E*2/(d-1),O=d===1?0:-E+_*e;t.offsetDirection.set(1,0,0),t.offset=O;const C=Math.tan(A*.5)*c,g=m*C,M=f/c;t.projectionMatrix.makePerspective(M*(-g-O),M*(g-O),M*C,M*-C,f,w);const P=e%n.x,T=Math.floor(e/n.x),B=1/n.x,V=1/n.y;return t.subframe.set(P*B,T*V,B,V),t}setFromDisplayView(e,t,n){this.displayAspect=t/n,this.displayDistance=e,this.viewFoV=2*Math.atan(.5*n/e)}}class Ys extends Ws{get samples(){return this._samples/this.viewCount}constructor(...e){super(...e),["quiltDimensions","viewCount","viewCone","viewFoV","displayDistance","displayAspect"].forEach(t=>{Object.defineProperty(this,t,{enumerable:!0,set:n=>{this._quiltUtility[t]=n},get:()=>this._quiltUtility[t]})}),this._quiltUtility=new qs,this._quiltSamples=0,this._camera=new ws,this._quiltTask=null}setFromDisplayView(...e){this._quiltUtility.setFromDisplayView(...e)}update(){this.alpha=!1,this._quiltTask||(this._quiltTask=Hs.call(this,()=>{super.update()})),this._quiltTask.next()}reset(){super.reset(),this._quiltTask=null,this._quiltSamples=0}}const Et=Symbol("@@webxr-polyfill/EventTarget");let Si=class{constructor(){this[Et]={listeners:new Map}}addEventListener(e,t){if(typeof e!="string")throw new Error("`type` must be a string");if(typeof t!="function")throw new Error("`listener` must be a function");const n=this[Et].listeners.get(e)||[];n.push(t),this[Et].listeners.set(e,n)}removeEventListener(e,t){if(typeof e!="string")throw new Error("`type` must be a string");if(typeof t!="function")throw new Error("`listener` must be a function");const n=this[Et].listeners.get(e)||[];for(let l=n.length;l>=0;l--)n[l]===t&&n.pop()}dispatchEvent(e,t){const n=this[Et].listeners.get(e)||[],l=[];for(let c=0;c<n.length;c++)l[c]=n[c];for(let c of l)c(t);typeof this[`on${e}`]=="function"&&this[`on${e}`](t)}};const js=1e-6;let xe=typeof Float32Array<"u"?Float32Array:Array;function et(){let i=new xe(16);return xe!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i}function Ks(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function rt(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function qt(i,e){let t=e[0],n=e[1],l=e[2],c=e[3],d=e[4],A=e[5],m=e[6],f=e[7],w=e[8],E=e[9],D=e[10],_=e[11],O=e[12],C=e[13],g=e[14],M=e[15],P=t*A-n*d,T=t*m-l*d,B=t*f-c*d,V=n*m-l*A,k=n*f-c*A,W=l*f-c*m,Q=w*C-E*O,J=w*g-D*O,$=w*M-_*O,I=E*g-D*C,G=E*M-_*C,L=D*M-_*g,S=P*L-T*G+B*I+V*$-k*J+W*Q;return S?(S=1/S,i[0]=(A*L-m*G+f*I)*S,i[1]=(l*G-n*L-c*I)*S,i[2]=(C*W-g*k+M*V)*S,i[3]=(D*k-E*W-_*V)*S,i[4]=(m*$-d*L-f*J)*S,i[5]=(t*L-l*$+c*J)*S,i[6]=(g*B-O*W-M*T)*S,i[7]=(w*W-D*B+_*T)*S,i[8]=(d*G-A*$+f*Q)*S,i[9]=(n*$-t*G-c*Q)*S,i[10]=(O*k-C*B+M*P)*S,i[11]=(E*B-w*k-_*P)*S,i[12]=(A*J-d*I-m*Q)*S,i[13]=(t*I-n*J+l*Q)*S,i[14]=(C*T-O*V-g*P)*S,i[15]=(w*V-E*T+D*P)*S,i):null}function st(i,e,t){let n=e[0],l=e[1],c=e[2],d=e[3],A=e[4],m=e[5],f=e[6],w=e[7],E=e[8],D=e[9],_=e[10],O=e[11],C=e[12],g=e[13],M=e[14],P=e[15],T=t[0],B=t[1],V=t[2],k=t[3];return i[0]=T*n+B*A+V*E+k*C,i[1]=T*l+B*m+V*D+k*g,i[2]=T*c+B*f+V*_+k*M,i[3]=T*d+B*w+V*O+k*P,T=t[4],B=t[5],V=t[6],k=t[7],i[4]=T*n+B*A+V*E+k*C,i[5]=T*l+B*m+V*D+k*g,i[6]=T*c+B*f+V*_+k*M,i[7]=T*d+B*w+V*O+k*P,T=t[8],B=t[9],V=t[10],k=t[11],i[8]=T*n+B*A+V*E+k*C,i[9]=T*l+B*m+V*D+k*g,i[10]=T*c+B*f+V*_+k*M,i[11]=T*d+B*w+V*O+k*P,T=t[12],B=t[13],V=t[14],k=t[15],i[12]=T*n+B*A+V*E+k*C,i[13]=T*l+B*m+V*D+k*g,i[14]=T*c+B*f+V*_+k*M,i[15]=T*d+B*w+V*O+k*P,i}function It(i,e,t){let n=e[0],l=e[1],c=e[2],d=e[3],A=n+n,m=l+l,f=c+c,w=n*A,E=n*m,D=n*f,_=l*m,O=l*f,C=c*f,g=d*A,M=d*m,P=d*f;return i[0]=1-(_+C),i[1]=E+P,i[2]=D-M,i[3]=0,i[4]=E-P,i[5]=1-(w+C),i[6]=O+g,i[7]=0,i[8]=D+M,i[9]=O-g,i[10]=1-(w+_),i[11]=0,i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=1,i}function vr(i,e){return i[0]=e[12],i[1]=e[13],i[2]=e[14],i}function wr(i,e){let t=e[0]+e[5]+e[10],n=0;return t>0?(n=Math.sqrt(t+1)*2,i[3]=.25*n,i[0]=(e[6]-e[9])/n,i[1]=(e[8]-e[2])/n,i[2]=(e[1]-e[4])/n):e[0]>e[5]&&e[0]>e[10]?(n=Math.sqrt(1+e[0]-e[5]-e[10])*2,i[3]=(e[6]-e[9])/n,i[0]=.25*n,i[1]=(e[1]+e[4])/n,i[2]=(e[8]+e[2])/n):e[5]>e[10]?(n=Math.sqrt(1+e[5]-e[0]-e[10])*2,i[3]=(e[8]-e[2])/n,i[0]=(e[1]+e[4])/n,i[1]=.25*n,i[2]=(e[6]+e[9])/n):(n=Math.sqrt(1+e[10]-e[0]-e[5])*2,i[3]=(e[1]-e[4])/n,i[0]=(e[8]+e[2])/n,i[1]=(e[6]+e[9])/n,i[2]=.25*n),i}function gr(i,e,t,n,l){let c=1/Math.tan(e/2),d;return i[0]=c/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=c,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(d=1/(n-l),i[10]=(l+n)*d,i[14]=2*l*n*d):(i[10]=-1,i[14]=-2*n),i}function We(){let i=new xe(3);return xe!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function Vi(i){var e=new xe(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e}function Zs(i){let e=i[0],t=i[1],n=i[2];return Math.sqrt(e*e+t*t+n*n)}function Be(i,e,t){let n=new xe(3);return n[0]=i,n[1]=e,n[2]=t,n}function Ni(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i}function xt(i,e,t){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i}function Ui(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i}function mi(i,e){let t=e[0],n=e[1],l=e[2],c=t*t+n*n+l*l;return c>0&&(c=1/Math.sqrt(c),i[0]=e[0]*c,i[1]=e[1]*c,i[2]=e[2]*c),i}function _i(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function oi(i,e,t){let n=e[0],l=e[1],c=e[2],d=t[0],A=t[1],m=t[2];return i[0]=l*m-c*A,i[1]=c*d-n*m,i[2]=n*A-l*d,i}function tt(i,e,t){let n=t[0],l=t[1],c=t[2],d=t[3],A=e[0],m=e[1],f=e[2],w=l*f-c*m,E=c*A-n*f,D=n*m-l*A,_=l*D-c*E,O=c*w-n*D,C=n*E-l*w,g=d*2;return w*=g,E*=g,D*=g,_*=2,O*=2,C*=2,i[0]=A+w+_,i[1]=m+E+O,i[2]=f+D+C,i}function $s(i,e){let t=Be(i[0],i[1],i[2]),n=Be(e[0],e[1],e[2]);mi(t,t),mi(n,n);let l=_i(t,n);return l>1?0:l<-1?Math.PI:Math.acos(l)}const Js=Zs;(function(){let i=We();return function(e,t,n,l,c,d){let A,m;for(t||(t=3),n||(n=0),l?m=Math.min(l*t+n,e.length):m=e.length,A=n;A<m;A+=t)i[0]=e[A],i[1]=e[A+1],i[2]=e[A+2],c(i,i,d),e[A]=i[0],e[A+1]=i[1],e[A+2]=i[2];return e}})();function en(){let i=new xe(9);return xe!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function tn(){let i=new xe(4);return xe!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function rn(i){let e=new xe(4);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function sn(i,e,t,n){let l=new xe(4);return l[0]=i,l[1]=e,l[2]=t,l[3]=n,l}function nn(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function an(i,e){let t=e[0],n=e[1],l=e[2],c=e[3],d=t*t+n*n+l*l+c*c;return d>0&&(d=1/Math.sqrt(d),i[0]=t*d,i[1]=n*d,i[2]=l*d,i[3]=c*d),i}(function(){let i=tn();return function(e,t,n,l,c,d){let A,m;for(t||(t=4),n||(n=0),l?m=Math.min(l*t+n,e.length):m=e.length,A=n;A<m;A+=t)i[0]=e[A],i[1]=e[A+1],i[2]=e[A+2],i[3]=e[A+3],c(i,i,d),e[A]=i[0],e[A+1]=i[1],e[A+2]=i[2],e[A+3]=i[3];return e}})();function Ie(){let i=new xe(4);return xe!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function on(i,e,t){t=t*.5;let n=Math.sin(t);return i[0]=n*e[0],i[1]=n*e[1],i[2]=n*e[2],i[3]=Math.cos(t),i}function Wi(i,e,t){let n=e[0],l=e[1],c=e[2],d=e[3],A=t[0],m=t[1],f=t[2],w=t[3];return i[0]=n*w+d*A+l*f-c*m,i[1]=l*w+d*m+c*A-n*f,i[2]=c*w+d*f+n*m-l*A,i[3]=d*w-n*A-l*m-c*f,i}function Ft(i,e,t,n){let l=e[0],c=e[1],d=e[2],A=e[3],m=t[0],f=t[1],w=t[2],E=t[3],D,_,O,C,g;return _=l*m+c*f+d*w+A*E,_<0&&(_=-_,m=-m,f=-f,w=-w,E=-E),1-_>js?(D=Math.acos(_),O=Math.sin(D),C=Math.sin((1-n)*D)/O,g=Math.sin(n*D)/O):(C=1-n,g=n),i[0]=C*l+g*m,i[1]=C*c+g*f,i[2]=C*d+g*w,i[3]=C*A+g*E,i}function zi(i,e){let t=e[0],n=e[1],l=e[2],c=e[3],d=t*t+n*n+l*l+c*c,A=d?1/d:0;return i[0]=-t*A,i[1]=-n*A,i[2]=-l*A,i[3]=c*A,i}function ln(i,e){let t=e[0]+e[4]+e[8],n;if(t>0)n=Math.sqrt(t+1),i[3]=.5*n,n=.5/n,i[0]=(e[5]-e[7])*n,i[1]=(e[6]-e[2])*n,i[2]=(e[1]-e[3])*n;else{let l=0;e[4]>e[0]&&(l=1),e[8]>e[l*3+l]&&(l=2);let c=(l+1)%3,d=(l+2)%3;n=Math.sqrt(e[l*3+l]-e[c*3+c]-e[d*3+d]+1),i[l]=.5*n,n=.5/n,i[3]=(e[c*3+d]-e[d*3+c])*n,i[c]=(e[c*3+l]+e[l*3+c])*n,i[d]=(e[d*3+l]+e[l*3+d])*n}return i}function cn(i,e,t,n){let l=.5*Math.PI/180;e*=l,t*=l,n*=l;let c=Math.sin(e),d=Math.cos(e),A=Math.sin(t),m=Math.cos(t),f=Math.sin(n),w=Math.cos(n);return i[0]=c*m*w-d*A*f,i[1]=d*A*w+c*m*f,i[2]=d*m*f-c*A*w,i[3]=d*m*w+c*A*f,i}const Qi=rn,hn=sn,li=nn,Yt=an;(function(){let i=We(),e=Be(1,0,0),t=Be(0,1,0);return function(n,l,c){let d=_i(l,c);return d<-.999999?(oi(i,e,l),Js(i)<1e-6&&oi(i,t,l),mi(i,i),on(n,i,Math.PI),n):d>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(oi(i,l,c),n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=1+d,Yt(n,n))}})();(function(){let i=Ie(),e=Ie();return function(t,n,l,c,d,A){return Ft(i,n,d,A),Ft(e,l,c,A),Ft(t,i,e,2*A*(1-A)),t}})();(function(){let i=en();return function(e,t,n,l){return i[0]=n[0],i[3]=n[1],i[6]=n[2],i[1]=l[0],i[4]=l[1],i[7]=l[2],i[2]=-t[0],i[5]=-t[1],i[8]=-t[2],Yt(e,ln(e,i))}})();const te=Symbol("@@webxr-polyfill/XRRigidTransform");let yr=class br{constructor(){if(this[te]={matrix:null,position:null,orientation:null,inverse:null},arguments.length===0)this[te].matrix=rt(new Float32Array(16));else if(arguments.length===1)arguments[0]instanceof Float32Array?this[te].matrix=arguments[0]:(this[te].position=this._getPoint(arguments[0]),this[te].orientation=DOMPointReadOnly.fromPoint({x:0,y:0,z:0,w:1}));else if(arguments.length===2)this[te].position=this._getPoint(arguments[0]),this[te].orientation=this._getPoint(arguments[1]);else throw new Error("Too many arguments!");if(this[te].matrix){let e=We();vr(e,this[te].matrix),this[te].position=DOMPointReadOnly.fromPoint({x:e[0],y:e[1],z:e[2]});let t=Ie();wr(t,this[te].matrix),this[te].orientation=DOMPointReadOnly.fromPoint({x:t[0],y:t[1],z:t[2],w:t[3]})}else this[te].matrix=rt(new Float32Array(16)),It(this[te].matrix,hn(this[te].orientation.x,this[te].orientation.y,this[te].orientation.z,this[te].orientation.w),Be(this[te].position.x,this[te].position.y,this[te].position.z))}_getPoint(e){return e instanceof DOMPointReadOnly?e:DOMPointReadOnly.fromPoint(e)}get matrix(){return this[te].matrix}get position(){return this[te].position}get orientation(){return this[te].orientation}get inverse(){if(this[te].inverse===null){let e=rt(new Float32Array(16));qt(e,this[te].matrix),this[te].inverse=new br(e),this[te].inverse[te].inverse=this}return this[te].inverse}};const ce=Symbol("@@webxr-polyfill/XRSpace");class nt{constructor(e=null,t=null){this[ce]={specialType:e,inputSource:t,baseMatrix:null,inverseBaseMatrix:null,lastFrameId:-1}}get _specialType(){return this[ce].specialType}get _inputSource(){return this[ce].inputSource}_ensurePoseUpdated(e,t){t!=this[ce].lastFrameId&&(this[ce].lastFrameId=t,this._onPoseUpdate(e))}_onPoseUpdate(e){this[ce].specialType=="viewer"&&(this._baseMatrix=e.getBasePoseMatrix())}set _baseMatrix(e){this[ce].baseMatrix=e,this[ce].inverseBaseMatrix=null}get _baseMatrix(){return this[ce].baseMatrix||this[ce].inverseBaseMatrix&&(this[ce].baseMatrix=new Float32Array(16),qt(this[ce].baseMatrix,this[ce].inverseBaseMatrix)),this[ce].baseMatrix}set _inverseBaseMatrix(e){this[ce].inverseBaseMatrix=e,this[ce].baseMatrix=null}get _inverseBaseMatrix(){return this[ce].inverseBaseMatrix||this[ce].baseMatrix&&(this[ce].inverseBaseMatrix=new Float32Array(16),qt(this[ce].inverseBaseMatrix,this[ce].baseMatrix)),this[ce].inverseBaseMatrix}_getSpaceRelativeTransform(e){if(!this._inverseBaseMatrix||!e._baseMatrix)return null;let t=new Float32Array(16);return st(t,this._inverseBaseMatrix,e._baseMatrix),new yr(t)}}const dn=1.6,Qe=Symbol("@@webxr-polyfill/XRReferenceSpace"),jt=["viewer","local","local-floor","bounded-floor","unbounded"];function un(i){return i==="bounded-floor"||i==="local-floor"}class Lt extends nt{constructor(e,t=null){if(!jt.includes(e))throw new Error(`XRReferenceSpaceType must be one of ${jt}`);if(super(e),e==="bounded-floor"&&!t)throw new Error("XRReferenceSpace cannot use 'bounded-floor' type if the platform does not provide the floor level");un(e)&&!t&&(t=rt(new Float32Array(16)),t[13]=dn),this._inverseBaseMatrix=t||rt(new Float32Array(16)),this[Qe]={type:e,transform:t,originOffset:rt(new Float32Array(16))}}_transformBasePoseMatrix(e,t){st(e,this._inverseBaseMatrix,t)}_originOffsetMatrix(){return this[Qe].originOffset}_adjustForOriginOffset(e){let t=new Float32Array(16);qt(t,this[Qe].originOffset),st(e,t,e)}_getSpaceRelativeTransform(e){let t=super._getSpaceRelativeTransform(e);return this._adjustForOriginOffset(t.matrix),new XRRigidTransform(t.matrix)}getOffsetReferenceSpace(e){let t=new Lt(this[Qe].type,this[Qe].transform,this[Qe].bounds);return st(t[Qe].originOffset,this[Qe].originOffset,e.matrix),t}}const be=Symbol("@@webxr-polyfill/XR"),An=["inline","immersive-vr","immersive-ar"],fn={inline:{requiredFeatures:["viewer"],optionalFeatures:[]},"immersive-vr":{requiredFeatures:["viewer","local"],optionalFeatures:[]},"immersive-ar":{requiredFeatures:["viewer","local"],optionalFeatures:[]}},pn=`Polyfill Error: Must call navigator.xr.isSessionSupported() with any XRSessionMode
or navigator.xr.requestSession('inline') prior to requesting an immersive
session. This is a limitation specific to the WebXR Polyfill and does not apply
to native implementations of the API.`;class Er extends Si{constructor(e){super(),this[be]={device:null,devicePromise:e,immersiveSession:null,inlineSessions:new Set},e.then(t=>{this[be].device=t})}async isSessionSupported(e){return this[be].device||await this[be].devicePromise,e!="inline"?Promise.resolve(this[be].device.isSessionSupported(e)):Promise.resolve(!0)}async requestSession(e,t){if(!this[be].device){if(e!="inline")throw new Error(pn);await this[be].devicePromise}if(!An.includes(e))throw new TypeError(`The provided value '${e}' is not a valid enum value of type XRSessionMode`);const n=fn[e],l=n.requiredFeatures.concat(t&&t.requiredFeatures?t.requiredFeatures:[]),c=n.optionalFeatures.concat(t&&t.optionalFeatures?t.optionalFeatures:[]),d=new Set;let A=!1;for(let E of l)this[be].device.isFeatureSupported(E)?d.add(E):(console.error(`The required feature '${E}' is not supported`),A=!0);if(A)throw new DOMException("Session does not support some required features","NotSupportedError");for(let E of c)this[be].device.isFeatureSupported(E)?d.add(E):console.log(`The optional feature '${E}' is not supported`);const m=await this[be].device.requestSession(e,d),f=new XRSession(this[be].device,e,m);e=="inline"?this[be].inlineSessions.add(f):this[be].immersiveSession=f;const w=()=>{e=="inline"?this[be].inlineSessions.delete(f):this[be].immersiveSession=null,f.removeEventListener("end",w)};return f.addEventListener("end",w),f}}const xr=typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{};let vi;if("performance"in xr)vi=()=>performance.now();else{let i=Date.now();vi=()=>Date.now()-i}const Sr=vi,ci=Symbol("@@webxr-polyfill/XRPose");let _r=class{constructor(e,t){this[ci]={transform:e,emulatedPosition:t}}get transform(){return this[ci].transform}get emulatedPosition(){return this[ci].emulatedPosition}};const Xi=Symbol("@@webxr-polyfill/XRViewerPose");class Mr extends _r{constructor(e,t,n=!1){super(e,n),this[Xi]={views:t}}get views(){return this[Xi].views}}const St=Symbol("@@webxr-polyfill/XRViewport");class Rr{constructor(e){this[St]={target:e}}get x(){return this[St].target.x}get y(){return this[St].target.y}get width(){return this[St].target.width}get height(){return this[St].target.height}}const Hi=["left","right","none"],Ve=Symbol("@@webxr-polyfill/XRView");class Cr{constructor(e,t,n,l,c){if(!Hi.includes(n))throw new Error(`XREye must be one of: ${Hi}`);const d=Object.create(null),A=new Rr(d);this[Ve]={device:e,eye:n,viewport:A,temp:d,sessionId:l,transform:t,viewIndex:c}}get eye(){return this[Ve].eye}get projectionMatrix(){return this[Ve].device.getProjectionMatrix(this.eye,this[Ve].viewIndex)}get transform(){return this[Ve].transform}_getViewport(e){if(this[Ve].device.getViewport(this[Ve].sessionId,this.eye,e,this[Ve].temp,this[Ve].viewIndex))return this[Ve].viewport}}const fe=Symbol("@@webxr-polyfill/XRFrame"),qi="XRFrame access outside the callback that produced it is invalid.",mn="getViewerPose can only be called on XRFrame objects passed to XRSession.requestAnimationFrame callbacks.";let vn=0;class wi{constructor(e,t,n){this[fe]={id:++vn,active:!1,animationFrame:!1,device:e,session:t,sessionId:n}}get session(){return this[fe].session}getViewerPose(e){if(!this[fe].animationFrame)throw new DOMException(mn,"InvalidStateError");if(!this[fe].active)throw new DOMException(qi,"InvalidStateError");const t=this[fe].device,n=this[fe].session;n[b].viewerSpace._ensurePoseUpdated(t,this[fe].id),e._ensurePoseUpdated(t,this[fe].id);let l=e._getSpaceRelativeTransform(n[b].viewerSpace);const c=[];for(const A of n[b].viewSpaces){A._ensurePoseUpdated(t,this[fe].id);let m=e._getSpaceRelativeTransform(A),f=new Cr(t,m,A.eye,this[fe].sessionId,A.viewIndex);c.push(f)}return new Mr(l,c,!1)}getPose(e,t){if(!this[fe].active)throw new DOMException(qi,"InvalidStateError");const n=this[fe].device;if(e._specialType==="target-ray"||e._specialType==="grip")return n.getInputPose(e._inputSource,t,e._specialType);{e._ensurePoseUpdated(n,this[fe].id),t._ensurePoseUpdated(n,this[fe].id);let l=t._getSpaceRelativeTransform(e);return l?new XRPose(l,!1):null}}}const _t=Symbol("@@webxr-polyfill/XRRenderState"),wn=Object.freeze({depthNear:.1,depthFar:1e3,inlineVerticalFieldOfView:null,baseLayer:null});class gi{constructor(e={}){const t=Object.assign({},wn,e);this[_t]={config:t}}get depthNear(){return this[_t].config.depthNear}get depthFar(){return this[_t].config.depthFar}get inlineVerticalFieldOfView(){return this[_t].config.inlineVerticalFieldOfView}get baseLayer(){return this[_t].config.baseLayer}}const hi=Symbol("@@webxr-polyfill/XRInputSourceEvent");class Zt extends Event{constructor(e,t){super(e,t),this[hi]={frame:t.frame,inputSource:t.inputSource},Object.setPrototypeOf(this,Zt.prototype)}get frame(){return this[hi].frame}get inputSource(){return this[hi].inputSource}}const Yi=Symbol("@@webxr-polyfill/XRSessionEvent");class Bt extends Event{constructor(e,t){super(e,t),this[Yi]={session:t.session},Object.setPrototypeOf(this,Bt.prototype)}get session(){return this[Yi].session}}const Ut=Symbol("@@webxr-polyfill/XRInputSourcesChangeEvent");class $t extends Event{constructor(e,t){super(e,t),this[Ut]={session:t.session,added:t.added,removed:t.removed},Object.setPrototypeOf(this,$t.prototype)}get session(){return this[Ut].session}get added(){return this[Ut].added}get removed(){return this[Ut].removed}}const b=Symbol("@@webxr-polyfill/XRSession");class di extends nt{constructor(e){super(e)}get eye(){return this._specialType}_onPoseUpdate(e){this._inverseBaseMatrix=e.getBaseViewMatrix(this._specialType)}}let Tr=class extends Si{constructor(e,t,n){super();let l=t!="inline",c=new gi({inlineVerticalFieldOfView:l?null:Math.PI*.5});const d=l?[new di("left"),new di("right")]:[new di("none")];Object.freeze(d),this[b]={device:e,mode:t,immersive:l,ended:!1,suspended:!1,frameCallbacks:[],currentFrameCallbacks:null,frameHandle:0,deviceFrameHandle:null,id:n,activeRenderState:c,pendingRenderState:null,viewerSpace:new Lt("viewer"),get viewSpaces(){return e.getViewSpaces(t)||d},currentInputSources:[]},this[b].onDeviceFrame=()=>{if(this[b].ended||this[b].suspended||(this[b].deviceFrameHandle=null,this[b].startDeviceFrameLoop(),this[b].pendingRenderState!==null&&(this[b].activeRenderState=new gi(this[b].pendingRenderState),this[b].pendingRenderState=null,this[b].activeRenderState.baseLayer&&this[b].device.onBaseLayerSet(this[b].id,this[b].activeRenderState.baseLayer)),this[b].activeRenderState.baseLayer===null))return;const A=new wi(e,this,this[b].id),m=this[b].currentFrameCallbacks=this[b].frameCallbacks;this[b].frameCallbacks=[],A[fe].active=!0,A[fe].animationFrame=!0,this[b].device.onFrameStart(this[b].id,this[b].activeRenderState),this._checkInputSourcesChange();const f=Sr();for(let w=0;w<m.length;w++)try{!m[w].cancelled&&typeof m[w].callback=="function"&&m[w].callback(f,A)}catch(E){console.error(E)}this[b].currentFrameCallbacks=null,A[fe].active=!1,this[b].device.onFrameEnd(this[b].id)},this[b].startDeviceFrameLoop=()=>{this[b].deviceFrameHandle===null&&(this[b].deviceFrameHandle=this[b].device.requestAnimationFrame(this[b].onDeviceFrame))},this[b].stopDeviceFrameLoop=()=>{const A=this[b].deviceFrameHandle;A!==null&&(this[b].device.cancelAnimationFrame(A),this[b].deviceFrameHandle=null)},this[b].onPresentationEnd=A=>{if(A!==this[b].id){this[b].suspended=!1,this[b].startDeviceFrameLoop(),this.dispatchEvent("focus",{session:this});return}this[b].ended=!0,this[b].stopDeviceFrameLoop(),e.removeEventListener("@@webxr-polyfill/vr-present-end",this[b].onPresentationEnd),e.removeEventListener("@@webxr-polyfill/vr-present-start",this[b].onPresentationStart),e.removeEventListener("@@webxr-polyfill/input-select-start",this[b].onSelectStart),e.removeEventListener("@@webxr-polyfill/input-select-end",this[b].onSelectEnd),this.dispatchEvent("end",new Bt("end",{session:this}))},e.addEventListener("@@webxr-polyfill/vr-present-end",this[b].onPresentationEnd),this[b].onPresentationStart=A=>{A!==this[b].id&&(this[b].suspended=!0,this[b].stopDeviceFrameLoop(),this.dispatchEvent("blur",{session:this}))},e.addEventListener("@@webxr-polyfill/vr-present-start",this[b].onPresentationStart),this[b].onSelectStart=A=>{A.sessionId===this[b].id&&this[b].dispatchInputSourceEvent("selectstart",A.inputSource)},e.addEventListener("@@webxr-polyfill/input-select-start",this[b].onSelectStart),this[b].onSelectEnd=A=>{A.sessionId===this[b].id&&(this[b].dispatchInputSourceEvent("selectend",A.inputSource),this[b].dispatchInputSourceEvent("select",A.inputSource))},e.addEventListener("@@webxr-polyfill/input-select-end",this[b].onSelectEnd),this[b].onSqueezeStart=A=>{A.sessionId===this[b].id&&this[b].dispatchInputSourceEvent("squeezestart",A.inputSource)},e.addEventListener("@@webxr-polyfill/input-squeeze-start",this[b].onSqueezeStart),this[b].onSqueezeEnd=A=>{A.sessionId===this[b].id&&(this[b].dispatchInputSourceEvent("squeezeend",A.inputSource),this[b].dispatchInputSourceEvent("squeeze",A.inputSource))},e.addEventListener("@@webxr-polyfill/input-squeeze-end",this[b].onSqueezeEnd),this[b].dispatchInputSourceEvent=(A,m)=>{const f=new wi(e,this,this[b].id),w=new Zt(A,{frame:f,inputSource:m});f[fe].active=!0,this.dispatchEvent(A,w),f[fe].active=!1},this[b].startDeviceFrameLoop(),this.onblur=void 0,this.onfocus=void 0,this.onresetpose=void 0,this.onend=void 0,this.onselect=void 0,this.onselectstart=void 0,this.onselectend=void 0}get renderState(){return this[b].activeRenderState}get environmentBlendMode(){return this[b].device.environmentBlendMode||"opaque"}async requestReferenceSpace(e){if(this[b].ended)return;if(!jt.includes(e))throw new TypeError(`XRReferenceSpaceType must be one of ${jt}`);if(!this[b].device.doesSessionSupportReferenceSpace(this[b].id,e))throw new DOMException(`The ${e} reference space is not supported by this session.`,"NotSupportedError");if(e==="viewer")return this[b].viewerSpace;let t=await this[b].device.requestFrameOfReferenceTransform(e);if(e==="bounded-floor")throw t?this[b].device.requestStageBounds()?new DOMException(`The WebXR polyfill does not support the ${e} reference space yet.`,"NotSupportedError"):new DOMException(`${e} XRReferenceSpace not supported by this device.`,"NotSupportedError"):new DOMException(`${e} XRReferenceSpace not supported by this device.`,"NotSupportedError");return new Lt(e,t)}requestAnimationFrame(e){if(this[b].ended)return;const t=++this[b].frameHandle;return this[b].frameCallbacks.push({handle:t,callback:e,cancelled:!1}),t}cancelAnimationFrame(e){let t=this[b].frameCallbacks,n=t.findIndex(l=>l&&l.handle===e);n>-1&&(t[n].cancelled=!0,t.splice(n,1)),t=this[b].currentFrameCallbacks,t&&(n=t.findIndex(l=>l&&l.handle===e),n>-1&&(t[n].cancelled=!0))}get inputSources(){return this[b].device.getInputSources()}async end(){if(!this[b].ended)return this[b].immersive&&(this[b].ended=!0,this[b].device.removeEventListener("@@webxr-polyfill/vr-present-start",this[b].onPresentationStart),this[b].device.removeEventListener("@@webxr-polyfill/vr-present-end",this[b].onPresentationEnd),this[b].device.removeEventListener("@@webxr-polyfill/input-select-start",this[b].onSelectStart),this[b].device.removeEventListener("@@webxr-polyfill/input-select-end",this[b].onSelectEnd),this.dispatchEvent("end",new Bt("end",{session:this}))),this[b].stopDeviceFrameLoop(),this[b].device.endSession(this[b].id)}updateRenderState(e){if(this[b].ended){const n="Can't call updateRenderState on an XRSession that has already ended.";throw new Error(n)}if(e.baseLayer&&e.baseLayer._session!==this){const n="Called updateRenderState with a base layer that was created by a different session.";throw new Error(n)}if(e.inlineVerticalFieldOfView!==null&&e.inlineVerticalFieldOfView!==void 0)if(this[b].immersive){const n="inlineVerticalFieldOfView must not be set for an XRRenderState passed to updateRenderState for an immersive session.";throw new Error(n)}else e.inlineVerticalFieldOfView=Math.min(3.13,Math.max(.01,e.inlineVerticalFieldOfView));if(this[b].pendingRenderState===null){const n=this[b].activeRenderState;this[b].pendingRenderState={depthNear:n.depthNear,depthFar:n.depthFar,inlineVerticalFieldOfView:n.inlineVerticalFieldOfView,baseLayer:n.baseLayer}}Object.assign(this[b].pendingRenderState,e)}_checkInputSourcesChange(){const e=[],t=[],n=this.inputSources,l=this[b].currentInputSources;for(const c of n)l.includes(c)||e.push(c);for(const c of l)n.includes(c)||t.push(c);(e.length>0||t.length>0)&&this.dispatchEvent("inputsourceschange",new $t("inputsourceschange",{session:this,added:e,removed:t})),this[b].currentInputSources.length=0;for(const c of n)this[b].currentInputSources.push(c)}};const Xe=Symbol("@@webxr-polyfill/XRInputSource");class Fr{constructor(e){this[Xe]={impl:e,gripSpace:new nt("grip",this),targetRaySpace:new nt("target-ray",this)}}get handedness(){return this[Xe].impl.handedness}get targetRayMode(){return this[Xe].impl.targetRayMode}get gripSpace(){let e=this[Xe].impl.targetRayMode;return e==="gaze"||e==="screen"?null:this[Xe].gripSpace}get targetRaySpace(){return this[Xe].targetRaySpace}get profiles(){return this[Xe].impl.profiles}get gamepad(){return this[Xe].impl.gamepad}}const Pr=Symbol("@@webxr-polyfill/polyfilled-xr-compatible"),Mi=Symbol("@@webxr-polyfill/xr-compatible"),Je=Symbol("@@webxr-polyfill/XRWebGLLayer"),gn=Object.freeze({antialias:!0,depth:!0,stencil:!1,alpha:!0,multiview:!1,ignoreDepthValues:!1,framebufferScaleFactor:1});class Dr{constructor(e,t,n={}){const l=Object.assign({},gn,n);if(!(e instanceof Tr))throw new Error("session must be a XRSession");if(e.ended)throw new Error("InvalidStateError");if(t[Pr]&&t[Mi]!==!0)throw new Error("InvalidStateError");this[Je]={context:t,config:l,session:e}}get context(){return this[Je].context}get antialias(){return this[Je].config.antialias}get ignoreDepthValues(){return!0}get framebuffer(){return null}get framebufferWidth(){return this[Je].context.drawingBufferWidth}get framebufferHeight(){return this[Je].context.drawingBufferHeight}get _session(){return this[Je].session}getViewport(e){return e._getViewport(this)}static getNativeFramebufferScaleFactor(e){if(!e)throw new TypeError("getNativeFramebufferScaleFactor must be passed a session.");return e[b].ended?0:1}}const ui=Symbol("@@webxr-polyfill/XRReferenceSpaceEvent");class Ri extends Event{constructor(e,t){super(e,t),this[ui]={referenceSpace:t.referenceSpace,transform:t.transform||null},Object.setPrototypeOf(this,Ri.prototype)}get referenceSpace(){return this[ui].referenceSpace}get transform(){return this[ui].transform}}const Pt={XRSystem:Er,XRSession:Tr,XRSessionEvent:Bt,XRFrame:wi,XRView:Cr,XRViewport:Rr,XRViewerPose:Mr,XRWebGLLayer:Dr,XRSpace:nt,XRReferenceSpace:Lt,XRReferenceSpaceEvent:Ri,XRInputSource:Fr,XRInputSourceEvent:Zt,XRInputSourcesChangeEvent:$t,XRRenderState:gi,XRRigidTransform:yr,XRPose:_r},ji=i=>(i.prototype.makeXRCompatible,i.prototype.makeXRCompatible=function(){return this[Mi]=!0,Promise.resolve()},!0),Ki=i=>{const e=i.prototype.getContext;i.prototype.getContext=function(t,n){const l=e.call(this,t,n);return l&&(l[Pr]=!0,n&&"xrCompatible"in n&&(l[Mi]=n.xrCompatible)),l}},yn=i=>!!(i.ImageBitmapRenderingContext&&i.createImageBitmap),bn=i=>{var e=!1;return(function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)})(i.navigator.userAgent||i.navigator.vendor||i.opera),e},En=i=>{i.style.display="block",i.style.position="absolute",i.style.width=i.style.height="1px",i.style.top=i.style.left="0px"};var Qt={exports:{}};/**
 * @license
 * cardboard-vr-display
 * Copyright (c) 2015-2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var xn=Qt.exports,Zi;function Sn(){return Zi||(Zi=1,(function(i,e){/**
 * @license
 * gl-preserve-state
 * Copyright (c) 2016, Brandon Jones.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *//**
 * @license
 * webvr-polyfill-dpdb
 * Copyright (c) 2015-2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * nosleep.js
 * Copyright (c) 2017, Rich Tibbett
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */(function(t,n){i.exports=n()})(xn,(function(){var t=function(r,s){if(!(r instanceof s))throw new TypeError("Cannot call a class as a function")},n=(function(){function r(s,a){for(var o=0;o<a.length;o++){var h=a[o];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(s,h.key,h)}}return function(s,a,o){return a&&r(s.prototype,a),o&&r(s,o),s}})(),l=(function(){function r(s,a){var o=[],h=!0,u=!1,p=void 0;try{for(var R=s[Symbol.iterator](),x;!(h=(x=R.next()).done)&&(o.push(x.value),!(a&&o.length===a));h=!0);}catch(v){u=!0,p=v}finally{try{!h&&R.return&&R.return()}finally{if(u)throw p}}return o}return function(s,a){if(Array.isArray(s))return s;if(Symbol.iterator in Object(s))return r(s,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}})(),c=.001,d=1,A=function(s,a){return"data:"+s+","+encodeURIComponent(a)},m=function(s,a,o){return s+(a-s)*o},f=(function(){var r=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return r}})(),w=(function(){var r=navigator.userAgent.indexOf("Version")!==-1&&navigator.userAgent.indexOf("Android")!==-1&&navigator.userAgent.indexOf("Chrome")!==-1;return function(){return r}})(),E=(function(){var r=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return r}})(),D=(function(){var r=navigator.userAgent.indexOf("Firefox")!==-1&&navigator.userAgent.indexOf("Android")!==-1;return function(){return r}})(),_=(function(){var r=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),s=r?parseInt(r[1],10):null;return function(){return s}})(),O=(function(){var r=!1;return r=f()&&E()&&navigator.userAgent.indexOf("13_4")!==-1,function(){return r}})(),C=(function(){var r=!1;if(_()===65){var s=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(s){var a=s[1].split("."),o=l(a,4);o[0],o[1];var h=o[2],u=o[3];r=parseInt(h,10)===3325&&parseInt(u,10)<148}}return function(){return r}})(),g=(function(){var r=navigator.userAgent.indexOf("R7 Build")!==-1;return function(){return r}})(),M=function(){var s=window.orientation==90||window.orientation==-90;return g()?!s:s},P=function(s){return!(isNaN(s)||s<=c||s>d)},T=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},B=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},V=function(s){if(w())return!1;if(s.requestFullscreen)s.requestFullscreen();else if(s.webkitRequestFullscreen)s.webkitRequestFullscreen();else if(s.mozRequestFullScreen)s.mozRequestFullScreen();else if(s.msRequestFullscreen)s.msRequestFullscreen();else return!1;return!0},k=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else return!1;return!0},W=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},Q=function(s,a,o,h){var u=s.createShader(s.VERTEX_SHADER);s.shaderSource(u,a),s.compileShader(u);var p=s.createShader(s.FRAGMENT_SHADER);s.shaderSource(p,o),s.compileShader(p);var R=s.createProgram();s.attachShader(R,u),s.attachShader(R,p);for(var x in h)s.bindAttribLocation(R,h[x],x);return s.linkProgram(R),s.deleteShader(u),s.deleteShader(p),R},J=function(s,a){for(var o={},h=s.getProgramParameter(a,s.ACTIVE_UNIFORMS),u="",p=0;p<h;p++){var R=s.getActiveUniform(a,p);u=R.name.replace("[0]",""),o[u]=s.getUniformLocation(a,u)}return o},$=function(s,a,o,h,u,p,R){var x=1/(a-o),v=1/(h-u),y=1/(p-R);return s[0]=-2*x,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*v,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*y,s[11]=0,s[12]=(a+o)*x,s[13]=(u+h)*v,s[14]=(R+p)*y,s[15]=1,s},I=function(){var s=!1;return(function(a){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))&&(s=!0)})(navigator.userAgent||navigator.vendor||window.opera),s},G=function(s,a){for(var o in a)a.hasOwnProperty(o)&&(s[o]=a[o]);return s},L=function(s){if(f()){var a=s.style.width,o=s.style.height;s.style.width=parseInt(a)+1+"px",s.style.height=parseInt(o)+"px",setTimeout(function(){s.style.width=a,s.style.height=o},100)}window.canvas=s},S=(function(){var r=Math.PI/180,s=Math.PI*.25;function a(v,y,F,N){var U=Math.tan(y?y.upDegrees*r:s),z=Math.tan(y?y.downDegrees*r:s),K=Math.tan(y?y.leftDegrees*r:s),q=Math.tan(y?y.rightDegrees*r:s),H=2/(K+q),ne=2/(U+z);return v[0]=H,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=ne,v[6]=0,v[7]=0,v[8]=-((K-q)*H*.5),v[9]=(U-z)*ne*.5,v[10]=N/(F-N),v[11]=-1,v[12]=0,v[13]=0,v[14]=N*F/(F-N),v[15]=0,v}function o(v,y,F){var N=y[0],U=y[1],z=y[2],K=y[3],q=N+N,H=U+U,ne=z+z,he=N*q,me=N*H,le=N*ne,we=U*H,Se=U*ne,_e=z*ne,Me=K*q,Re=K*H,ze=K*ne;return v[0]=1-(we+_e),v[1]=me+ze,v[2]=le-Re,v[3]=0,v[4]=me-ze,v[5]=1-(he+_e),v[6]=Se+Me,v[7]=0,v[8]=le+Re,v[9]=Se-Me,v[10]=1-(he+we),v[11]=0,v[12]=F[0],v[13]=F[1],v[14]=F[2],v[15]=1,v}function h(v,y,F){var N=F[0],U=F[1],z=F[2],K,q,H,ne,he,me,le,we,Se,_e,Me,Re;return y===v?(v[12]=y[0]*N+y[4]*U+y[8]*z+y[12],v[13]=y[1]*N+y[5]*U+y[9]*z+y[13],v[14]=y[2]*N+y[6]*U+y[10]*z+y[14],v[15]=y[3]*N+y[7]*U+y[11]*z+y[15]):(K=y[0],q=y[1],H=y[2],ne=y[3],he=y[4],me=y[5],le=y[6],we=y[7],Se=y[8],_e=y[9],Me=y[10],Re=y[11],v[0]=K,v[1]=q,v[2]=H,v[3]=ne,v[4]=he,v[5]=me,v[6]=le,v[7]=we,v[8]=Se,v[9]=_e,v[10]=Me,v[11]=Re,v[12]=K*N+he*U+Se*z+y[12],v[13]=q*N+me*U+_e*z+y[13],v[14]=H*N+le*U+Me*z+y[14],v[15]=ne*N+we*U+Re*z+y[15]),v}function u(v,y){var F=y[0],N=y[1],U=y[2],z=y[3],K=y[4],q=y[5],H=y[6],ne=y[7],he=y[8],me=y[9],le=y[10],we=y[11],Se=y[12],_e=y[13],Me=y[14],Re=y[15],ze=F*q-N*K,dt=F*H-U*K,ut=F*ne-z*K,At=N*H-U*q,ft=N*ne-z*q,pt=U*ne-z*H,mt=he*_e-me*Se,vt=he*Me-le*Se,wt=he*Re-we*Se,gt=me*Me-le*_e,yt=me*Re-we*_e,bt=le*Re-we*Me,Ae=ze*bt-dt*yt+ut*gt+At*wt-ft*vt+pt*mt;return Ae?(Ae=1/Ae,v[0]=(q*bt-H*yt+ne*gt)*Ae,v[1]=(U*yt-N*bt-z*gt)*Ae,v[2]=(_e*pt-Me*ft+Re*At)*Ae,v[3]=(le*ft-me*pt-we*At)*Ae,v[4]=(H*wt-K*bt-ne*vt)*Ae,v[5]=(F*bt-U*wt+z*vt)*Ae,v[6]=(Me*ut-Se*pt-Re*dt)*Ae,v[7]=(he*pt-le*ut+we*dt)*Ae,v[8]=(K*yt-q*wt+ne*mt)*Ae,v[9]=(N*wt-F*yt-z*mt)*Ae,v[10]=(Se*ft-_e*ut+Re*ze)*Ae,v[11]=(me*ut-he*ft-we*ze)*Ae,v[12]=(q*vt-K*gt-H*mt)*Ae,v[13]=(F*gt-N*vt+U*mt)*Ae,v[14]=(_e*dt-Se*At-Me*ze)*Ae,v[15]=(he*At-me*dt+le*ze)*Ae,v):null}var p=new Float32Array([0,0,0,1]),R=new Float32Array([0,0,0]);function x(v,y,F,N,U,z){a(v,N||null,z.depthNear,z.depthFar);var K=F.orientation||p,q=F.position||R;o(y,K,q),U&&h(y,y,U),u(y,y)}return function(v,y,F){return!v||!y?!1:(v.pose=y,v.timestamp=y.timestamp,x(v.leftProjectionMatrix,v.leftViewMatrix,y,F._getFieldOfView("left"),F._getEyeOffset("left"),F),x(v.rightProjectionMatrix,v.rightViewMatrix,y,F._getFieldOfView("right"),F._getEyeOffset("right"),F),!0)}})(),j=function(){var s=window.self!==window.top,a=X(document.referrer),o=X(window.location.href);return s&&a!==o},X=function(s){var a,o=s.indexOf("://");o!==-1?a=o+3:a=0;var h=s.indexOf("/",a);return h===-1&&(h=s.length),s.substring(0,h)},Z=function(s){if(s.w>1)return console.warn("getQuaternionAngle: w > 1"),0;var a=2*Math.acos(s.w);return a},se=(function(){var r={};return function(s,a){r[s]===void 0&&(console.warn("webvr-polyfill: "+a),r[s]=!0)}})(),pe=function(s,a){var o=a?"Please use "+a+" instead.":"";se(s,s+" has been deprecated. This may not work on native WebVR displays. "+o)};function Oe(r,s,a){if(!s){a(r);return}for(var o=[],h=null,u=0;u<s.length;++u){var p=s[u];switch(p){case r.TEXTURE_BINDING_2D:case r.TEXTURE_BINDING_CUBE_MAP:var R=s[++u];if(R<r.TEXTURE0||R>r.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),o.push(null,null);break}h||(h=r.getParameter(r.ACTIVE_TEXTURE)),r.activeTexture(R),o.push(r.getParameter(p),null);break;case r.ACTIVE_TEXTURE:h=r.getParameter(r.ACTIVE_TEXTURE),o.push(null);break;default:o.push(r.getParameter(p));break}}a(r);for(var u=0;u<s.length;++u){var p=s[u],x=o[u];switch(p){case r.ACTIVE_TEXTURE:break;case r.ARRAY_BUFFER_BINDING:r.bindBuffer(r.ARRAY_BUFFER,x);break;case r.COLOR_CLEAR_VALUE:r.clearColor(x[0],x[1],x[2],x[3]);break;case r.COLOR_WRITEMASK:r.colorMask(x[0],x[1],x[2],x[3]);break;case r.CURRENT_PROGRAM:r.useProgram(x);break;case r.ELEMENT_ARRAY_BUFFER_BINDING:r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,x);break;case r.FRAMEBUFFER_BINDING:r.bindFramebuffer(r.FRAMEBUFFER,x);break;case r.RENDERBUFFER_BINDING:r.bindRenderbuffer(r.RENDERBUFFER,x);break;case r.TEXTURE_BINDING_2D:var R=s[++u];if(R<r.TEXTURE0||R>r.TEXTURE31)break;r.activeTexture(R),r.bindTexture(r.TEXTURE_2D,x);break;case r.TEXTURE_BINDING_CUBE_MAP:var R=s[++u];if(R<r.TEXTURE0||R>r.TEXTURE31)break;r.activeTexture(R),r.bindTexture(r.TEXTURE_CUBE_MAP,x);break;case r.VIEWPORT:r.viewport(x[0],x[1],x[2],x[3]);break;case r.BLEND:case r.CULL_FACE:case r.DEPTH_TEST:case r.SCISSOR_TEST:case r.STENCIL_TEST:x?r.enable(p):r.disable(p);break;default:console.log("No GL restore behavior for 0x"+p.toString(16));break}h&&r.activeTexture(h)}}var Fe=Oe,Ye=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join(`
`),Ne=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join(`
`);function ve(r,s,a,o){this.gl=r,this.cardboardUI=s,this.bufferScale=a,this.dirtySubmitFrameBindings=o,this.ctxAttribs=r.getContextAttributes(),this.instanceExt=r.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=r.drawingBufferWidth,this.bufferHeight=r.drawingBufferHeight,this.realBindFramebuffer=r.bindFramebuffer,this.realEnable=r.enable,this.realDisable=r.disable,this.realColorMask=r.colorMask,this.realClearColor=r.clearColor,this.realViewport=r.viewport,f()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(r.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(r.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=Q(r,Ye,Ne,this.attribs),this.uniforms=J(r,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=r.createBuffer(),this.indexBuffer=r.createBuffer(),this.indexCount=0,this.renderTarget=r.createTexture(),this.framebuffer=r.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=r.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=r.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=r.createRenderbuffer()),this.patch(),this.onResize()}ve.prototype.destroy=function(){var r=this.gl;this.unpatch(),r.deleteProgram(this.program),r.deleteBuffer(this.vertexBuffer),r.deleteBuffer(this.indexBuffer),r.deleteTexture(this.renderTarget),r.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&r.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&r.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&r.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},ve.prototype.onResize=function(){var r=this.gl,s=this,a=[r.RENDERBUFFER_BINDING,r.TEXTURE_BINDING_2D,r.TEXTURE0];Fe(r,a,function(o){s.realBindFramebuffer.call(o,o.FRAMEBUFFER,null),s.scissorTest&&s.realDisable.call(o,o.SCISSOR_TEST),s.realColorMask.call(o,!0,!0,!0,!0),s.realViewport.call(o,0,0,o.drawingBufferWidth,o.drawingBufferHeight),s.realClearColor.call(o,0,0,0,1),o.clear(o.COLOR_BUFFER_BIT),s.realBindFramebuffer.call(o,o.FRAMEBUFFER,s.framebuffer),o.bindTexture(o.TEXTURE_2D,s.renderTarget),o.texImage2D(o.TEXTURE_2D,0,s.ctxAttribs.alpha?o.RGBA:o.RGB,s.bufferWidth,s.bufferHeight,0,s.ctxAttribs.alpha?o.RGBA:o.RGB,o.UNSIGNED_BYTE,null),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,s.renderTarget,0),s.ctxAttribs.depth&&s.ctxAttribs.stencil?(o.bindRenderbuffer(o.RENDERBUFFER,s.depthStencilBuffer),o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,s.bufferWidth,s.bufferHeight),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,s.depthStencilBuffer)):s.ctxAttribs.depth?(o.bindRenderbuffer(o.RENDERBUFFER,s.depthBuffer),o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_COMPONENT16,s.bufferWidth,s.bufferHeight),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,s.depthBuffer)):s.ctxAttribs.stencil&&(o.bindRenderbuffer(o.RENDERBUFFER,s.stencilBuffer),o.renderbufferStorage(o.RENDERBUFFER,o.STENCIL_INDEX8,s.bufferWidth,s.bufferHeight),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.STENCIL_ATTACHMENT,o.RENDERBUFFER,s.stencilBuffer)),!o.checkFramebufferStatus(o.FRAMEBUFFER)===o.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),s.realBindFramebuffer.call(o,o.FRAMEBUFFER,s.lastBoundFramebuffer),s.scissorTest&&s.realEnable.call(o,o.SCISSOR_TEST),s.realColorMask.apply(o,s.colorMask),s.realViewport.apply(o,s.viewport),s.realClearColor.apply(o,s.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},ve.prototype.patch=function(){if(!this.isPatched){var r=this,s=this.gl.canvas,a=this.gl;f()||(s.width=T()*this.bufferScale,s.height=B()*this.bufferScale,Object.defineProperty(s,"width",{configurable:!0,enumerable:!0,get:function(){return r.bufferWidth},set:function(h){r.bufferWidth=h,r.realCanvasWidth.set.call(s,h),r.onResize()}}),Object.defineProperty(s,"height",{configurable:!0,enumerable:!0,get:function(){return r.bufferHeight},set:function(h){r.bufferHeight=h,r.realCanvasHeight.set.call(s,h),r.onResize()}})),this.lastBoundFramebuffer=a.getParameter(a.FRAMEBUFFER_BINDING),this.lastBoundFramebuffer==null&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(a.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(o,h){r.lastBoundFramebuffer=h||r.framebuffer,r.realBindFramebuffer.call(a,o,r.lastBoundFramebuffer)},this.cullFace=a.getParameter(a.CULL_FACE),this.depthTest=a.getParameter(a.DEPTH_TEST),this.blend=a.getParameter(a.BLEND),this.scissorTest=a.getParameter(a.SCISSOR_TEST),this.stencilTest=a.getParameter(a.STENCIL_TEST),a.enable=function(o){switch(o){case a.CULL_FACE:r.cullFace=!0;break;case a.DEPTH_TEST:r.depthTest=!0;break;case a.BLEND:r.blend=!0;break;case a.SCISSOR_TEST:r.scissorTest=!0;break;case a.STENCIL_TEST:r.stencilTest=!0;break}r.realEnable.call(a,o)},a.disable=function(o){switch(o){case a.CULL_FACE:r.cullFace=!1;break;case a.DEPTH_TEST:r.depthTest=!1;break;case a.BLEND:r.blend=!1;break;case a.SCISSOR_TEST:r.scissorTest=!1;break;case a.STENCIL_TEST:r.stencilTest=!1;break}r.realDisable.call(a,o)},this.colorMask=a.getParameter(a.COLOR_WRITEMASK),a.colorMask=function(o,h,u,p){r.colorMask[0]=o,r.colorMask[1]=h,r.colorMask[2]=u,r.colorMask[3]=p,r.realColorMask.call(a,o,h,u,p)},this.clearColor=a.getParameter(a.COLOR_CLEAR_VALUE),a.clearColor=function(o,h,u,p){r.clearColor[0]=o,r.clearColor[1]=h,r.clearColor[2]=u,r.clearColor[3]=p,r.realClearColor.call(a,o,h,u,p)},this.viewport=a.getParameter(a.VIEWPORT),a.viewport=function(o,h,u,p){r.viewport[0]=o,r.viewport[1]=h,r.viewport[2]=u,r.viewport[3]=p,r.realViewport.call(a,o,h,u,p)},this.isPatched=!0,L(s)}},ve.prototype.unpatch=function(){if(this.isPatched){var r=this.gl,s=this.gl.canvas;f()||(Object.defineProperty(s,"width",this.realCanvasWidth),Object.defineProperty(s,"height",this.realCanvasHeight)),s.width=this.bufferWidth,s.height=this.bufferHeight,r.bindFramebuffer=this.realBindFramebuffer,r.enable=this.realEnable,r.disable=this.realDisable,r.colorMask=this.realColorMask,r.clearColor=this.realClearColor,r.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&r.bindFramebuffer(r.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){L(s)},1)}},ve.prototype.setTextureBounds=function(r,s){r||(r=[0,0,.5,1]),s||(s=[.5,0,.5,1]),this.viewportOffsetScale[0]=r[0],this.viewportOffsetScale[1]=r[1],this.viewportOffsetScale[2]=r[2],this.viewportOffsetScale[3]=r[3],this.viewportOffsetScale[4]=s[0],this.viewportOffsetScale[5]=s[1],this.viewportOffsetScale[6]=s[2],this.viewportOffsetScale[7]=s[3]},ve.prototype.submitFrame=function(){var r=this.gl,s=this,a=[];if(this.dirtySubmitFrameBindings||a.push(r.CURRENT_PROGRAM,r.ARRAY_BUFFER_BINDING,r.ELEMENT_ARRAY_BUFFER_BINDING,r.TEXTURE_BINDING_2D,r.TEXTURE0),Fe(r,a,function(h){s.realBindFramebuffer.call(h,h.FRAMEBUFFER,null);var u=0,p=0;s.instanceExt&&(u=h.getVertexAttrib(s.attribs.position,s.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),p=h.getVertexAttrib(s.attribs.texCoord,s.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),s.cullFace&&s.realDisable.call(h,h.CULL_FACE),s.depthTest&&s.realDisable.call(h,h.DEPTH_TEST),s.blend&&s.realDisable.call(h,h.BLEND),s.scissorTest&&s.realDisable.call(h,h.SCISSOR_TEST),s.stencilTest&&s.realDisable.call(h,h.STENCIL_TEST),s.realColorMask.call(h,!0,!0,!0,!0),s.realViewport.call(h,0,0,h.drawingBufferWidth,h.drawingBufferHeight),(s.ctxAttribs.alpha||f())&&(s.realClearColor.call(h,0,0,0,1),h.clear(h.COLOR_BUFFER_BIT)),h.useProgram(s.program),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s.indexBuffer),h.bindBuffer(h.ARRAY_BUFFER,s.vertexBuffer),h.enableVertexAttribArray(s.attribs.position),h.enableVertexAttribArray(s.attribs.texCoord),h.vertexAttribPointer(s.attribs.position,2,h.FLOAT,!1,20,0),h.vertexAttribPointer(s.attribs.texCoord,3,h.FLOAT,!1,20,8),s.instanceExt&&(u!=0&&s.instanceExt.vertexAttribDivisorANGLE(s.attribs.position,0),p!=0&&s.instanceExt.vertexAttribDivisorANGLE(s.attribs.texCoord,0)),h.activeTexture(h.TEXTURE0),h.uniform1i(s.uniforms.diffuse,0),h.bindTexture(h.TEXTURE_2D,s.renderTarget),h.uniform4fv(s.uniforms.viewportOffsetScale,s.viewportOffsetScale),h.drawElements(h.TRIANGLES,s.indexCount,h.UNSIGNED_SHORT,0),s.cardboardUI&&s.cardboardUI.renderNoState(),s.realBindFramebuffer.call(s.gl,h.FRAMEBUFFER,s.framebuffer),s.ctxAttribs.preserveDrawingBuffer||(s.realClearColor.call(h,0,0,0,0),h.clear(h.COLOR_BUFFER_BIT)),s.dirtySubmitFrameBindings||s.realBindFramebuffer.call(h,h.FRAMEBUFFER,s.lastBoundFramebuffer),s.cullFace&&s.realEnable.call(h,h.CULL_FACE),s.depthTest&&s.realEnable.call(h,h.DEPTH_TEST),s.blend&&s.realEnable.call(h,h.BLEND),s.scissorTest&&s.realEnable.call(h,h.SCISSOR_TEST),s.stencilTest&&s.realEnable.call(h,h.STENCIL_TEST),s.realColorMask.apply(h,s.colorMask),s.realViewport.apply(h,s.viewport),(s.ctxAttribs.alpha||!s.ctxAttribs.preserveDrawingBuffer)&&s.realClearColor.apply(h,s.clearColor),s.instanceExt&&(u!=0&&s.instanceExt.vertexAttribDivisorANGLE(s.attribs.position,u),p!=0&&s.instanceExt.vertexAttribDivisorANGLE(s.attribs.texCoord,p))}),f()){var o=r.canvas;(o.width!=s.bufferWidth||o.height!=s.bufferHeight)&&(s.bufferWidth=o.width,s.bufferHeight=o.height,s.onResize())}},ve.prototype.updateDeviceInfo=function(r){var s=this.gl,a=this,o=[s.ARRAY_BUFFER_BINDING,s.ELEMENT_ARRAY_BUFFER_BINDING];Fe(s,o,function(h){var u=a.computeMeshVertices_(a.meshWidth,a.meshHeight,r);if(h.bindBuffer(h.ARRAY_BUFFER,a.vertexBuffer),h.bufferData(h.ARRAY_BUFFER,u,h.STATIC_DRAW),!a.indexCount){var p=a.computeMeshIndices_(a.meshWidth,a.meshHeight);h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,a.indexBuffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,p,h.STATIC_DRAW),a.indexCount=p.length}})},ve.prototype.computeMeshVertices_=function(r,s,a){for(var o=new Float32Array(2*r*s*5),h=a.getLeftEyeVisibleTanAngles(),u=a.getLeftEyeNoLensTanAngles(),p=a.getLeftEyeVisibleScreenRect(u),R=0,x=0;x<2;x++){for(var v=0;v<s;v++)for(var y=0;y<r;y++,R++){var F=y/(r-1),N=v/(s-1),U=F,z=N,K=m(h[0],h[2],F),q=m(h[3],h[1],N),H=Math.sqrt(K*K+q*q),ne=a.distortion.distortInverse(H),he=K*ne/H,me=q*ne/H;F=(he-u[0])/(u[2]-u[0]),N=(me-u[3])/(u[1]-u[3]),F=(p.x+F*p.width-.5)*2,N=(p.y+N*p.height-.5)*2,o[R*5+0]=F,o[R*5+1]=N,o[R*5+2]=U,o[R*5+3]=z,o[R*5+4]=x}var le=h[2]-h[0];h[0]=-(le+h[0]),h[2]=le-h[2],le=u[2]-u[0],u[0]=-(le+u[0]),u[2]=le-u[2],p.x=1-(p.x+p.width)}return o},ve.prototype.computeMeshIndices_=function(r,s){for(var a=new Uint16Array(2*(r-1)*(s-1)*6),o=r/2,h=s/2,u=0,p=0,R=0;R<2;R++)for(var x=0;x<s;x++)for(var v=0;v<r;v++,u++)v==0||x==0||(v<=o==x<=h?(a[p++]=u,a[p++]=u-r-1,a[p++]=u-r,a[p++]=u-r-1,a[p++]=u,a[p++]=u-1):(a[p++]=u-1,a[p++]=u-r,a[p++]=u,a[p++]=u-r,a[p++]=u-1,a[p++]=u-r-1));return a},ve.prototype.getOwnPropertyDescriptor_=function(r,s){var a=Object.getOwnPropertyDescriptor(r,s);return(a.get===void 0||a.set===void 0)&&(a.configurable=!0,a.enumerable=!0,a.get=function(){return this.getAttribute(s)},a.set=function(o){this.setAttribute(s,o)}),a};var ot=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join(`
`),ei=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join(`
`),Gt=Math.PI/180,lt=60,kt=12,Pi=20,ti=1,Di=.75,Ii=.3125,Qr=4,je=28,ii=1.5;function Ke(r){this.gl=r,this.attribs={position:0},this.program=Q(r,ot,ei,this.attribs),this.uniforms=J(r,this.program),this.vertexBuffer=r.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}Ke.prototype.destroy=function(){var r=this.gl;this.listener&&r.canvas.removeEventListener("click",this.listener,!1),r.deleteProgram(this.program),r.deleteBuffer(this.vertexBuffer)},Ke.prototype.listen=function(r,s){var a=this.gl.canvas;this.listener=function(o){var h=a.clientWidth/2,u=je*ii;o.clientX>h-u&&o.clientX<h+u&&o.clientY>a.clientHeight-u?r(o):o.clientX<u&&o.clientY<u&&s(o)},a.addEventListener("click",this.listener,!1)},Ke.prototype.onResize=function(){var r=this.gl,s=this,a=[r.ARRAY_BUFFER_BINDING];Fe(r,a,function(o){var h=[],u=o.drawingBufferWidth/2,p=Math.max(screen.width,screen.height)*window.devicePixelRatio,R=o.drawingBufferWidth/p,x=R*window.devicePixelRatio,v=Qr*x/2,y=je*ii*x,F=je*x/2,N=(je*ii-je)*x;h.push(u-v,y),h.push(u-v,o.drawingBufferHeight),h.push(u+v,y),h.push(u+v,o.drawingBufferHeight),s.gearOffset=h.length/2;function U(ne,he){var me=(90-ne)*Gt,le=Math.cos(me),we=Math.sin(me);h.push(Ii*le*F+u,Ii*we*F+F),h.push(he*le*F+u,he*we*F+F)}for(var z=0;z<=6;z++){var K=z*lt;U(K,ti),U(K+kt,ti),U(K+Pi,Di),U(K+(lt-Pi),Di),U(K+(lt-kt),ti)}s.gearVertexCount=h.length/2-s.gearOffset,s.arrowOffset=h.length/2;function q(ne,he){h.push(N+ne,o.drawingBufferHeight-N-he)}var H=v/Math.sin(45*Gt);q(0,F),q(F,0),q(F+H,H),q(H,F+H),q(H,F-H),q(0,F),q(F,F*2),q(F+H,F*2-H),q(H,F-H),q(0,F),q(H,F-v),q(je*x,F-v),q(H,F+v),q(je*x,F+v),s.arrowVertexCount=h.length/2-s.arrowOffset,o.bindBuffer(o.ARRAY_BUFFER,s.vertexBuffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(h),o.STATIC_DRAW)})},Ke.prototype.render=function(){var r=this.gl,s=this,a=[r.CULL_FACE,r.DEPTH_TEST,r.BLEND,r.SCISSOR_TEST,r.STENCIL_TEST,r.COLOR_WRITEMASK,r.VIEWPORT,r.CURRENT_PROGRAM,r.ARRAY_BUFFER_BINDING];Fe(r,a,function(o){o.disable(o.CULL_FACE),o.disable(o.DEPTH_TEST),o.disable(o.BLEND),o.disable(o.SCISSOR_TEST),o.disable(o.STENCIL_TEST),o.colorMask(!0,!0,!0,!0),o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),s.renderNoState()})},Ke.prototype.renderNoState=function(){var r=this.gl;r.useProgram(this.program),r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer),r.enableVertexAttribArray(this.attribs.position),r.vertexAttribPointer(this.attribs.position,2,r.FLOAT,!1,8,0),r.uniform4f(this.uniforms.color,1,1,1,1),$(this.projMat,0,r.drawingBufferWidth,0,r.drawingBufferHeight,.1,1024),r.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),r.drawArrays(r.TRIANGLE_STRIP,0,4),r.drawArrays(r.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),r.drawArrays(r.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)};function Vt(r){this.coefficients=r}Vt.prototype.distortInverse=function(r){for(var s=0,a=1,o=r-this.distort(s);Math.abs(a-s)>1e-4;){var h=r-this.distort(a),u=a-h*((a-s)/(h-o));s=a,a=u,o=h}return a},Vt.prototype.distort=function(r){for(var s=r*r,a=0,o=0;o<this.coefficients.length;o++)a=s*(a+this.coefficients[o]);return(a+1)*r};var Ge=Math.PI/180,ke=180/Math.PI,oe=function(s,a,o){this.x=s||0,this.y=a||0,this.z=o||0};oe.prototype={constructor:oe,set:function(s,a,o){return this.x=s,this.y=a,this.z=o,this},copy:function(s){return this.x=s.x,this.y=s.y,this.z=s.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var s=this.length();if(s!==0){var a=1/s;this.multiplyScalar(a)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(s){this.x*=s,this.y*=s,this.z*=s},applyQuaternion:function(s){var a=this.x,o=this.y,h=this.z,u=s.x,p=s.y,R=s.z,x=s.w,v=x*a+p*h-R*o,y=x*o+R*a-u*h,F=x*h+u*o-p*a,N=-u*a-p*o-R*h;return this.x=v*x+N*-u+y*-R-F*-p,this.y=y*x+N*-p+F*-u-v*-R,this.z=F*x+N*-R+v*-p-y*-u,this},dot:function(s){return this.x*s.x+this.y*s.y+this.z*s.z},crossVectors:function(s,a){var o=s.x,h=s.y,u=s.z,p=a.x,R=a.y,x=a.z;return this.x=h*x-u*R,this.y=u*p-o*x,this.z=o*R-h*p,this}};var ee=function(s,a,o,h){this.x=s||0,this.y=a||0,this.z=o||0,this.w=h!==void 0?h:1};ee.prototype={constructor:ee,set:function(s,a,o,h){return this.x=s,this.y=a,this.z=o,this.w=h,this},copy:function(s){return this.x=s.x,this.y=s.y,this.z=s.z,this.w=s.w,this},setFromEulerXYZ:function(s,a,o){var h=Math.cos(s/2),u=Math.cos(a/2),p=Math.cos(o/2),R=Math.sin(s/2),x=Math.sin(a/2),v=Math.sin(o/2);return this.x=R*u*p+h*x*v,this.y=h*x*p-R*u*v,this.z=h*u*v+R*x*p,this.w=h*u*p-R*x*v,this},setFromEulerYXZ:function(s,a,o){var h=Math.cos(s/2),u=Math.cos(a/2),p=Math.cos(o/2),R=Math.sin(s/2),x=Math.sin(a/2),v=Math.sin(o/2);return this.x=R*u*p+h*x*v,this.y=h*x*p-R*u*v,this.z=h*u*v-R*x*p,this.w=h*u*p+R*x*v,this},setFromAxisAngle:function(s,a){var o=a/2,h=Math.sin(o);return this.x=s.x*h,this.y=s.y*h,this.z=s.z*h,this.w=Math.cos(o),this},multiply:function(s){return this.multiplyQuaternions(this,s)},multiplyQuaternions:function(s,a){var o=s.x,h=s.y,u=s.z,p=s.w,R=a.x,x=a.y,v=a.z,y=a.w;return this.x=o*y+p*R+h*v-u*x,this.y=h*y+p*x+u*R-o*v,this.z=u*y+p*v+o*x-h*R,this.w=p*y-o*R-h*x-u*v,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var s=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return s===0?(this.x=0,this.y=0,this.z=0,this.w=1):(s=1/s,this.x=this.x*s,this.y=this.y*s,this.z=this.z*s,this.w=this.w*s),this},slerp:function(s,a){if(a===0)return this;if(a===1)return this.copy(s);var o=this.x,h=this.y,u=this.z,p=this.w,R=p*s.w+o*s.x+h*s.y+u*s.z;if(R<0?(this.w=-s.w,this.x=-s.x,this.y=-s.y,this.z=-s.z,R=-R):this.copy(s),R>=1)return this.w=p,this.x=o,this.y=h,this.z=u,this;var x=Math.acos(R),v=Math.sqrt(1-R*R);if(Math.abs(v)<.001)return this.w=.5*(p+this.w),this.x=.5*(o+this.x),this.y=.5*(h+this.y),this.z=.5*(u+this.z),this;var y=Math.sin((1-a)*x)/v,F=Math.sin(a*x)/v;return this.w=p*y+this.w*F,this.x=o*y+this.x*F,this.y=h*y+this.y*F,this.z=u*y+this.z*F,this},setFromUnitVectors:(function(){var r,s,a=1e-6;return function(o,h){return r===void 0&&(r=new oe),s=o.dot(h)+1,s<a?(s=0,Math.abs(o.x)>Math.abs(o.z)?r.set(-o.y,o.x,0):r.set(0,-o.z,o.y)):r.crossVectors(o,h),this.x=r.x,this.y=r.y,this.z=r.z,this.w=s,this.normalize(),this}})()};function ri(r){this.width=r.width||T(),this.height=r.height||B(),this.widthMeters=r.widthMeters,this.heightMeters=r.heightMeters,this.bevelMeters=r.bevelMeters}var Xr=new ri({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),Hr=new ri({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),si={CardboardV1:new ni({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new ni({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function de(r,s){this.viewer=si.CardboardV2,this.updateDeviceParams(r),this.distortion=new Vt(this.viewer.distortionCoefficients);for(var a=0;a<s.length;a++){var o=s[a];si[o.id]=new ni(o)}}de.prototype.updateDeviceParams=function(r){this.device=this.determineDevice_(r)||this.device},de.prototype.getDevice=function(){return this.device},de.prototype.setViewer=function(r){this.viewer=r,this.distortion=new Vt(this.viewer.distortionCoefficients)},de.prototype.determineDevice_=function(r){if(!r)return f()?(console.warn("Using fallback iOS device measurements."),Hr):(console.warn("Using fallback Android device measurements."),Xr);var s=.0254,a=s/r.xdpi,o=s/r.ydpi,h=T(),u=B();return new ri({widthMeters:a*h,heightMeters:o*u,bevelMeters:r.bevelMm*.001})},de.prototype.getDistortedFieldOfViewLeftEye=function(){var r=this.viewer,s=this.device,a=this.distortion,o=r.screenLensDistance,h=(s.widthMeters-r.interLensDistance)/2,u=r.interLensDistance/2,p=r.baselineLensDistance-s.bevelMeters,R=s.heightMeters-p,x=ke*Math.atan(a.distort(h/o)),v=ke*Math.atan(a.distort(u/o)),y=ke*Math.atan(a.distort(p/o)),F=ke*Math.atan(a.distort(R/o));return{leftDegrees:Math.min(x,r.fov),rightDegrees:Math.min(v,r.fov),downDegrees:Math.min(y,r.fov),upDegrees:Math.min(F,r.fov)}},de.prototype.getLeftEyeVisibleTanAngles=function(){var r=this.viewer,s=this.device,a=this.distortion,o=Math.tan(-Ge*r.fov),h=Math.tan(Ge*r.fov),u=Math.tan(Ge*r.fov),p=Math.tan(-Ge*r.fov),R=s.widthMeters/4,x=s.heightMeters/2,v=r.baselineLensDistance-s.bevelMeters-x,y=r.interLensDistance/2-R,F=-v,N=r.screenLensDistance,U=a.distort((y-R)/N),z=a.distort((F+x)/N),K=a.distort((y+R)/N),q=a.distort((F-x)/N),H=new Float32Array(4);return H[0]=Math.max(o,U),H[1]=Math.min(h,z),H[2]=Math.min(u,K),H[3]=Math.max(p,q),H},de.prototype.getLeftEyeNoLensTanAngles=function(){var r=this.viewer,s=this.device,a=this.distortion,o=new Float32Array(4),h=a.distortInverse(Math.tan(-Ge*r.fov)),u=a.distortInverse(Math.tan(Ge*r.fov)),p=a.distortInverse(Math.tan(Ge*r.fov)),R=a.distortInverse(Math.tan(-Ge*r.fov)),x=s.widthMeters/4,v=s.heightMeters/2,y=r.baselineLensDistance-s.bevelMeters-v,F=r.interLensDistance/2-x,N=-y,U=r.screenLensDistance,z=(F-x)/U,K=(N+v)/U,q=(F+x)/U,H=(N-v)/U;return o[0]=Math.max(h,z),o[1]=Math.min(u,K),o[2]=Math.min(p,q),o[3]=Math.max(R,H),o},de.prototype.getLeftEyeVisibleScreenRect=function(r){var s=this.viewer,a=this.device,o=s.screenLensDistance,h=(a.widthMeters-s.interLensDistance)/2,u=s.baselineLensDistance-a.bevelMeters,p=(r[0]*o+h)/a.widthMeters,R=(r[1]*o+u)/a.heightMeters,x=(r[2]*o+h)/a.widthMeters,v=(r[3]*o+u)/a.heightMeters;return{x:p,y:v,width:x-p,height:R-v}},de.prototype.getFieldOfViewLeftEye=function(r){return r?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},de.prototype.getFieldOfViewRightEye=function(r){var s=this.getFieldOfViewLeftEye(r);return{leftDegrees:s.rightDegrees,rightDegrees:s.leftDegrees,upDegrees:s.upDegrees,downDegrees:s.downDegrees}},de.prototype.getUndistortedFieldOfViewLeftEye=function(){var r=this.getUndistortedParams_();return{leftDegrees:ke*Math.atan(r.outerDist),rightDegrees:ke*Math.atan(r.innerDist),downDegrees:ke*Math.atan(r.bottomDist),upDegrees:ke*Math.atan(r.topDist)}},de.prototype.getUndistortedViewportLeftEye=function(){var r=this.getUndistortedParams_(),s=this.viewer,a=this.device,o=s.screenLensDistance,h=a.widthMeters/o,u=a.heightMeters/o,p=a.width/h,R=a.height/u,x=Math.round((r.eyePosX-r.outerDist)*p),v=Math.round((r.eyePosY-r.bottomDist)*R);return{x,y:v,width:Math.round((r.eyePosX+r.innerDist)*p)-x,height:Math.round((r.eyePosY+r.topDist)*R)-v}},de.prototype.getUndistortedParams_=function(){var r=this.viewer,s=this.device,a=this.distortion,o=r.screenLensDistance,h=r.interLensDistance/2/o,u=s.widthMeters/o,p=s.heightMeters/o,R=u/2-h,x=(r.baselineLensDistance-s.bevelMeters)/o,v=r.fov,y=a.distortInverse(Math.tan(Ge*v)),F=Math.min(R,y),N=Math.min(h,y),U=Math.min(x,y),z=Math.min(p-x,y);return{outerDist:F,innerDist:N,topDist:z,bottomDist:U,eyePosX:R,eyePosY:x}};function ni(r){this.id=r.id,this.label=r.label,this.fov=r.fov,this.interLensDistance=r.interLensDistance,this.baselineLensDistance=r.baselineLensDistance,this.screenLensDistance=r.screenLensDistance,this.distortionCoefficients=r.distortionCoefficients,this.inverseCoefficients=r.inverseCoefficients}de.Viewers=si;var qr=1,Yr="2019-11-09T17:36:14Z",jr=[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}],Kr={format:qr,last_updated:Yr,devices:jr};function ct(r,s){if(this.dpdb=Kr,this.recalculateDeviceParams_(),r){this.onDeviceParamsUpdated=s;var a=new XMLHttpRequest,o=this;a.open("GET",r,!0),a.addEventListener("load",function(){o.loading=!1,a.status>=200&&a.status<=299?(o.dpdb=JSON.parse(a.response),o.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),a.send()}}ct.prototype.getDeviceParams=function(){return this.deviceParams},ct.prototype.recalculateDeviceParams_=function(){var r=this.calcDeviceParams_();r?(this.deviceParams=r,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},ct.prototype.calcDeviceParams_=function(){var r=this.dpdb;if(!r)return console.error("DPDB not available."),null;if(r.format!=1)return console.error("DPDB has unexpected format version."),null;if(!r.devices||!r.devices.length)return console.error("DPDB does not have a devices section."),null;var s=navigator.userAgent||navigator.vendor||window.opera,a=T(),o=B();if(!r.devices)return console.error("DPDB has no devices section."),null;for(var h=0;h<r.devices.length;h++){var u=r.devices[h];if(!u.rules){console.warn("Device["+h+"] has no rules section.");continue}if(u.type!="ios"&&u.type!="android"){console.warn("Device["+h+"] has invalid type.");continue}if(f()==(u.type=="ios")){for(var p=!1,R=0;R<u.rules.length;R++){var x=u.rules[R];if(this.ruleMatches_(x,s,a,o)){p=!0;break}}if(p){var v=u.dpi[0]||u.dpi,y=u.dpi[1]||u.dpi;return new Zr({xdpi:v,ydpi:y,bevelMm:u.bw})}}}return console.warn("No DPDB device match."),null},ct.prototype.ruleMatches_=function(r,s,a,o){if(!r.ua&&!r.res||(r.ua&&r.ua.substring(0,2)==="SM"&&(r.ua=r.ua.substring(0,7)),r.ua&&s.indexOf(r.ua)<0))return!1;if(r.res){if(!r.res[0]||!r.res[1])return!1;var h=r.res[0],u=r.res[1];if(Math.min(a,o)!=Math.min(h,u)||Math.max(a,o)!=Math.max(h,u))return!1}return!0};function Zr(r){this.xdpi=r.xdpi,this.ydpi=r.ydpi,this.bevelMm=r.bevelMm}function ht(r,s){this.set(r,s)}ht.prototype.set=function(r,s){this.sample=r,this.timestampS=s},ht.prototype.copy=function(r){this.set(r.sample,r.timestampS)};function Ze(r,s){this.kFilter=r,this.isDebug=s,this.currentAccelMeasurement=new ht,this.currentGyroMeasurement=new ht,this.previousGyroMeasurement=new ht,f()?this.filterQ=new ee(-1,0,0,1):this.filterQ=new ee(1,0,0,1),this.previousFilterQ=new ee,this.previousFilterQ.copy(this.filterQ),this.accelQ=new ee,this.isOrientationInitialized=!1,this.estimatedGravity=new oe,this.measuredGravity=new oe,this.gyroIntegralQ=new ee}Ze.prototype.addAccelMeasurement=function(r,s){this.currentAccelMeasurement.set(r,s)},Ze.prototype.addGyroMeasurement=function(r,s){this.currentGyroMeasurement.set(r,s);var a=s-this.previousGyroMeasurement.timestampS;P(a)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},Ze.prototype.run_=function(){if(!this.isOrientationInitialized){this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0;return}var r=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,s=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,r);this.gyroIntegralQ.multiply(s),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(s);var a=new ee;a.copy(this.filterQ),a.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(a),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var o=new ee;o.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),o.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",ke*Z(o),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var h=new ee;h.copy(this.filterQ),h.multiply(o),this.filterQ.slerp(h,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},Ze.prototype.getOrientation=function(){return this.filterQ},Ze.prototype.accelToQuaternion_=function(r){var s=new oe;s.copy(r),s.normalize();var a=new ee;return a.setFromUnitVectors(new oe(0,0,-1),s),a.inverse(),a},Ze.prototype.gyroToQuaternionDelta_=function(r,s){var a=new ee,o=new oe;return o.copy(r),o.normalize(),a.setFromAxisAngle(o,r.length()*s),a};function Li(r,s){this.predictionTimeS=r,this.isDebug=s,this.previousQ=new ee,this.previousTimestampS=null,this.deltaQ=new ee,this.outQ=new ee}Li.prototype.getPrediction=function(r,s,a){if(!this.previousTimestampS)return this.previousQ.copy(r),this.previousTimestampS=a,r;var o=new oe;o.copy(s),o.normalize();var h=s.length();if(h<Ge*20)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(ke*h).toFixed(1)),this.outQ.copy(r),this.previousQ.copy(r),this.outQ;var u=h*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(o,u),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(r),this.previousTimestampS=a,this.outQ};function Pe(r,s,a,o){this.yawOnly=a,this.accelerometer=new oe,this.gyroscope=new oe,this.filter=new Ze(r,o),this.posePredictor=new Li(s,o),this.isFirefoxAndroid=D(),this.isIOS=f();var h=_();this.isDeviceMotionInRadians=!this.isIOS&&h&&h<66,this.isWithoutDeviceMotion=C()||O(),this.filterToWorldQ=new ee,f()?this.filterToWorldQ.setFromAxisAngle(new oe(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new oe(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new ee,this.worldToScreenQ=new ee,this.originalPoseAdjustQ=new ee,this.originalPoseAdjustQ.setFromAxisAngle(new oe(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),M()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new ee,this.orientationOut_=new Float32Array(4),this.start()}Pe.prototype.getPosition=function(){return null},Pe.prototype.getOrientation=function(){var r=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||(function(){var h=new ee().setFromAxisAngle(new oe(0,0,-1),0),u=new ee;return window.orientation===-90?u.setFromAxisAngle(new oe(0,1,0),Math.PI/-2):u.setFromAxisAngle(new oe(0,1,0),Math.PI/2),h.multiply(u)})(),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||(function(){var h=new ee;return h.setFromAxisAngle(new oe(1,0,0),-Math.PI/2),h})(),r=this._deviceOrientationQ;var a=new ee;return a.copy(r),a.multiply(this.deviceOrientationFilterToWorldQ),a.multiply(this.resetQ),a.multiply(this.worldToScreenQ),a.multiplyQuaternions(this.deviceOrientationFixQ,a),this.yawOnly&&(a.x=0,a.z=0,a.normalize()),this.orientationOut_[0]=a.x,this.orientationOut_[1]=a.y,this.orientationOut_[2]=a.z,this.orientationOut_[3]=a.w,this.orientationOut_}else{var s=this.filter.getOrientation();r=this.posePredictor.getPrediction(s,this.gyroscope,this.previousTimestampS)}var a=new ee;return a.copy(this.filterToWorldQ),a.multiply(this.resetQ),a.multiply(r),a.multiply(this.worldToScreenQ),this.yawOnly&&(a.x=0,a.z=0,a.normalize()),this.orientationOut_[0]=a.x,this.orientationOut_[1]=a.y,this.orientationOut_[2]=a.z,this.orientationOut_[3]=a.w,this.orientationOut_},Pe.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),M()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},Pe.prototype.onDeviceOrientation_=function(r){this._deviceOrientationQ=this._deviceOrientationQ||new ee;var s=r.alpha,a=r.beta,o=r.gamma;s=(s||0)*Math.PI/180,a=(a||0)*Math.PI/180,o=(o||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(a,s,-o)},Pe.prototype.onDeviceMotion_=function(r){this.updateDeviceMotion_(r)},Pe.prototype.updateDeviceMotion_=function(r){var s=r.accelerationIncludingGravity,a=r.rotationRate,o=r.timeStamp/1e3,h=o-this.previousTimestampS;if(h<0){se("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),this.previousTimestampS=o;return}else if(h<=c||h>d){se("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),this.previousTimestampS=o;return}this.accelerometer.set(-s.x,-s.y,-s.z),a&&(g()?this.gyroscope.set(-a.beta,a.alpha,a.gamma):this.gyroscope.set(a.alpha,a.beta,a.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,o)),this.filter.addAccelMeasurement(this.accelerometer,o),this.previousTimestampS=o},Pe.prototype.onOrientationChange_=function(r){this.setScreenTransform_()},Pe.prototype.onMessage_=function(r){var s=r.data;if(!(!s||!s.type)){var a=s.type.toLowerCase();a==="devicemotion"&&this.updateDeviceMotion_(s.deviceMotionEvent)}},Pe.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new oe(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new oe(0,0,1),Math.PI/2);break}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},Pe.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),f()&&j()&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},Pe.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var $r=60,Jr=new oe(1,0,0),es=new oe(0,0,1),ai=new ee;ai.setFromAxisAngle(Jr,-Math.PI/2),ai.multiply(new ee().setFromAxisAngle(es,Math.PI/2));var ts=(function(){function r(s){t(this,r),this.config=s,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new ee,this._outQ=new ee,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return n(r,[{key:"init",value:function(){var a=null;try{a=new RelativeOrientationSensor({frequency:$r,referenceFrame:"screen"}),a.addEventListener("error",this._onSensorError)}catch(o){this.errors.push(o),o.name==="SecurityError"?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):o.name==="ReferenceError"?this.useDeviceMotion():console.error(o)}a&&(this.api="sensor",this.sensor=a,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new Pe(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var a=this.sensor.quaternion;this._sensorQ.set(a[0],a[1],a[2],a[3]);var o=this._outQ;return o.copy(ai),o.multiply(this._sensorQ),this.config.YAW_ONLY&&(o.x=o.z=0,o.normalize()),this._out[0]=o.x,this._out[1]=o.y,this._out[2]=o.z,this._out[3]=o.w,this._out}},{key:"_onSensorError",value:function(a){this.errors.push(a.error),a.error.name==="NotAllowedError"?console.error("Permission to access sensor was denied"):a.error.name==="NotReadableError"?console.error("Sensor could not be read"):console.error(a.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),r})(),is="<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>";function $e(){this.loadIcon_();var r=document.createElement("div"),p=r.style;p.position="fixed",p.top=0,p.right=0,p.bottom=0,p.left=0,p.backgroundColor="gray",p.fontFamily="sans-serif",p.zIndex=1e6;var s=document.createElement("img");s.src=this.icon;var p=s.style;p.marginLeft="25%",p.marginTop="25%",p.width="50%",r.appendChild(s);var a=document.createElement("div"),p=a.style;p.textAlign="center",p.fontSize="16px",p.lineHeight="24px",p.margin="24px 25%",p.width="50%",a.innerHTML="Place your phone into your Cardboard viewer.",r.appendChild(a);var o=document.createElement("div"),p=o.style;p.backgroundColor="#CFD8DC",p.position="fixed",p.bottom=0,p.width="100%",p.height="48px",p.padding="14px 24px",p.boxSizing="border-box",p.color="#656A6B",r.appendChild(o);var h=document.createElement("div");h.style.float="left",h.innerHTML="No Cardboard viewer?";var u=document.createElement("a");u.href="https://www.google.com/get/cardboard/get-cardboard/",u.innerHTML="get one",u.target="_blank";var p=u.style;p.float="right",p.fontWeight=600,p.textTransform="uppercase",p.borderLeft="1px solid gray",p.paddingLeft="24px",p.textDecoration="none",p.color="#656A6B",o.appendChild(h),o.appendChild(u),this.overlay=r,this.text=a,this.hide()}$e.prototype.show=function(r){!r&&!this.overlay.parentElement?document.body.appendChild(this.overlay):r&&(this.overlay.parentElement&&this.overlay.parentElement!=r&&this.overlay.parentElement.removeChild(this.overlay),r.appendChild(this.overlay)),this.overlay.style.display="block";var s=this.overlay.querySelector("img"),a=s.style;M()?(a.width="20%",a.marginLeft="40%",a.marginTop="3%"):(a.width="50%",a.marginLeft="25%",a.marginTop="25%")},$e.prototype.hide=function(){this.overlay.style.display="none"},$e.prototype.showTemporarily=function(r,s){this.show(s),this.timer=setTimeout(this.hide.bind(this),r)},$e.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},$e.prototype.update=function(){this.disableShowTemporarily(),!M()&&I()?this.show():this.hide()},$e.prototype.loadIcon_=function(){this.icon=A("image/svg+xml",is)};var rs="CardboardV1",Bi="WEBVR_CARDBOARD_VIEWER",ss="webvr-polyfill-viewer-selector";function De(r){try{this.selectedKey=localStorage.getItem(Bi)}catch(s){console.error("Failed to load viewer profile: %s",s)}this.selectedKey||(this.selectedKey=r||rs),this.dialog=this.createDialog_(de.Viewers),this.root=null,this.onChangeCallbacks_=[]}De.prototype.show=function(r){this.root=r,r.appendChild(this.dialog);var s=this.dialog.querySelector("#"+this.selectedKey);s.checked=!0,this.dialog.style.display="block"},De.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},De.prototype.getCurrentViewer=function(){return de.Viewers[this.selectedKey]},De.prototype.getSelectedKey_=function(){var r=this.dialog.querySelector("input[name=field]:checked");return r?r.id:null},De.prototype.onChange=function(r){this.onChangeCallbacks_.push(r)},De.prototype.fireOnChange_=function(r){for(var s=0;s<this.onChangeCallbacks_.length;s++)this.onChangeCallbacks_[s](r)},De.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),!this.selectedKey||!de.Viewers[this.selectedKey]){console.error("ViewerSelector.onSave_: this should never happen!");return}this.fireOnChange_(de.Viewers[this.selectedKey]);try{localStorage.setItem(Bi,this.selectedKey)}catch(r){console.error("Failed to save viewer profile: %s",r)}this.hide()},De.prototype.createDialog_=function(r){var s=document.createElement("div");s.classList.add(ss),s.style.display="none";var a=document.createElement("div"),u=a.style;u.position="fixed",u.left=0,u.top=0,u.width="100%",u.height="100%",u.background="rgba(0, 0, 0, 0.3)",a.addEventListener("click",this.hide.bind(this));var o=280,h=document.createElement("div"),u=h.style;u.boxSizing="border-box",u.position="fixed",u.top="24px",u.left="50%",u.marginLeft=-o/2+"px",u.width=o+"px",u.padding="24px",u.overflow="hidden",u.background="#fafafa",u.fontFamily="'Roboto', sans-serif",u.boxShadow="0px 5px 20px #666",h.appendChild(this.createH1_("Select your viewer"));for(var p in r)h.appendChild(this.createChoice_(p,r[p].label));return h.appendChild(this.createButton_("Save",this.onSave_.bind(this))),s.appendChild(a),s.appendChild(h),s},De.prototype.createH1_=function(r){var s=document.createElement("h1"),a=s.style;return a.color="black",a.fontSize="20px",a.fontWeight="bold",a.marginTop=0,a.marginBottom="24px",s.innerHTML=r,s},De.prototype.createChoice_=function(r,s){var a=document.createElement("div");a.style.marginTop="8px",a.style.color="black";var o=document.createElement("input");o.style.fontSize="30px",o.setAttribute("id",r),o.setAttribute("type","radio"),o.setAttribute("value",r),o.setAttribute("name","field");var h=document.createElement("label");return h.style.marginLeft="4px",h.setAttribute("for",r),h.innerHTML=s,a.appendChild(o),a.appendChild(h),a},De.prototype.createButton_=function(r,s){var a=document.createElement("button");a.innerHTML=r;var o=a.style;return o.float="right",o.textTransform="uppercase",o.color="#1094f7",o.fontSize="14px",o.letterSpacing=0,o.border=0,o.background="none",o.marginTop="16px",a.addEventListener("click",s),a};var ns=typeof window<"u"?window:typeof ki<"u"?ki:typeof self<"u"?self:{};function as(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function os(r,s){return s={exports:{}},r(s,s.exports),s.exports}var ls=os(function(r,s){(function(o,h){r.exports=h()})(ns,function(){return(function(a){var o={};function h(u){if(o[u])return o[u].exports;var p=o[u]={i:u,l:!1,exports:{}};return a[u].call(p.exports,p,p.exports,h),p.l=!0,p.exports}return h.m=a,h.c=o,h.d=function(u,p,R){h.o(u,p)||Object.defineProperty(u,p,{configurable:!1,enumerable:!0,get:R})},h.n=function(u){var p=u&&u.__esModule?function(){return u.default}:function(){return u};return h.d(p,"a",p),p},h.o=function(u,p){return Object.prototype.hasOwnProperty.call(u,p)},h.p="",h(h.s=0)})([(function(a,o,h){var u=(function(){function y(F,N){for(var U=0;U<N.length;U++){var z=N[U];z.enumerable=z.enumerable||!1,z.configurable=!0,"value"in z&&(z.writable=!0),Object.defineProperty(F,z.key,z)}}return function(F,N,U){return N&&y(F.prototype,N),U&&y(F,U),F}})();function p(y,F){if(!(y instanceof F))throw new TypeError("Cannot call a class as a function")}var R=h(1),x=typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,v=(function(){function y(){p(this,y),x?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",R),this.noSleepVideo.addEventListener("timeupdate",(function(F){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}).bind(this)))}return u(y,[{key:"enable",value:function(){x?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){x?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),y})();a.exports=v}),(function(a,o,h){a.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="})])})}),cs=as(ls),hs=1e3,ds=[0,0,.5,1],us=[.5,0,.5,1],As=window.requestAnimationFrame,fs=window.cancelAnimationFrame;function ps(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null}function Oi(r){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:r.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:r.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:r.canPresent},maxLayers:{writable:!1,enumerable:!0,value:r.maxLayers},hasOrientation:{enumerable:!0,get:function(){return pe("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),r.hasOrientation}}})}function ae(r){r=r||{};var s="wakelock"in r?r.wakelock:!0;this.isPolyfilled=!0,this.displayId=hs++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return pe("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new Oi({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,s&&I()&&(this.wakelock_=new cs)}ae.prototype.getFrameData=function(r){return S(r,this._getPose(),this)},ae.prototype.getPose=function(){return pe("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},ae.prototype.resetPose=function(){return pe("VRDisplay.prototype.resetPose"),this._resetPose()},ae.prototype.getImmediatePose=function(){return pe("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},ae.prototype.requestAnimationFrame=function(r){return As(r)},ae.prototype.cancelAnimationFrame=function(r){return fs(r)},ae.prototype.wrapForFullscreen=function(r){if(f())return r;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var s=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",s.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==r)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=r,this.originalParent_=r.parentElement,this.originalParent_||document.body.appendChild(r),!this.fullscreenWrapper_.parentElement){var a=this.fullscreenElement_.parentElement;a.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),a.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var o=this;function h(){if(o.fullscreenElement_){var u=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];o.fullscreenElement_.setAttribute("style",u.join("; ")+";")}}return h(),this.fullscreenWrapper_},ae.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var r=this.fullscreenElement_;this.fullscreenElementCachedStyle_?r.setAttribute("style",this.fullscreenElementCachedStyle_):r.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var s=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(r),this.originalParent_===s?s.insertBefore(r,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(r),s.removeChild(this.fullscreenWrapper_),r}},ae.prototype.requestPresent=function(r){var s=this.isPresenting,a=this;return r instanceof Array||(pe("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),r=[r]),new Promise(function(o,h){if(!a.capabilities.canPresent){h(new Error("VRDisplay is not capable of presenting."));return}if(r.length==0||r.length>a.capabilities.maxLayers){h(new Error("Invalid number of layers."));return}var u=r[0];if(!u.source){o();return}var p=u.leftBounds||ds,R=u.rightBounds||us;if(s){var x=a.layer_;x.source!==u.source&&(x.source=u.source);for(var v=0;v<4;v++)x.leftBounds[v]=p[v],x.rightBounds[v]=R[v];a.wrapForFullscreen(a.layer_.source),a.updatePresent_(),o();return}if(a.layer_={predistorted:u.predistorted,source:u.source,leftBounds:p.slice(0),rightBounds:R.slice(0)},a.waitingForPresent_=!1,a.layer_&&a.layer_.source){var y=a.wrapForFullscreen(a.layer_.source),F=function(){var z=W();a.isPresenting=y===z,a.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(K){console.error("screen.orientation.lock() failed due to",K.message)}),a.waitingForPresent_=!1,a.beginPresent_(),o()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),a.removeFullscreenWrapper(),a.disableWakeLock(),a.endPresent_(),a.removeFullscreenListeners_()),a.fireVRDisplayPresentChange_()},N=function(){a.waitingForPresent_&&(a.removeFullscreenWrapper(),a.removeFullscreenListeners_(),a.disableWakeLock(),a.waitingForPresent_=!1,a.isPresenting=!1,h(new Error("Unable to present.")))};a.addFullscreenListeners_(y,F,N),V(y)?(a.enableWakeLock(),a.waitingForPresent_=!0):(f()||w())&&(a.enableWakeLock(),a.isPresenting=!0,a.beginPresent_(),a.fireVRDisplayPresentChange_(),o())}!a.waitingForPresent_&&!f()&&(k(),h(new Error("Unable to present.")))})},ae.prototype.exitPresent=function(){var r=this.isPresenting,s=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(a,o){r?(!k()&&f()&&(s.endPresent_(),s.fireVRDisplayPresentChange_()),w()&&(s.removeFullscreenWrapper(),s.removeFullscreenListeners_(),s.endPresent_(),s.fireVRDisplayPresentChange_()),a()):o(new Error("Was not presenting to VRDisplay."))})},ae.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},ae.prototype.fireVRDisplayPresentChange_=function(){var r=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(r)},ae.prototype.fireVRDisplayConnect_=function(){var r=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(r)},ae.prototype.addFullscreenListeners_=function(r,s,a){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=r,this.fullscreenChangeHandler_=s,this.fullscreenErrorHandler_=a,s&&(document.fullscreenEnabled?r.addEventListener("fullscreenchange",s,!1):document.webkitFullscreenEnabled?r.addEventListener("webkitfullscreenchange",s,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",s,!1):document.msFullscreenEnabled&&r.addEventListener("msfullscreenchange",s,!1)),a&&(document.fullscreenEnabled?r.addEventListener("fullscreenerror",a,!1):document.webkitFullscreenEnabled?r.addEventListener("webkitfullscreenerror",a,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",a,!1):document.msFullscreenEnabled&&r.addEventListener("msfullscreenerror",a,!1))},ae.prototype.removeFullscreenListeners_=function(){if(this.fullscreenEventTarget_){var r=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var s=this.fullscreenChangeHandler_;r.removeEventListener("fullscreenchange",s,!1),r.removeEventListener("webkitfullscreenchange",s,!1),document.removeEventListener("mozfullscreenchange",s,!1),r.removeEventListener("msfullscreenchange",s,!1)}if(this.fullscreenErrorHandler_){var a=this.fullscreenErrorHandler_;r.removeEventListener("fullscreenerror",a,!1),r.removeEventListener("webkitfullscreenerror",a,!1),document.removeEventListener("mozfullscreenerror",a,!1),r.removeEventListener("msfullscreenerror",a,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},ae.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},ae.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},ae.prototype.beginPresent_=function(){},ae.prototype.endPresent_=function(){},ae.prototype.submitFrame=function(r){},ae.prototype.getEyeParameters=function(r){return null};var ms={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},Nt={LEFT:"left",RIGHT:"right"};function ue(r){var s=G({},ms);r=G(s,r||{}),ae.call(this,{wakelock:r.MOBILE_WAKE_LOCK}),this.config=r,this.displayName="Cardboard VRDisplay",this.capabilities=new Oi({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new ts(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new ct(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new de(this.dpdb_.getDeviceParams(),r.ADDITIONAL_VIEWERS),this.viewerSelector_=new De(r.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new $e),f()&&window.addEventListener("resize",this.onResize_.bind(this))}return ue.prototype=Object.create(ae.prototype),ue.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},ue.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},ue.prototype._getFieldOfView=function(r){var s;if(r==Nt.LEFT)s=this.deviceInfo_.getFieldOfViewLeftEye();else if(r==Nt.RIGHT)s=this.deviceInfo_.getFieldOfViewRightEye();else return console.error("Invalid eye provided: %s",r),null;return s},ue.prototype._getEyeOffset=function(r){var s;if(r==Nt.LEFT)s=[-this.deviceInfo_.viewer.interLensDistance*.5,0,0];else if(r==Nt.RIGHT)s=[this.deviceInfo_.viewer.interLensDistance*.5,0,0];else return console.error("Invalid eye provided: %s",r),null;return s},ue.prototype.getEyeParameters=function(r){var s=this._getEyeOffset(r),a=this._getFieldOfView(r),o={offset:s,renderWidth:this.deviceInfo_.device.width*.5*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(o,"fieldOfView",{enumerable:!0,get:function(){return pe("VRFieldOfView","VRFrameData's projection matrices"),a}}),o},ue.prototype.onDeviceParamsUpdated_=function(r){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(r),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},ue.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},ue.prototype.beginPresent_=function(){var r=this.layer_.source.getContext("webgl");r||(r=this.layer_.source.getContext("experimental-webgl")),r||(r=this.layer_.source.getContext("webgl2")),r&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(r.canvas.width=T()*this.bufferScale_,r.canvas.height=B()*this.bufferScale_,this.cardboardUI_=new Ke(r)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new Ke(r)),this.distorter_=new ve(r,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen((function(s){this.viewerSelector_.show(this.layer_.source.parentElement),s.stopPropagation(),s.preventDefault()}).bind(this),(function(s){this.exitPresent(),s.stopPropagation(),s.preventDefault()}).bind(this)),this.rotateInstructions_&&(M()&&I()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},ue.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},ue.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},ue.prototype.submitFrame=function(r){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var s=this.layer_.source.getContext("webgl");s||(s=this.layer_.source.getContext("experimental-webgl")),s||(s=this.layer_.source.getContext("webgl2"));var a=s.canvas;(a.width!=this.lastWidth||a.height!=this.lastHeight)&&this.cardboardUI_.onResize(),this.lastWidth=a.width,this.lastHeight=a.height,this.cardboardUI_.render()}},ue.prototype.onOrientationChange_=function(r){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},ue.prototype.onResize_=function(r){if(this.layer_){var s=this.layer_.source.getContext("webgl");s||(s=this.layer_.source.getContext("experimental-webgl")),s||(s=this.layer_.source.getContext("webgl2"));var a=["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"];s.canvas.setAttribute("style",a.join("; ")+";"),L(s.canvas)}},ue.prototype.onViewerChanged_=function(r){this.deviceInfo_.setViewer(r),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},ue.prototype.fireVRDisplayDeviceParamsChange_=function(){var r=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(r)},ue.VRFrameData=ps,ue.VRDisplay=ae,ue}))})(Qt)),Qt.exports}var _n=Sn();const Mn=Qs(_n);class Ci extends Si{constructor(e){super(),this.global=e,this.onWindowResize=this.onWindowResize.bind(this),this.global.window.addEventListener("resize",this.onWindowResize),this.environmentBlendMode="opaque"}onBaseLayerSet(e,t){throw new Error("Not implemented")}isSessionSupported(e){throw new Error("Not implemented")}isFeatureSupported(e){throw new Error("Not implemented")}async requestSession(e,t){throw new Error("Not implemented")}requestAnimationFrame(e){throw new Error("Not implemented")}onFrameStart(e){throw new Error("Not implemented")}onFrameEnd(e){throw new Error("Not implemented")}doesSessionSupportReferenceSpace(e,t){throw new Error("Not implemented")}requestStageBounds(){throw new Error("Not implemented")}async requestFrameOfReferenceTransform(e,t){}cancelAnimationFrame(e){throw new Error("Not implemented")}endSession(e){throw new Error("Not implemented")}getViewSpaces(e){}getViewport(e,t,n,l,c){throw new Error("Not implemented")}getProjectionMatrix(e,t){throw new Error("Not implemented")}getBasePoseMatrix(){throw new Error("Not implemented")}getBaseViewMatrix(e){throw new Error("Not implemented")}getInputSources(){throw new Error("Not implemented")}getInputPose(e,t,n){throw new Error("Not implemented")}onWindowResize(){this.onWindowResize()}}let Rn={mapping:"",profiles:["google-daydream","generic-trigger-touchpad"],buttons:{length:3,0:null,1:null,2:0}},Cn={mapping:"xr-standard",profiles:["htc-vive-focus","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0}},Tn={mapping:"xr-standard",profiles:["oculus-go","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[Math.PI*.11,0,0,1]}},$i={mapping:"xr-standard",displayProfiles:{"Oculus Quest":["oculus-touch-v2","oculus-touch","generic-trigger-squeeze-thumbstick"]},profiles:["oculus-touch","generic-trigger-squeeze-thumbstick"],axes:{length:4,0:null,1:null,2:0,3:1},buttons:{length:7,0:1,1:2,2:null,3:0,4:3,5:4,6:null},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},Fn={mapping:"xr-standard",profiles:["htc-vive","generic-trigger-squeeze-touchpad"],displayProfiles:{"HTC Vive":["htc-vive","generic-trigger-squeeze-touchpad"],"HTC Vive DVT":["htc-vive","generic-trigger-squeeze-touchpad"],"Valve Index":["valve-index","generic-trigger-squeeze-touchpad-thumbstick"]},buttons:{length:3,0:1,1:2,2:0},gripTransform:{position:[0,0,.05,1]},targetRayTransform:{orientation:[Math.PI*-.08,0,0,1]},userAgentOverrides:{Firefox:{axes:{invert:[1,3]}}}},Pn={mapping:"xr-standard",profiles:["samsung-gearvr","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[Math.PI*.11,0,0,1]}},Dn={mapping:"xr-standard",profiles:["samsung-odyssey","microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},Ai={mapping:"xr-standard",profiles:["microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[Math.PI*.11,0,0,1]}},In={"Daydream Controller":Rn,"Gear VR Controller":Pn,"HTC Vive Focus Controller":Cn,"Oculus Go Controller":Tn,"Oculus Touch (Right)":$i,"Oculus Touch (Left)":$i,"OpenVR Gamepad":Fn,"Spatial Controller (Spatial Interaction Source) 045E-065A":Ai,"Spatial Controller (Spatial Interaction Source) 045E-065D":Dn,"Windows Mixed Reality (Right)":Ai,"Windows Mixed Reality (Left)":Ai};const Ji=Be(.155,-.465,-.15),Ln=Be(-.155,-.465,-.15),Bn=Be(0,0,-.25),On=Be(0,0,.05),er=Be(-.08,.14,.08),tr=.4,Gn=.4,kn=.61,Vn=.175,Nn=.12,Un=.87,ir=180/Math.PI;function Wn(i,e,t){function n(m,f,w){return m<f?f:m>w?w:m}var l=e[0]*e[0],c=e[1]*e[1],d=e[2]*e[2],A=e[3]*e[3];i[0]=Math.asin(n(2*(e[0]*e[3]-e[1]*e[2]),-1,1)),i[1]=Math.atan2(2*(e[0]*e[2]+e[1]*e[3]),A-l-c+d),i[2]=Math.atan2(2*(e[0]*e[1]+e[2]*e[3]),A-l+c-d)}class zn{constructor(){this.hand="right",this.headElbowOffset=Ji,this.controllerQ=Ie(),this.lastControllerQ=Ie(),this.headQ=Ie(),this.headPos=We(),this.elbowPos=We(),this.wristPos=We(),this.time=null,this.lastTime=null,this.rootQ=Ie(),this.position=We()}setHandedness(e){this.hand!=e&&(this.hand=e,this.hand=="left"?this.headElbowOffset=Ln:this.headElbowOffset=Ji)}update(e,t){this.time=Sr(),e&&(li(this.lastControllerQ,this.controllerQ),li(this.controllerQ,e)),t&&(vr(this.headPos,t),wr(this.headQ,t));let n=this.getHeadYawOrientation_(),l=this.quatAngle_(this.lastControllerQ,this.controllerQ),c=(this.time-this.lastTime)/1e3;l/c>kn?Ft(this.rootQ,this.rootQ,n,Math.min(l/Vn,1)):li(this.rootQ,n);let A=Be(0,0,-1);tt(A,A,this.controllerQ);let m=_i(A,[0,1,0]),f=this.clamp_((m-Nn)/Un,0,1),w=Qi(this.rootQ);zi(w,w),Wi(w,w,this.controllerQ);let E=this.elbowPos;Ni(E,this.headPos),xt(E,E,this.headElbowOffset);let D=Vi(er);Ui(D,D,f),xt(E,E,D);let O=this.quatAngle_(w,Ie())*ir,C=1-Math.pow(O/180,4);sssss;let g=tr,M=1-tr,P=C*(g+M*f*Gn),T=Ie();Ft(T,T,w,P);let B=zi(Ie(),T),V=Qi(w);Wi(V,V,B);let k=this.wristPos;Ni(k,On),tt(k,k,T),xt(k,k,Bn),tt(k,k,V),xt(k,k,E);let W=Vi(er);Ui(W,W,f),xt(this.position,this.wristPos,W),tt(this.position,this.position,this.rootQ),this.lastTime=this.time}getPosition(){return this.position}getHeadYawOrientation_(){let e=We();return Wn(e,this.headQ),cn(Ie(),0,e[1]*ir,0)}clamp_(e,t,n){return Math.min(Math.max(e,t),n)}quatAngle_(e,t){let n=[0,0,-1],l=[0,0,-1];return tt(n,n,e),tt(l,l,t),$s(n,l)}}const ye=Symbol("@@webxr-polyfill/XRRemappedGamepad"),Ir={pressed:!1,touched:!1,value:0};Object.freeze(Ir);class Qn{constructor(e,t,n){if(n||(n={}),n.userAgentOverrides){for(let f in n.userAgentOverrides)if(navigator.userAgent.includes(f)){let w=n.userAgentOverrides[f];for(let E in w)E in n?Object.assign(n[E],w[E]):n[E]=w[E];break}}let l=new Array(n.axes&&n.axes.length?n.axes.length:e.axes.length),c=new Array(n.buttons&&n.buttons.length?n.buttons.length:e.buttons.length),d=null;if(n.gripTransform){let f=n.gripTransform.orientation||[0,0,0,1];d=et(),It(d,Yt(f,f),n.gripTransform.position||[0,0,0])}let A=null;if(n.targetRayTransform){let f=n.targetRayTransform.orientation||[0,0,0,1];A=et(),It(A,Yt(f,f),n.targetRayTransform.position||[0,0,0])}let m=n.profiles;n.displayProfiles&&t.displayName in n.displayProfiles&&(m=n.displayProfiles[t.displayName]),this[ye]={gamepad:e,map:n,profiles:m||[e.id],mapping:n.mapping||e.mapping,axes:l,buttons:c,gripTransform:d,targetRayTransform:A},this._update()}_update(){let e=this[ye].gamepad,t=this[ye].map,n=this[ye].axes;for(let c=0;c<n.length;++c)t.axes&&c in t.axes?t.axes[c]===null?n[c]=0:n[c]=e.axes[t.axes[c]]:n[c]=e.axes[c];if(t.axes&&t.axes.invert)for(let c of t.axes.invert)c<n.length&&(n[c]*=-1);let l=this[ye].buttons;for(let c=0;c<l.length;++c)t.buttons&&c in t.buttons?t.buttons[c]===null?l[c]=Ir:l[c]=e.buttons[t.buttons[c]]:l[c]=e.buttons[c]}get id(){return""}get _profiles(){return this[ye].profiles}get index(){return-1}get connected(){return this[ye].gamepad.connected}get timestamp(){return this[ye].gamepad.timestamp}get mapping(){return this[ye].mapping}get axes(){return this[ye].axes}get buttons(){return this[ye].buttons}get hapticActuators(){return this[ye].gamepad.hapticActuators}}class Xn{constructor(e,t,n=0,l=-1){this.polyfill=e,this.display=t,this.nativeGamepad=null,this.gamepad=null,this.inputSource=new Fr(this),this.lastPosition=We(),this.emulatedPosition=!1,this.basePoseMatrix=et(),this.outputMatrix=et(),this.primaryButtonIndex=n,this.primaryActionPressed=!1,this.primarySqueezeButtonIndex=l,this.primarySqueezeActionPressed=!1,this.handedness="",this.targetRayMode="gaze",this.armModel=null}get profiles(){return this.gamepad?this.gamepad._profiles:[]}updateFromGamepad(e){this.nativeGamepad!==e&&(this.nativeGamepad=e,e?this.gamepad=new Qn(e,this.display,In[e.id]):this.gamepad=null),this.handedness=e.hand===""?"none":e.hand,this.gamepad&&this.gamepad._update(),e.pose?(this.targetRayMode="tracked-pointer",this.emulatedPosition=!e.pose.hasPosition):e.hand===""&&(this.targetRayMode="gaze",this.emulatedPosition=!1)}updateBasePoseMatrix(){if(this.nativeGamepad&&this.nativeGamepad.pose){let e=this.nativeGamepad.pose,t=e.position,n=e.orientation;if(!t&&!n)return;t?(this.lastPosition[0]=t[0],this.lastPosition[1]=t[1],this.lastPosition[2]=t[2]):e.hasPosition?t=this.lastPosition:(this.armModel||(this.armModel=new zn),this.armModel.setHandedness(this.nativeGamepad.hand),this.armModel.update(n,this.polyfill.getBasePoseMatrix()),t=this.armModel.getPosition()),It(this.basePoseMatrix,n,t)}else Ks(this.basePoseMatrix,this.polyfill.getBasePoseMatrix());return this.basePoseMatrix}getXRPose(e,t){switch(this.updateBasePoseMatrix(),t){case"target-ray":e._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[ye].targetRayTransform&&st(this.outputMatrix,this.outputMatrix,this.gamepad[ye].targetRayTransform);break;case"grip":if(!this.nativeGamepad||!this.nativeGamepad.pose)return null;e._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[ye].gripTransform&&st(this.outputMatrix,this.outputMatrix,this.gamepad[ye].gripTransform);break;default:return null}return e._adjustForOriginOffset(this.outputMatrix),new XRPose(new XRRigidTransform(this.outputMatrix),this.emulatedPosition)}}const rr={highRefreshRate:!0},sr={oculus:1,openvr:1,"spatial controller (spatial interaction source)":1};let Hn=0,qn=class{constructor(e,t,n={}){if(this.mode=e,this.enabledFeatures=t,this.outputContext=null,this.immersive=e=="immersive-vr"||e=="immersive-ar",this.ended=null,this.baseLayer=null,this.id=++Hn,this.modifiedCanvasLayer=!1,this.outputContext){const l=n.renderContextType||"2d";this.renderContext=this.outputContext.canvas.getContext(l)}}};class Lr extends Ci{constructor(e,t){const{canPresent:n}=t.capabilities;super(e),this.display=t,this.frame=new e.VRFrameData,this.sessions=new Map,this.immersiveSession=null,this.canPresent=n,this.baseModelMatrix=et(),this.gamepadInputSources={},this.tempVec3=new Float32Array(3),this.onVRDisplayPresentChange=this.onVRDisplayPresentChange.bind(this),e.window.addEventListener("vrdisplaypresentchange",this.onVRDisplayPresentChange),this.CAN_USE_GAMEPAD=e.navigator&&"getGamepads"in e.navigator,this.HAS_BITMAP_SUPPORT=yn(e)}get depthNear(){return this.display.depthNear}set depthNear(e){this.display.depthNear=e}get depthFar(){return this.display.depthFar}set depthFar(e){this.display.depthFar=e}onBaseLayerSet(e,t){const n=this.sessions.get(e),l=t.context.canvas;if(n.immersive){const c=this.display.getEyeParameters("left"),d=this.display.getEyeParameters("right");l.width=Math.max(c.renderWidth,d.renderWidth)*2,l.height=Math.max(c.renderHeight,d.renderHeight),this.display.requestPresent([{source:l,attributes:rr}]).then(()=>{this.global.document.body.contains(l)||(n.modifiedCanvasLayer=!0,this.global.document.body.appendChild(l),En(l)),n.baseLayer=t})}else n.baseLayer=t}isSessionSupported(e){return!(e=="immersive-ar"||e=="immersive-vr"&&this.canPresent===!1)}isFeatureSupported(e){switch(e){case"viewer":return!0;case"local":return!0;case"local-floor":return!0;case"bounded":return!1;case"unbounded":return!1;default:return!1}}async requestSession(e,t){if(!this.isSessionSupported(e))return Promise.reject();let n=e=="immersive-vr";if(n){const c=this.global.document.createElement("canvas");c.getContext("webgl"),await this.display.requestPresent([{source:c,attributes:rr}])}const l=new qn(e,t,{renderContextType:this.HAS_BITMAP_SUPPORT?"bitmaprenderer":"2d"});return this.sessions.set(l.id,l),n&&(this.immersiveSession=l,this.dispatchEvent("@@webxr-polyfill/vr-present-start",l.id)),Promise.resolve(l.id)}requestAnimationFrame(e){return this.display.requestAnimationFrame(e)}getPrimaryButtonIndex(e){let t=0,n=e.id.toLowerCase();for(let l in sr)if(n.includes(l)){t=sr[l];break}return Math.min(t,e.buttons.length-1)}onFrameStart(e,t){this.display.depthNear=t.depthNear,this.display.depthFar=t.depthFar,this.display.getFrameData(this.frame);const n=this.sessions.get(e);if(n.immersive&&this.CAN_USE_GAMEPAD){let l=this.gamepadInputSources;this.gamepadInputSources={};let c=this.global.navigator.getGamepads();for(let d=0;d<c.length;++d){let A=c[d];if(A&&A.displayId>0){let m=l[d];if(m||(m=new Xn(this,this.display,this.getPrimaryButtonIndex(A))),m.updateFromGamepad(A),this.gamepadInputSources[d]=m,m.primaryButtonIndex!=-1){let f=A.buttons[m.primaryButtonIndex].pressed;f&&!m.primaryActionPressed?this.dispatchEvent("@@webxr-polyfill/input-select-start",{sessionId:n.id,inputSource:m.inputSource}):!f&&m.primaryActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-select-end",{sessionId:n.id,inputSource:m.inputSource}),m.primaryActionPressed=f}if(m.primarySqueezeButtonIndex!=-1){let f=A.buttons[m.primarySqueezeButtonIndex].pressed;f&&!m.primarySqueezeActionPressed?this.dispatchEvent("@@webxr-polyfill/input-squeeze-start",{sessionId:n.id,inputSource:m.inputSource}):!f&&m.primarySqueezeActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-squeeze-end",{sessionId:n.id,inputSource:m.inputSource}),m.primarySqueezeActionPressed=f}}}}if(!n.immersive&&n.baseLayer){const l=n.baseLayer.context.canvas;gr(this.frame.leftProjectionMatrix,t.inlineVerticalFieldOfView,l.width/l.height,t.depthNear,t.depthFar)}}onFrameEnd(e){const t=this.sessions.get(e);if(!(t.ended||!t.baseLayer)){if(t.outputContext&&!(t.immersive&&!this.display.capabilities.hasExternalDisplay)){const n=t.immersive&&this.display.capabilities.hasExternalDisplay,l=t.baseLayer.context.canvas,c=n?l.width/2:l.width,d=l.height;{const A=t.outputContext.canvas,m=A.width,f=A.height,w=t.renderContext;this.HAS_BITMAP_SUPPORT?l.transferToImageBitmap?w.transferFromImageBitmap(l.transferToImageBitmap()):this.global.createImageBitmap(l,0,0,c,d,{resizeWidth:m,resizeHeight:f}).then(E=>w.transferFromImageBitmap(E)):w.drawImage(l,0,0,c,d,0,0,m,f)}}t.immersive&&t.baseLayer&&this.display.submitFrame()}}cancelAnimationFrame(e){this.display.cancelAnimationFrame(e)}async endSession(e){const t=this.sessions.get(e);if(!t.ended){if(t.immersive)return this.display.exitPresent();t.ended=!0}}doesSessionSupportReferenceSpace(e,t){const n=this.sessions.get(e);return n.ended?!1:n.enabledFeatures.has(t)}requestStageBounds(){if(this.display.stageParameters){const e=this.display.stageParameters.sizeX,t=this.display.stageParameters.sizeZ,n=[];return n.push(-e/2),n.push(-t/2),n.push(e/2),n.push(-t/2),n.push(e/2),n.push(t/2),n.push(-e/2),n.push(t/2),n}return null}async requestFrameOfReferenceTransform(e,t){return(e==="local-floor"||e==="bounded-floor")&&this.display.stageParameters&&this.display.stageParameters.sittingToStandingTransform?this.display.stageParameters.sittingToStandingTransform:null}getProjectionMatrix(e){if(e==="left")return this.frame.leftProjectionMatrix;if(e==="right")return this.frame.rightProjectionMatrix;if(e==="none")return this.frame.leftProjectionMatrix;throw new Error("eye must be of type 'left' or 'right'")}getViewport(e,t,n,l){const c=this.sessions.get(e),{width:d,height:A}=n.context.canvas;if(!c.immersive)return l.x=l.y=0,l.width=d,l.height=A,!0;if(t==="left"||t==="none")l.x=0;else if(t==="right")l.x=d/2;else return!1;return l.y=0,l.width=d/2,l.height=A,!0}getBasePoseMatrix(){let{position:e,orientation:t}=this.frame.pose;return!e&&!t?this.baseModelMatrix:(e||(e=this.tempVec3,e[0]=e[1]=e[2]=0),It(this.baseModelMatrix,t,e),this.baseModelMatrix)}getBaseViewMatrix(e){if(e==="left"||e==="none")return this.frame.leftViewMatrix;if(e==="right")return this.frame.rightViewMatrix;throw new Error("eye must be of type 'left' or 'right'")}getInputSources(){let e=[];for(let t in this.gamepadInputSources)e.push(this.gamepadInputSources[t].inputSource);return e}getInputPose(e,t,n){if(!t)return null;for(let l in this.gamepadInputSources){let c=this.gamepadInputSources[l];if(c.inputSource===e)return c.getXRPose(t,n)}return null}onWindowResize(){}onVRDisplayPresentChange(e){this.display.isPresenting||this.sessions.forEach(t=>{if(t.immersive&&!t.ended){if(t.modifiedCanvasLayer){const n=t.baseLayer.context.canvas;document.body.removeChild(n),n.setAttribute("style","")}this.immersiveSession===t&&(this.immersiveSession=null),this.dispatchEvent("@@webxr-polyfill/vr-present-end",t.id)}})}}class Yn extends Lr{constructor(e,t){const n=new Mn(t||{});super(e,n),this.display=n,this.frame={rightViewMatrix:new Float32Array(16),leftViewMatrix:new Float32Array(16),rightProjectionMatrix:new Float32Array(16),leftProjectionMatrix:new Float32Array(16),pose:null,timestamp:null}}}let jn=0;class Kn{constructor(e,t){this.mode=e,this.enabledFeatures=t,this.ended=null,this.baseLayer=null,this.id=++jn}}class Zn extends Ci{constructor(e){super(e),this.sessions=new Map,this.projectionMatrix=et(),this.identityMatrix=et()}onBaseLayerSet(e,t){const n=this.sessions.get(e);n.baseLayer=t}isSessionSupported(e){return e=="inline"}isFeatureSupported(e){switch(e){case"viewer":return!0;default:return!1}}async requestSession(e,t){if(!this.isSessionSupported(e))return Promise.reject();const n=new Kn(e,t);return this.sessions.set(n.id,n),Promise.resolve(n.id)}requestAnimationFrame(e){return window.requestAnimationFrame(e)}cancelAnimationFrame(e){window.cancelAnimationFrame(e)}onFrameStart(e,t){const n=this.sessions.get(e);if(n.baseLayer){const l=n.baseLayer.context.canvas;gr(this.projectionMatrix,t.inlineVerticalFieldOfView,l.width/l.height,t.depthNear,t.depthFar)}}onFrameEnd(e){}async endSession(e){const t=this.sessions.get(e);t.ended=!0}doesSessionSupportReferenceSpace(e,t){const n=this.sessions.get(e);return n.ended?!1:n.enabledFeatures.has(t)}requestStageBounds(){return null}async requestFrameOfReferenceTransform(e,t){return null}getProjectionMatrix(e){return this.projectionMatrix}getViewport(e,t,n,l){this.sessions.get(e);const{width:c,height:d}=n.context.canvas;return l.x=l.y=0,l.width=c,l.height=d,!0}getBasePoseMatrix(){return this.identityMatrix}getBaseViewMatrix(e){return this.identityMatrix}getInputSources(){return[]}getInputPose(e,t,n){return null}onWindowResize(){}}const $n=async function(i){let e=null;if("getVRDisplays"in i.navigator)try{const t=await i.navigator.getVRDisplays();t&&t.length&&(e=new Lr(i,t[0]))}catch{}return e},Jn=async function(i,e){if(e.webvr){let n=await $n(i);if(n)return n}let t=bn(i);return t&&e.cardboard||!t&&e.allowCardboardOnDesktop?(i.VRFrameData||(i.VRFrameData=function(){this.rightViewMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.leftProjectionMatrix=new Float32Array(16),this.pose=null}),new Yn(i,e.cardboardConfig)):new Zn(i)},ea={global:xr,webvr:!0,cardboard:!0,cardboardConfig:null,allowCardboardOnDesktop:!1},Wt=["navigator","HTMLCanvasElement","WebGLRenderingContext"];class ta{constructor(e={}){this.config=Object.freeze(Object.assign({},ea,e)),this.global=this.config.global,this.nativeWebXR="xr"in this.global.navigator,this.injected=!1,this._injectPolyfill(this.global)}_injectPolyfill(e){if(!Wt.every(t=>!!e[t]))throw new Error(`Global must have the following attributes : ${Wt}`);for(const t of Object.keys(Pt))e[t]!==void 0?console.warn(`${t} already defined on global.`):e[t]=Pt[t];ji(e.WebGLRenderingContext),Ki(e.HTMLCanvasElement),e.OffscreenCanvas&&Ki(e.OffscreenCanvas),e.WebGL2RenderingContext&&ji(e.WebGL2RenderingContext),window.isSecureContext||console.warn(`WebXR Polyfill Warning:
This page is not running in a secure context (https:// or localhost)!
This means that although the page may be able to use the WebXR Polyfill it will
not be able to use native WebXR implementations, and as such will not be able to
access dedicated VR or AR hardware, and will not be able to take advantage of
any performance improvements a native WebXR implementation may offer. Please
host this content on a secure origin for the best user experience.
`),this.injected=!0,this._patchNavigatorXR()}_patchNavigatorXR(){let e=Jn(this.global,this.config);this.xr=new Pt.XRSystem(e),Object.defineProperty(this.global.navigator,"xr",{value:this.xr,configurable:!0})}_injectCompatibilityShims(e){if(!Wt.every(t=>!!e[t]))throw new Error(`Global must have the following attributes : ${Wt}`);if(e.navigator.xr&&"supportsSession"in e.navigator.xr&&!("isSessionSupported"in e.navigator.xr)){let t=e.navigator.xr.supportsSession;e.navigator.xr.isSessionSupported=function(n){return t.call(this,n).then(()=>!0).catch(()=>!1)},e.navigator.xr.supportsSession=function(n){return console.warn("navigator.xr.supportsSession() is deprecated. Please call navigator.xr.isSessionSupported() instead and check the boolean value returned when the promise resolves."),t.call(this,n)}}}}var ia=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ra(i,e){return e={exports:{}},i(e,e.exports),e.exports}var Br=ra(function(i){(function(e,t){var n=Math.pow(2,-24),l=Math.pow(2,32),c=Math.pow(2,53);function d(f){var w=new ArrayBuffer(256),E=new DataView(w),D,_=0;function O(I){for(var G=w.byteLength,L=_+I;G<L;)G*=2;if(G!==w.byteLength){var S=E;w=new ArrayBuffer(G),E=new DataView(w);for(var j=_+3>>2,X=0;X<j;++X)E.setUint32(X*4,S.getUint32(X*4))}return D=I,E}function C(){_+=D}function g(I){C(O(8).setFloat64(_,I))}function M(I){C(O(1).setUint8(_,I))}function P(I){for(var G=O(I.length),L=0;L<I.length;++L)G.setUint8(_+L,I[L]);C()}function T(I){C(O(2).setUint16(_,I))}function B(I){C(O(4).setUint32(_,I))}function V(I){var G=I%l,L=(I-G)/l,S=O(8);S.setUint32(_,L),S.setUint32(_+4,G),C()}function k(I,G){G<24?M(I<<5|G):G<256?(M(I<<5|24),M(G)):G<65536?(M(I<<5|25),T(G)):G<4294967296?(M(I<<5|26),B(G)):(M(I<<5|27),V(G))}function W(I){var G;if(I===!1)return M(244);if(I===!0)return M(245);if(I===null)return M(246);if(I===t)return M(247);switch(typeof I){case"number":if(Math.floor(I)===I){if(0<=I&&I<=c)return k(0,I);if(-c<=I&&I<0)return k(1,-(I+1))}return M(251),g(I);case"string":var L=[];for(G=0;G<I.length;++G){var S=I.charCodeAt(G);S<128?L.push(S):S<2048?(L.push(192|S>>6),L.push(128|S&63)):S<55296?(L.push(224|S>>12),L.push(128|S>>6&63),L.push(128|S&63)):(S=(S&1023)<<10,S|=I.charCodeAt(++G)&1023,S+=65536,L.push(240|S>>18),L.push(128|S>>12&63),L.push(128|S>>6&63),L.push(128|S&63))}return k(3,L.length),P(L);default:var j;if(Array.isArray(I))for(j=I.length,k(4,j),G=0;G<j;++G)W(I[G]);else if(I instanceof Uint8Array)k(2,I.length),P(I);else{var X=Object.keys(I);for(j=X.length,k(5,j),G=0;G<j;++G){var Z=X[G];W(Z),W(I[Z])}}}}if(W(f),"slice"in w)return w.slice(0,_);for(var Q=new ArrayBuffer(_),J=new DataView(Q),$=0;$<_;++$)J.setUint8($,E.getUint8($));return Q}function A(f,w,E){var D=new DataView(f),_=0;typeof w!="function"&&(w=function(L){return L}),typeof E!="function"&&(E=function(){return t});function O(L,S){return _+=S,L}function C(L){return O(new Uint8Array(f,_,L),L)}function g(){var L=new ArrayBuffer(4),S=new DataView(L),j=B(),X=j&32768,Z=j&31744,se=j&1023;if(Z===31744)Z=261120;else if(Z!==0)Z+=114688;else if(se!==0)return se*n;return S.setUint32(0,X<<16|Z<<13|se<<13),S.getFloat32(0)}function M(){return O(D.getFloat32(_),4)}function P(){return O(D.getFloat64(_),8)}function T(){return O(D.getUint8(_),1)}function B(){return O(D.getUint16(_),2)}function V(){return O(D.getUint32(_),4)}function k(){return V()*l+V()}function W(){return D.getUint8(_)!==255?!1:(_+=1,!0)}function Q(L){if(L<24)return L;if(L===24)return T();if(L===25)return B();if(L===26)return V();if(L===27)return k();if(L===31)return-1;throw"Invalid length encoding"}function J(L){var S=T();if(S===255)return-1;var j=Q(S&31);if(j<0||S>>5!==L)throw"Invalid indefinite length element";return j}function $(L,S){for(var j=0;j<S;++j){var X=T();X&128&&(X<224?(X=(X&31)<<6|T()&63,S-=1):X<240?(X=(X&15)<<12|(T()&63)<<6|T()&63,S-=2):(X=(X&15)<<18|(T()&63)<<12|(T()&63)<<6|T()&63,S-=3)),X<65536?L.push(X):(X-=65536,L.push(55296|X>>10),L.push(56320|X&1023))}}function I(){var L=T(),S=L>>5,j=L&31,X,Z;if(S===7)switch(j){case 25:return g();case 26:return M();case 27:return P()}if(Z=Q(j),Z<0&&(S<2||6<S))throw"Invalid length";switch(S){case 0:return Z;case 1:return-1-Z;case 2:if(Z<0){for(var se=[],pe=0;(Z=J(S))>=0;)pe+=Z,se.push(C(Z));var Oe=new Uint8Array(pe),Fe=0;for(X=0;X<se.length;++X)Oe.set(se[X],Fe),Fe+=se[X].length;return Oe}return C(Z);case 3:var Ye=[];if(Z<0)for(;(Z=J(S))>=0;)$(Ye,Z);else $(Ye,Z);return String.fromCharCode.apply(null,Ye);case 4:var Ne;if(Z<0)for(Ne=[];!W();)Ne.push(I());else for(Ne=new Array(Z),X=0;X<Z;++X)Ne[X]=I();return Ne;case 5:var ve={};for(X=0;X<Z||Z<0&&!W();++X){var ot=I();ve[ot]=I()}return ve;case 6:return w(I(),Z);case 7:switch(Z){case 20:return!1;case 21:return!0;case 22:return null;case 23:return t;default:return E(Z)}}}var G=I();if(_!==f.byteLength)throw"Remaining bytes";return G}var m={encode:d,decode:A};i.exports?i.exports=m:e.CBOR||(e.CBOR=m)})(ia)});/**
 * This files defines the HoloPlayClient class and Message class.
 *
 * Copyright (c) [2024] [Looking Glass Factory]
 *
 * @link    https://lookingglassfactory.com/
 * @file    This files defines the HoloPlayClient class and Message class.
 * @author  Looking Glass Factory.
 * @version 0.0.11
 * @license SEE LICENSE IN LICENSE.txt
 */const sa=typeof window>"u"?require("ws"):window.WebSocket;class na{constructor(e,t,n,l=!1,c,d,A){this.reqs=[],this.reps=[],this.requestId=this.getRequestId(),this.debug=l,this.isGreedy=d,this.errCallback=t,this.closeCallback=n,this.alwaysdebug=!1,this.isConnected=!1;let m=null;c||d||A?m=new aa(c,d,A,this.debug):(l&&(this.alwaysdebug=!0),typeof e=="function"&&(m=new oa)),this.openWebsocket(m,e)}sendMessage(e,t=60){this.alwaysdebug&&(e.cmd.debug=!0);let n=e.toCbor();return this.sendRequestObj(n,t)}disconnect(){this.ws.close()}openWebsocket(e=null,t=null){this.ws=new sa("ws://localhost:11222/driver",["rep.sp.nanomsg.org"]),this.ws.parent=this,this.ws.binaryType="arraybuffer",this.ws.onmessage=this.messageHandler,this.ws.onopen=(()=>{this.isConnected=!0,this.debug&&console.log("socket open"),e!=null&&this.sendMessage(e).then(t)}),this.ws.onerror=this.onSocketError,this.ws.onclose=this.onClose}sendRequestObj(e,t){return new Promise((n,l)=>{let c={id:this.requestId++,parent:this,payload:e,success:n,error:l,send:function(){this.debug&&console.log("attemtping to send request with ID "+this.id),this.timeout=setTimeout(c.send.bind(this),t*1e3);let d=new Uint8Array(e.byteLength+4);new DataView(d.buffer).setUint32(0,this.id),d.set(new Uint8Array(this.payload),4),this.parent.ws.send(d.buffer)}};this.reqs.push(c),c.send()})}messageHandler(e){let t=e.data;if(t.byteLength<4)return;let l=new DataView(t).getUint32(0);if(l<2147483648){this.parent.err("bad nng header");return}let c=this.parent.findReqIndex(l);if(c==-1){this.parent.err("got reply that doesn't match known request!");return}let d={id:l,payload:Br.decode(t.slice(4))};d.payload.error==0?this.parent.reqs[c].success(d.payload):this.parent.reqs[c].error(d.payload),clearTimeout(this.parent.reqs[c].timeout),this.parent.reqs.splice(c,1),this.parent.reps.push(d),this.debug&&console.log(d.payload)}getRequestId(){return Math.floor(this.prng()*2147483647)+2147483648}onClose(e){this.parent.isConnected=!1,this.parent.debug&&console.log("socket closed"),typeof this.parent.closeCallback=="function"&&this.parent.closeCallback(e)}onSocketError(e){this.parent.debug&&console.log(e),typeof this.parent.errCallback=="function"&&this.parent.errCallback(e)}err(e){this.debug&&console.log("[DRIVER ERROR]"+e)}findReqIndex(e){let t=0;for(;t<this.reqs.length;t++)if(this.reqs[t].id==e)return t;return-1}prng(){return this.rng==null&&(this.rng=la()),this.rng()}}class Or{constructor(e,t){this.cmd=e,this.bin=t}toCbor(){return Br.encode(this)}}class aa extends Or{constructor(e="",t=!1,n="",l=!1){let c={init:{}};e!=""&&(c.init.appid=e),n!=""&&(c.init.onclose=n),t&&(c.init.greedy=!0),l&&(c.init.debug=!0),super(c,null)}}class oa extends Or{constructor(){let e={info:{}};super(e,null)}}function la(){function i(l){for(var c=0,d=1779033703^l.length;c<l.length;c++)d=Math.imul(d^l.charCodeAt(c),3432918353),d=d<<13|d>>>19;return function(){return d=Math.imul(d^d>>>16,2246822507),d=Math.imul(d^d>>>13,3266489909),(d^=d>>>16)>>>0}}function e(l,c,d,A){return(()=>{var m=c<<9,f=l*5;return f=(f<<7|f>>>25)*9,d^=l,A^=c,c^=d,l^=A,d^=m,A=A<<11|A>>>21,(f>>>0)/4294967296})}var t=Date.now(),n=i(t.toString());return e(n(),n(),n(),n())}function ge(i,...e){let t=i[0];for(let n=1;n<i.length;++n){const l=e[n-1];t+=typeof l=="number"?l.toPrecision(10):l,t+=i[n]}return t}function ca(i){const e=ge`${i.pitch}`,t=ge`${i.tilt}`,n=ge`${i.calibration.center.value}`,l=ge`${i.subp}`,c=ge`${i.numViews}`,d=ge`${i.quiltWidth}`,A=ge`${i.quiltHeight}`,m=`${Math.round(i.calibration.subpixelCells.length)}`,f=`${Math.round(i.subpixelMode)}`,w=ge`${i.framebufferWidth}`,E=ge`${i.framebufferHeight}`,D=ge`${i.tileHeight}`,_=ge`${i.tileWidth}`,O=ge`${i.quiltWidth}`,C=ge`${i.quiltHeight}`,g=ge`${i.calibration.screenW.value}`,M=ge`${i.calibration.screenH.value}`,P=`${Math.round(i.filterMode)}`,T=ge`${i.gaussianSigma}`;return`#version 300 es
    precision mediump float;

    uniform int u_viewType;
    uniform sampler2D u_texture;
    in vec2 v_texcoord;

    const int MAX_SUBPIXELS = 60;
    uniform float subpixelData[MAX_SUBPIXELS];

    const int subpixelCellCount = ${m};
    const int cellPatternType = ${f};
    const int filter_mode = ${P};
    const float gaussian_sigma = ${T};
    const float tileCount = ${c};
    const float focus = 0.0;

    const vec2 quiltViewPortion = vec2(
      ${O*_/w},
      ${C*D/E});

    int GetCellForPixel(vec2 screen_uv)
    {
        int xPos = int(screen_uv.x * ${g});
        int yPos = int(screen_uv.y * ${M});
        int cell;
    
        if(cellPatternType == 0)
        {
            cell = 0;
        }
        else if(cellPatternType == 1)
        {
            // Checkerboard pattern AB
            //                      BA
            if ((yPos % 2 == 0 && xPos % 2 == 0) || (yPos % 2 != 0 && xPos % 2 != 0)) {
                cell = 0;
            } else {
                cell = 1;
            }
        }
        else if(cellPatternType == 2)
        {
            cell = xPos % 2;
        }
        else if(cellPatternType == 3)
        {
            int offset = (xPos % 2) * 2;
            cell = ((yPos + offset) % 4);
        }
        else if(cellPatternType == 4)
        {
            cell = yPos % 2;
        }
    
        return cell % subpixelCellCount;
    }

    vec2 GetQuiltCoordinates(vec2 tile_uv, int viewIndex)
    {
        float totalTiles = tileCount;
        float floaty = float(viewIndex);
        float view = clamp(floaty, 0.0, totalTiles);
        // on some platforms this is required to fix some precision issue???
        float tx = ${d} - 0.00001; // just an incredibly dumb bugfix
        float tileXIndex = mod(view, tx);
        float tileYIndex = floor(view / tx);
    
        float quiltCoordU = ((tileXIndex + tile_uv.x) / tx) * quiltViewPortion.x;
        float quiltCoordV = ((tileYIndex + tile_uv.y) / ${A}) * quiltViewPortion.y;
    
        vec2 quilt_uv = vec2(quiltCoordU, quiltCoordV);
    
        return quilt_uv;
    }

    float GetPixelShift(float val, int subPixel, int axis, int cell)
    {
        int index = cell * 6 + subPixel * 2 + axis;
        float offset = subpixelData[index];

        return val + offset;
    }

    vec3 GetSubpixelViews(vec2 screen_uv) {
        vec3 views = vec3(0.0);

        // calculate x contribution for each cell
        if(subpixelCellCount <= 0)
        {
            views[0] = screen_uv.x + ${l} * 0.0;
            views[1] = screen_uv.x + ${l} * 1.0;
            views[2] = screen_uv.x + ${l} * 2.0;
                
    
            // calculate y contribution for each cell
            views[0] += screen_uv.y * ${t};
            views[1] += screen_uv.y * ${t};
            views[2] += screen_uv.y * ${t};
        } else {
            // get the cell type for this screen space pixel
            int cell = GetCellForPixel(screen_uv);
    
            // calculate x contribution for each cell
            views[0]  = GetPixelShift(screen_uv.x, 0, 0, cell);
            views[1]  = GetPixelShift(screen_uv.x, 1, 0, cell);
            views[2]  = GetPixelShift(screen_uv.x, 2, 0, cell);
    
            // calculate y contribution for each cell
            views[0] += GetPixelShift(screen_uv.y, 0, 1, cell) * ${t};
            views[1] += GetPixelShift(screen_uv.y, 1, 1, cell) * ${t};
            views[2] += GetPixelShift(screen_uv.y, 2, 1, cell) * ${t};
        }

        views *= vec3(${e});
        views -= vec3(${n});
        views = vec3(1.0) - fract(views);

        views = clamp(views, vec3(0.00001), vec3(0.999999));
    
        return views;
    }
    
    // this is the simplest sampling mode where we just cast the viewIndex to int and take the color from that tile.
    vec4 GetViewsColors(vec2 tile_uv, vec3 views)
    {
        vec4 color = vec4(0, 0, 0, 1);
    
        for(int channel = 0; channel < 3; channel++)
        {
            int viewIndex = int(views[channel] * tileCount);
    
            float viewDir = views[channel] * 2.0 - 1.0;
            vec2 focused_uv = tile_uv;
            focused_uv.x += viewDir * focus;
    
            vec2 quilt_uv = GetQuiltCoordinates(focused_uv, viewIndex);
            color[channel] = texture(u_texture, quilt_uv)[channel];
        }
    
        return color;
    }

    //view filtering

    vec4 OldViewFiltering(vec2 tile_uv, vec3 views)
    {
        vec3 viewIndicies = views * tileCount;
        float viewSpaceTileSize = 1.0 / tileCount;
    
        // the idea here is to sample the closest two views and lerp between them
        vec3 leftViews = views;
        vec3 rightViews = leftViews + viewSpaceTileSize;
    
        vec4 leftColor = GetViewsColors(tile_uv, leftViews);
        vec4 rightColor = GetViewsColors(tile_uv, rightViews);
    
        vec3 leftRightLerp = viewIndicies - floor(viewIndicies);
    
        return vec4(
            mix(leftColor.x, rightColor.x, leftRightLerp.x),
            mix(leftColor.y, rightColor.y, leftRightLerp.y),
            mix(leftColor.z, rightColor.z, leftRightLerp.z),
            1.0
        );
    }

    vec4 GaussianViewFiltering(vec2 tile_uv, vec3 views)
    {
        vec3 viewIndicies = views * tileCount;
        float viewSpaceTileSize = 1.0 / tileCount;
    
        // this is just sampling a center view and the left and right view
        vec3 centerViews = views;
        vec3 leftViews = centerViews - viewSpaceTileSize;
        vec3 rightViews = centerViews + viewSpaceTileSize;
    
        vec4 centerColor = GetViewsColors(tile_uv, centerViews);
        vec4 leftColor   = GetViewsColors(tile_uv, leftViews);
        vec4 rightColor  = GetViewsColors(tile_uv, rightViews);
    
        // Calculate the effective discrete view directions based on the tileCount
        vec3 centerSnappedViews = floor(centerViews * tileCount) / tileCount;
        vec3 leftSnappedViews = floor(leftViews * tileCount) / tileCount;
        vec3 rightSnappedViews = floor(rightViews * tileCount) / tileCount;
    
        // Gaussian weighting
        float sigma = gaussian_sigma;
        float multiplier = 2.0 * sigma * sigma;
    
        vec3 centerDiff = views - centerSnappedViews;
        vec3 leftDiff = views - leftSnappedViews;
        vec3 rightDiff = views - rightSnappedViews;
    
        vec3 centerWeight = exp(-centerDiff * centerDiff / multiplier);
        vec3 leftWeight = exp(-leftDiff * leftDiff / multiplier);
        vec3 rightWeight = exp(-rightDiff * rightDiff / multiplier);
    
        // Normalize the weights so they sum to 1 for each channel
        vec3 totalWeight = centerWeight + leftWeight + rightWeight;
        centerWeight /= totalWeight;
        leftWeight /= totalWeight;
        rightWeight /= totalWeight;
    
        // Weighted averaging based on Gaussian weighting for each channel
        vec4 outputColor = vec4(
            centerColor.r * centerWeight.x + leftColor.r * leftWeight.x + rightColor.r * rightWeight.x,
            centerColor.g * centerWeight.y + leftColor.g * leftWeight.y + rightColor.g * rightWeight.y,
            centerColor.b * centerWeight.z + leftColor.b * leftWeight.z + rightColor.b * rightWeight.z,
            1.0
        );
    
        return outputColor;
    }

    vec4 NGaussianViewFiltering(vec2 tile_uv, vec3 views, int n)
    {
        vec3 viewIndicies = views * tileCount;
        float viewSpaceTileSize = 1.0 / tileCount;
    
        float sigma = gaussian_sigma;  // Adjust as needed
        float multiplier = 2.0 * sigma * sigma;
    
        vec4 outputColor = vec4(0.0);
    
        for(int i = -n; i <= n; i++)
        {
            float offset = float(i) * viewSpaceTileSize;
            vec3 offsetViews = views + offset;
    
            vec4 sampleColor = GetViewsColors(tile_uv, offsetViews);
    
            // Calculate the effective discrete view directions based on the tileCount
            vec3 snappedViews = floor(offsetViews * tileCount) / tileCount;
    
            // Calculate Gaussian weights
            vec3 diff = views - snappedViews;
            vec3 weight = exp(-diff * diff / multiplier);
    
            // Accumulate color
            outputColor.rgb += sampleColor.rgb * weight;
        }
        // Normalize the color
        vec3 totalWeight = vec3(0.0);
        for(int i = -n; i <= n; i++)
        {
            float offset = float(i) * viewSpaceTileSize;
            vec3 offsetViews = views + offset;
    
            // Calculate the effective discrete view directions based on the tileCount
            vec3 snappedViews = floor(offsetViews * tileCount) / tileCount;
    
            // Calculate Gaussian weights
            vec3 diff = views - snappedViews;
            vec3 weight = exp(-diff * diff / multiplier);
    
            totalWeight += weight;
        }
    
        outputColor.rgb /= totalWeight;
        outputColor.a = 1.0;
    
        return outputColor;
    }

    float remap(float value, float from1, float to1, float from2, float to2) {
      return (value - from1) / (to1 - from1) * (to2 - from2) + from2;
    }

    out vec4 color;

    void main() {
      if (u_viewType == 2) { // "quilt" view
        color = texture(u_texture, v_texcoord);
        return;
      }
      if (u_viewType == 1) { // middle view
        color = texture(u_texture, GetQuiltCoordinates(v_texcoord.xy, ${Math.round(c/2)}));
        return;
      }

    vec3 views = GetSubpixelViews(v_texcoord);

    if(filter_mode == 0)
        {
            color = GetViewsColors(v_texcoord, views);
        }
        else if(filter_mode == 1)
        {
            color = OldViewFiltering(v_texcoord, views);
        }
        else if(filter_mode == 2)
        {
            color = GaussianViewFiltering(v_texcoord, views);
        }
        else if(filter_mode == 3)
        {
            color = NGaussianViewFiltering(v_texcoord, views, 10);
        }
    }
  `}var ha=1e-6,nr=typeof Float32Array<"u"?Float32Array:Array;function He(){var i=new nr(16);return nr!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i}function da(i,e,t,n,l,c,d,A,m,f,w,E,D,_,O,C,g){return i[0]=e,i[1]=t,i[2]=n,i[3]=l,i[4]=c,i[5]=d,i[6]=A,i[7]=m,i[8]=f,i[9]=w,i[10]=E,i[11]=D,i[12]=_,i[13]=O,i[14]=C,i[15]=g,i}function ar(i,e){var t=e[0],n=e[1],l=e[2],c=e[3],d=e[4],A=e[5],m=e[6],f=e[7],w=e[8],E=e[9],D=e[10],_=e[11],O=e[12],C=e[13],g=e[14],M=e[15],P=t*A-n*d,T=t*m-l*d,B=t*f-c*d,V=n*m-l*A,k=n*f-c*A,W=l*f-c*m,Q=w*C-E*O,J=w*g-D*O,$=w*M-_*O,I=E*g-D*C,G=E*M-_*C,L=D*M-_*g,S=P*L-T*G+B*I+V*$-k*J+W*Q;return S?(S=1/S,i[0]=(A*L-m*G+f*I)*S,i[1]=(l*G-n*L-c*I)*S,i[2]=(C*W-g*k+M*V)*S,i[3]=(D*k-E*W-_*V)*S,i[4]=(m*$-d*L-f*J)*S,i[5]=(t*L-l*$+c*J)*S,i[6]=(g*B-O*W-M*T)*S,i[7]=(w*W-D*B+_*T)*S,i[8]=(d*G-A*$+f*Q)*S,i[9]=(n*$-t*G-c*Q)*S,i[10]=(O*k-C*B+M*P)*S,i[11]=(E*B-w*k-_*P)*S,i[12]=(A*J-d*I-m*Q)*S,i[13]=(t*I-n*J+l*Q)*S,i[14]=(C*T-O*V-g*P)*S,i[15]=(w*V-E*T+D*P)*S,i):null}function or(i,e,t){var n=t[0],l=t[1],c=t[2],d=void 0,A=void 0,m=void 0,f=void 0,w=void 0,E=void 0,D=void 0,_=void 0,O=void 0,C=void 0,g=void 0,M=void 0;return e===i?(i[12]=e[0]*n+e[4]*l+e[8]*c+e[12],i[13]=e[1]*n+e[5]*l+e[9]*c+e[13],i[14]=e[2]*n+e[6]*l+e[10]*c+e[14],i[15]=e[3]*n+e[7]*l+e[11]*c+e[15]):(d=e[0],A=e[1],m=e[2],f=e[3],w=e[4],E=e[5],D=e[6],_=e[7],O=e[8],C=e[9],g=e[10],M=e[11],i[0]=d,i[1]=A,i[2]=m,i[3]=f,i[4]=w,i[5]=E,i[6]=D,i[7]=_,i[8]=O,i[9]=C,i[10]=g,i[11]=M,i[12]=d*n+w*l+O*c+e[12],i[13]=A*n+E*l+C*c+e[13],i[14]=m*n+D*l+g*c+e[14],i[15]=f*n+_*l+M*c+e[15]),i}function lr(i,e,t,n){var l=n[0],c=n[1],d=n[2],A=Math.sqrt(l*l+c*c+d*d),m=void 0,f=void 0,w=void 0,E=void 0,D=void 0,_=void 0,O=void 0,C=void 0,g=void 0,M=void 0,P=void 0,T=void 0,B=void 0,V=void 0,k=void 0,W=void 0,Q=void 0,J=void 0,$=void 0,I=void 0,G=void 0,L=void 0,S=void 0,j=void 0;return A<ha?null:(A=1/A,l*=A,c*=A,d*=A,m=Math.sin(t),f=Math.cos(t),w=1-f,E=e[0],D=e[1],_=e[2],O=e[3],C=e[4],g=e[5],M=e[6],P=e[7],T=e[8],B=e[9],V=e[10],k=e[11],W=l*l*w+f,Q=c*l*w+d*m,J=d*l*w-c*m,$=l*c*w-d*m,I=c*c*w+f,G=d*c*w+l*m,L=l*d*w+c*m,S=c*d*w-l*m,j=d*d*w+f,i[0]=E*W+C*Q+T*J,i[1]=D*W+g*Q+B*J,i[2]=_*W+M*Q+V*J,i[3]=O*W+P*Q+k*J,i[4]=E*$+C*I+T*G,i[5]=D*$+g*I+B*G,i[6]=_*$+M*I+V*G,i[7]=O*$+P*I+k*G,i[8]=E*L+C*S+T*j,i[9]=D*L+g*S+B*j,i[10]=_*L+M*S+V*j,i[11]=O*L+P*S+k*j,e!==i&&(i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i)}function fi(i,e){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i}function ua(i,e,t,n,l){var c=1/Math.tan(e/2),d=void 0;return i[0]=c/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=c,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(d=1/(n-l),i[10]=(l+n)*d,i[14]=2*l*n*d):(i[10]=-1,i[14]=-2*n),i}var Aa=Object.defineProperty,fa=(i,e,t)=>e in i?Aa(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ee=(i,e,t)=>(fa(i,typeof e!="symbol"?e+"":e,t),t);const yi=1.6;var bi;(function(i){i[i.Swizzled=0]="Swizzled",i[i.Center=1]="Center",i[i.Quilt=2]="Quilt"})(bi||(bi={}));class pa extends EventTarget{constructor(e){super(),Ee(this,"_calibration",{configVersion:"1.0",pitch:{value:45},slope:{value:-5},center:{value:-.5},viewCone:{value:40},invView:{value:1},verticalAngle:{value:0},DPI:{value:338},screenW:{value:3840},screenH:{value:2160},flipImageX:{value:0},flipImageY:{value:0},flipSubp:{value:0},serial:"",subpixelCells:[],CellPatternMode:{value:0}}),Ee(this,"_viewControls",{tileHeight:512,numViews:48,trackballX:0,trackballY:0,targetX:0,targetY:yi,targetZ:-.5,targetDiam:2,fovy:14/180*Math.PI,depthiness:1.25,inlineView:bi.Center,capturing:!1,quiltResolution:null,columns:null,rows:null,popup:null,XRSession:null,lkgCanvas:null,appCanvas:null,subpixelMode:1,filterMode:1,gaussianSigma:.01}),Ee(this,"LookingGlassDetected"),this._viewControls={...this._viewControls,...e},this.syncCalibration()}syncCalibration(){new na(e=>{if(e.devices.length<1){console.log("No Looking Glass devices found");return}e.devices.length>1&&console.log("More than one Looking Glass device found... using the first one"),this.calibration=e.devices[0].calibration})}addEventListener(e,t,n){super.addEventListener(e,t,n)}onConfigChange(){this.dispatchEvent(new Event("on-config-changed"))}get calibration(){return this._calibration}set calibration(e){this._calibration={...this._calibration,...e},this.onConfigChange()}updateViewControls(e){e!=null&&(this._viewControls={...this._viewControls,...e},this.onConfigChange())}get tileHeight(){return Math.round(this.framebufferHeight/this.quiltHeight)}get quiltResolution(){if(this._viewControls.quiltResolution!=null)return{width:this._viewControls.quiltResolution.width,height:this._viewControls.quiltResolution.height};{const e=this._calibration.serial;switch(!0){case e.startsWith("LKG-2K"):return{width:4096,height:4096};case e.startsWith("LKG-4K"):return{width:4096,height:4096};case e.startsWith("LKG-8K"):return{width:8192,height:8192};case e.startsWith("LKG-P"):return{width:3360,height:3360};case e.startsWith("LKG-A"):return{width:4096,height:4096};case e.startsWith("LKG-B"):return{width:8192,height:8192};case e.startsWith("LKG-D"):return{width:8192,height:8192};case e.startsWith("LKG-F"):return{width:3360,height:3360};case e.startsWith("LKG-E"):return{width:4092,height:4092};case e.startsWith("LKG-H"):return{width:5995,height:6e3};case e.startsWith("LKG-J"):return{width:5999,height:5999};case e.startsWith("LKG-K"):return{width:8184,height:8184};case e.startsWith("LKG-L"):return{width:8190,height:8190};default:return{width:4096,height:4096}}}}set quiltResolution(e){this.updateViewControls({quiltResolution:e})}get numViews(){return this.quiltWidth*this.quiltHeight}get targetX(){return this._viewControls.targetX}set targetX(e){this.updateViewControls({targetX:e})}get targetY(){return this._viewControls.targetY}set targetY(e){this.updateViewControls({targetY:e})}get targetZ(){return this._viewControls.targetZ}set targetZ(e){this.updateViewControls({targetZ:e})}get trackballX(){return this._viewControls.trackballX}set trackballX(e){this.updateViewControls({trackballX:e})}get trackballY(){return this._viewControls.trackballY}set trackballY(e){this.updateViewControls({trackballY:e})}get targetDiam(){return this._viewControls.targetDiam}set targetDiam(e){this.updateViewControls({targetDiam:e})}get fovy(){return this._viewControls.fovy}set fovy(e){this.updateViewControls({fovy:e})}get depthiness(){return this._viewControls.depthiness}set depthiness(e){this.updateViewControls({depthiness:e})}get inlineView(){return this._viewControls.inlineView}set inlineView(e){this.updateViewControls({inlineView:e})}get capturing(){return this._viewControls.capturing}set capturing(e){this.updateViewControls({capturing:e})}get subpixelMode(){return this._viewControls.subpixelMode}set subpixelMode(e){this.updateViewControls({subpixelMode:e})}get filterMode(){return this._viewControls.filterMode}set filterMode(e){this.updateViewControls({filterMode:e})}get gaussianSigma(){return this._viewControls.gaussianSigma}set gaussianSigma(e){this.updateViewControls({gaussianSigma:e})}get popup(){return this._viewControls.popup}set popup(e){this.updateViewControls({popup:e})}get XRSession(){return this._viewControls.XRSession}set XRSession(e){this.updateViewControls({XRSession:e})}get lkgCanvas(){return this._viewControls.lkgCanvas}set lkgCanvas(e){this.updateViewControls({lkgCanvas:e})}get appCanvas(){return this._viewControls.appCanvas}set appCanvas(e){this.updateViewControls({appCanvas:e})}get columns(){return this._viewControls.columns}set columns(e){this.updateViewControls({columns:e})}get rows(){return this._viewControls.rows}set rows(e){this.updateViewControls({rows:e})}get aspect(){return this._calibration.screenW.value/this._calibration.screenH.value}get tileWidth(){return Math.round(this.framebufferWidth/this.quiltWidth)}get framebufferWidth(){return this.quiltResolution.width}get quiltWidth(){if(this._viewControls.columns!=null)return this._viewControls.columns;const e=this._calibration.serial;switch(!0){case e.startsWith("LKG-2K"):return 5;case e.startsWith("LKG-4K"):return 5;case e.startsWith("LKG-8K"):return 5;case e.startsWith("LKG-P"):return 8;case e.startsWith("LKG-A"):return 5;case e.startsWith("LKG-B"):return 5;case e.startsWith("LKG-D"):return 8;case e.startsWith("LKG-F"):return 8;case e.startsWith("LKG-E"):return 11;case e.startsWith("LKG-H"):return 11;case e.startsWith("LKG-J"):return 7;case e.startsWith("LKG-K"):return 11;case e.startsWith("LKG-L"):return 7;default:return 1}}get quiltHeight(){if(this._viewControls.rows!=null)return this._viewControls.rows;const e=this._calibration.serial;switch(!0){case e.startsWith("LKG-2K"):return 9;case e.startsWith("LKG-4K"):return 9;case e.startsWith("LKG-8K"):return 9;case e.startsWith("LKG-P"):return 6;case e.startsWith("LKG-A"):return 9;case e.startsWith("LKG-B"):return 9;case e.startsWith("LKG-D"):return 9;case e.startsWith("LKG-F"):return 6;case e.startsWith("LKG-E"):return 6;case e.startsWith("LKG-H"):return 6;case e.startsWith("LKG-J"):return 7;case e.startsWith("LKG-K"):return 6;case e.startsWith("LKG-L"):return 7;default:return 1}}get framebufferHeight(){return this.quiltResolution.height}get viewCone(){return this._calibration.viewCone.value*this.depthiness/180*Math.PI}get tilt(){return this._calibration.screenH.value/(this._calibration.screenW.value*this._calibration.slope.value)*(this._calibration.flipImageX.value?-1:1)}get subp(){return 1/(this._calibration.screenW.value*3)*(this._calibration.flipImageX.value?-1:1)}get pitch(){return this._calibration.pitch.value*this._calibration.screenW.value/this._calibration.DPI.value*Math.cos(Math.atan(1/this._calibration.slope.value))}get subpixelCells(){const e=new Float32Array(6*this._calibration.subpixelCells.length);return this._calibration.subpixelCells.forEach((t,n)=>{t.ROffsetX/=this.calibration.screenW.value,t.ROffsetY/=this.calibration.screenH.value,t.GOffsetX/=this.calibration.screenW.value,t.GOffsetY/=this.calibration.screenH.value,t.BOffsetX/=this.calibration.screenW.value,t.BOffsetY/=this.calibration.screenH.value,e[n*6+0]=t.ROffsetX,e[n*6+1]=t.ROffsetY,e[n*6+2]=t.GOffsetX,e[n*6+3]=t.GOffsetY,e[n*6+4]=t.BOffsetX,e[n*6+5]=t.BOffsetY}),e}}let pi=null;function Te(){return pi==null&&(pi=new pa),pi}function cr(i){const e=Te();i!=null&&e.updateViewControls(i)}async function ma(){const i=Te();let e=2;async function t(){if(i.appCanvas!=null)try{i.capturing=!0,await new Promise(d=>{requestAnimationFrame(d)}),i.appCanvas.width=i.quiltResolution.width,i.appCanvas.height=i.quiltResolution.height;let l=i.appCanvas.toDataURL();const c=document.createElement("a");c.style.display="none",c.href=l,c.download=`hologram_qs${i.quiltWidth}x${i.quiltHeight}a${i.aspect}.png`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(l)}catch(l){console.error("Error while capturing canvas data:",l),i.capturing=!1}finally{i.inlineView=e,i.capturing=!1,i.appCanvas.width=i.calibration.screenW.value,i.appCanvas.height=i.calibration.screenH.value}}const n=document.getElementById("screenshotbutton");n&&n.addEventListener("click",()=>{e=i.inlineView;const l=Ti.getInstance();if(!l){console.warn("LookingGlassXRDevice not initialized");return}i.inlineView=2,l.captureScreenshot=!0,setTimeout(()=>{l.screenshotCallback=t},100)})}function va(){var i,e,t,n,l;const c=Te();if(c.lkgCanvas==null)console.warn("window placement called without a valid XR Session!");else{let d=function(){let g=C.d-C.a,M=C.w-C.s;g&&M&&(g*=Math.sqrt(.5),M*=Math.sqrt(.5));const P=c.trackballX,T=c.trackballY,B=Math.cos(P)*g-Math.sin(P)*Math.cos(T)*M,V=-Math.sin(T)*M,k=-Math.sin(P)*g-Math.cos(P)*Math.cos(T)*M;c.targetX=c.targetX+B*c.targetDiam*.03,c.targetY=c.targetY+V*c.targetDiam*.03,c.targetZ=c.targetZ+k*c.targetDiam*.03,requestAnimationFrame(d)};const A=document.createElement("style");document.head.appendChild(A),(i=A.sheet)==null||i.insertRule("#LookingGlassWebXRControls * { all: revert; font-family: sans-serif }");const m=document.createElement("div");m.id="LookingGlassWebXRControls",m.style.position="fixed",m.style.zIndex="1000",m.style.padding="15px",m.style.width="320px",m.style.maxWidth="calc(100vw - 18px)",m.style.maxHeight="calc(100vh - 18px)",m.style.whiteSpace="nowrap",m.style.background="rgba(0, 0, 0, 0.6)",m.style.color="white",m.style.borderRadius="10px",m.style.right="15px",m.style.bottom="15px",m.style.flex="row";const f=document.createElement("div");m.appendChild(f),f.style.width="100%",f.style.textAlign="center",f.style.fontWeight="bold",f.style.marginBottom="8px",f.innerText="Looking Glass Controls";const w=document.createElement("button");w.style.display="block",w.style.margin="auto",w.style.width="100%",w.style.height="35px",w.style.padding="4px",w.style.marginBottom="8px",w.style.borderRadius="8px",w.id="screenshotbutton",m.appendChild(w),w.innerText="Save Hologram",c.quiltResolution.height*c.quiltResolution.width>33177600?(w.style.backgroundColor="#ccc",w.style.color="#999",w.style.cursor="not-allowed",w.title="Button is disabled because the quilt resolution is too large."):(w.style.backgroundColor="",w.style.color="",w.style.cursor="",w.title="");const E=document.createElement("button");E.style.display="block",E.style.margin="auto",E.style.width="100%",E.style.height="35px",E.style.padding="4px",E.style.marginBottom="8px",E.style.borderRadius="8px",E.id="copybutton",m.appendChild(E),E.innerText="Copy Config",E.addEventListener("click",()=>{wa(c)});const D=document.createElement("div");m.appendChild(D),D.style.width="290px",D.style.whiteSpace="normal",D.style.color="rgba(255,255,255,0.7)",D.style.fontSize="14px",D.style.margin="5px 0",D.innerHTML="Click the popup and use WASD, mouse left/right drag, and scroll.";const _=document.createElement("div");m.appendChild(_);const O=(g,M,P)=>{const T=P.stringify,B=document.createElement("div");B.style.marginBottom="8px",_.appendChild(B);const V=g,k=c[g],W=document.createElement("label");B.appendChild(W),W.innerText=P.label,W.setAttribute("for",V),W.style.width="100px",W.style.display="inline-block",W.style.textDecoration="dotted underline 1px",W.style.fontFamily='"Courier New"',W.style.fontSize="13px",W.style.fontWeight="bold",W.title=P.title;const Q=document.createElement("input");B.appendChild(Q),Object.assign(Q,M),Q.id=V,Q.title=P.title,Q.value=M.value!==void 0?M.value:k;const J=G=>{c[g]=G,I(G)};Q.oninput=()=>{const G=M.type==="range"?parseFloat(Q.value):M.type==="checkbox"?Q.checked:Q.value;J(G)};const $=G=>{let L=G(c[g]);P.fixRange&&(L=P.fixRange(L),Q.max=Math.max(parseFloat(Q.max),L).toString(),Q.min=Math.min(parseFloat(Q.min),L).toString()),Q.value=L,J(L)};M.type==="range"&&(Q.style.width="110px",Q.style.height="8px",Q.onwheel=G=>{$(L=>L+Math.sign(G.deltaX-G.deltaY)*M.step)});let I=G=>{};if(T){const G=document.createElement("span");G.style.fontFamily='"Courier New"',G.style.fontSize="13px",G.style.marginLeft="3px",B.appendChild(G),I=L=>{G.innerHTML=T(L)},I(k)}return $};O("fovy",{type:"range",min:1/180*Math.PI,max:120.1/180*Math.PI,step:1/180*Math.PI},{label:"fov",title:"perspective fov (degrades stereo effect)",fixRange:g=>Math.max(1/180*Math.PI,Math.min(g,120.1/180*Math.PI)),stringify:g=>{const M=g/Math.PI*180,P=Math.atan(Math.tan(g/2)*c.aspect)*2/Math.PI*180;return`${M.toFixed()}&deg;&times;${P.toFixed()}&deg;`}}),O("depthiness",{type:"range",min:0,max:2,step:.01},{label:"depthiness",title:"exaggerates depth by multiplying the width of the view cone (as reported by the firmware) - can somewhat compensate for depthiness lost using higher fov.",fixRange:g=>Math.max(0,g),stringify:g=>`${g.toFixed(2)}x`}),O("inlineView",{type:"range",min:0,max:2,step:1},{label:"inline view",title:"what to show inline on the original canvas (swizzled = no overwrite)",fixRange:g=>Math.max(0,Math.min(g,2)),stringify:g=>g===0?"swizzled":g===1?"center":g===2?"quilt":"?"}),O("filterMode",{type:"range",min:0,max:3,step:1},{label:"view filtering mode",title:"controls the method used for view blending",fixRange:g=>Math.max(0,Math.min(g,2)),stringify:g=>g===0?"old, studio style":g===1?"2 view":g===2?"gaussian":g===3?"10 view gaussian":"?"}),O("gaussianSigma",{type:"range",min:-1,max:1,step:.01},{label:"gaussian sigma",title:"control view blending",fixRange:g=>Math.max(-1,Math.min(g,1)),stringify:g=>g}),c.lkgCanvas.oncontextmenu=g=>{g.preventDefault()},c.lkgCanvas.addEventListener("wheel",g=>{const M=c.targetDiam,P=1.1,T=Math.log(M)/Math.log(P);return c.targetDiam=Math.pow(P,T+g.deltaY*.01)},{passive:!1}),c.lkgCanvas.addEventListener("mousemove",g=>{const M=g.movementX,P=-g.movementY;if(g.buttons&2||g.buttons&1&&(g.shiftKey||g.ctrlKey)){const T=c.trackballX,B=c.trackballY,V=-Math.cos(T)*M+Math.sin(T)*Math.sin(B)*P,k=-Math.cos(B)*P,W=Math.sin(T)*M+Math.cos(T)*Math.sin(B)*P;c.targetX=c.targetX+V*c.targetDiam*.001,c.targetY=c.targetY+k*c.targetDiam*.001,c.targetZ=c.targetZ+W*c.targetDiam*.001}else g.buttons&1&&(c.trackballX=c.trackballX-M*.01,c.trackballY=c.trackballY-P*.01)});const C={w:0,a:0,s:0,d:0};return c.lkgCanvas.addEventListener("keydown",g=>{switch(g.code){case"KeyW":C.w=1;break;case"KeyA":C.a=1;break;case"KeyS":C.s=1;break;case"KeyD":C.d=1;break}}),c.lkgCanvas.addEventListener("keyup",g=>{switch(g.code){case"KeyW":C.w=0;break;case"KeyA":C.a=0;break;case"KeyS":C.s=0;break;case"KeyD":C.d=0;break}}),(e=c.appCanvas)==null||e.addEventListener("wheel",g=>{const M=c.targetDiam,P=1.1,T=Math.log(M)/Math.log(P);return c.targetDiam=Math.pow(P,T+g.deltaY*.01)},{passive:!1}),(t=c.appCanvas)==null||t.addEventListener("mousemove",g=>{const M=g.movementX,P=-g.movementY;if(g.buttons&2||g.buttons&1&&(g.shiftKey||g.ctrlKey)){const T=c.trackballX,B=c.trackballY,V=-Math.cos(T)*M+Math.sin(T)*Math.sin(B)*P,k=-Math.cos(B)*P,W=Math.sin(T)*M+Math.cos(T)*Math.sin(B)*P;c.targetX=c.targetX+V*c.targetDiam*.001,c.targetY=c.targetY+k*c.targetDiam*.001,c.targetZ=c.targetZ+W*c.targetDiam*.001}else g.buttons&1&&(c.trackballX=c.trackballX-M*.01,c.trackballY=c.trackballY-P*.01)}),(n=c.appCanvas)==null||n.addEventListener("keydown",g=>{switch(g.code){case"KeyW":C.w=1;break;case"KeyA":C.a=1;break;case"KeyS":C.s=1;break;case"KeyD":C.d=1;break}}),(l=c.appCanvas)==null||l.addEventListener("keyup",g=>{switch(g.code){case"KeyW":C.w=0;break;case"KeyA":C.a=0;break;case"KeyS":C.s=0;break;case"KeyD":C.d=0;break}}),requestAnimationFrame(d),setTimeout(()=>{ma()},1e3),m}}function wa(i){const e={targetX:i.targetX,targetY:i.targetY,targetZ:i.targetZ,fovy:`${Math.round(i.fovy/Math.PI*180)} * Math.PI / 180`,targetDiam:i.targetDiam,trackballX:i.trackballX,trackballY:i.trackballY,depthiness:i.depthiness};let t=JSON.stringify(e,null,4).replace(/"/g,"").replace(/{/g,"").replace(/}/g,"");navigator.clipboard.writeText(t)}let zt;const ga=(i,e)=>{const t=Te();if(t.lkgCanvas==null){console.warn("window placement called without a valid XR Session!");return}else i==!1?ba(t,zt):(zt==null&&(zt=va()),t.lkgCanvas.style.position="fixed",t.lkgCanvas.style.bottom="0",t.lkgCanvas.style.left="0",t.lkgCanvas.width=t.calibration.screenW.value,t.lkgCanvas.height=t.calibration.screenH.value,document.body.appendChild(zt),"getScreenDetails"in window?ya(t.lkgCanvas,t,e):Gr(t,t.lkgCanvas,e))};async function ya(i,e,t){const n=(await window.getScreenDetails()).screens.filter(l=>l.label.includes("LKG"))[0];if(n===void 0){console.log("no Looking Glass monitor detected - manually opening popup window"),Gr(e,i,t);return}else{const l=[`left=${n.left}`,`top=${n.top}`,`width=${n.width}`,`height=${n.height}`,"menubar=no","toolbar=no","location=no","status=no","resizable=yes","scrollbars=no","fullscreenEnabled=true"].join(",");e.popup=window.open("","new",l),e.popup&&(e.popup.document.body.style.background="black",e.popup.document.body.style.transform="1.0",kr(e),e.popup.document.body.appendChild(i),console.assert(t),e.popup.onbeforeunload=t)}}function Gr(i,e,t){i.popup=window.open("",void 0,"width=640,height=360"),i.popup&&(i.popup.document.title="Looking Glass Window (fullscreen me on Looking Glass!)",i.popup.document.body.style.background="black",i.popup.document.body.style.transform="1.0",kr(i),i.popup.document.body.appendChild(e),console.assert(t),i.popup.onbeforeunload=t)}function ba(i,e){var t;(t=e.parentElement)==null||t.removeChild(e),i.popup&&(i.popup.onbeforeunload=null,i.popup.close(),i.popup=null)}function kr(i){i.popup&&i.popup.document.addEventListener("keydown",e=>{e.ctrlKey&&(e.key==="="||e.key==="-"||e.key==="+")&&e.preventDefault()})}const Le=Symbol("LookingGlassXRWebGLLayer");class Ea extends Dr{constructor(e,t,n){super(e,t,n);const l=Te();l.appCanvas=t.canvas,l.lkgCanvas=document.createElement("canvas"),l.lkgCanvas.tabIndex=0;const c=l.lkgCanvas.getContext("2d",{alpha:!1});l.lkgCanvas.addEventListener("dblclick",function(){this.requestFullscreen()});const d=this[Je].config,A=t.createTexture();let m,f;const w=t.createFramebuffer(),E=t.enable.bind(t),D=t.disable.bind(t),_=t.getExtension("OES_vertex_array_object"),O=34229,C=_?_.bindVertexArrayOES.bind(_):t.bindVertexArray.bind(t),g=()=>{const se=t.getParameter(t.TEXTURE_BINDING_2D);if(t.bindTexture(t.TEXTURE_2D,A),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,l.framebufferWidth,l.framebufferHeight,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_BASE_LEVEL,0),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAX_LEVEL,0),t.bindTexture(t.TEXTURE_2D,se),m){const pe=t.getParameter(t.RENDERBUFFER_BINDING);t.bindRenderbuffer(t.RENDERBUFFER,m),t.renderbufferStorage(t.RENDERBUFFER,f.format,l.framebufferWidth,l.framebufferHeight),t.bindRenderbuffer(t.RENDERBUFFER,pe)}};(d.depth||d.stencil)&&(d.depth&&d.stencil?f={format:t.DEPTH_STENCIL,attachment:t.DEPTH_STENCIL_ATTACHMENT}:d.depth?f={format:t.DEPTH_COMPONENT16,attachment:t.DEPTH_ATTACHMENT}:d.stencil&&(f={format:t.STENCIL_INDEX8,attachment:t.STENCIL_ATTACHMENT}),m=t.createRenderbuffer()),g(),l.addEventListener("on-config-changed",g);const M=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,w),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,A,0),(d.depth||d.stencil)&&t.framebufferRenderbuffer(t.FRAMEBUFFER,f.attachment,t.RENDERBUFFER,m),t.bindFramebuffer(t.FRAMEBUFFER,M);const P=t.createProgram();if(!P)return;const T=t.createShader(t.VERTEX_SHADER);if(!T)return;t.attachShader(P,T);const B=t.createShader(t.FRAGMENT_SHADER);if(!B)return;t.attachShader(P,B),t.shaderSource(T,`#version 300 es
			in vec2 a_position;
			out vec2 v_texcoord;
			void main() {
			  gl_Position = vec4(a_position * 2.0 - 1.0, 0.0, 1.0);
			  v_texcoord = a_position;
			}
		  `),t.compileShader(T),t.getShaderParameter(T,t.COMPILE_STATUS)||console.warn(t.getShaderInfoLog(T));let V,k,W;const Q=()=>{const se=ca(l);if(se===V||(V=se,!B))return;if(t.shaderSource(B,se),t.compileShader(B),!t.getShaderParameter(B,t.COMPILE_STATUS)){console.warn(t.getShaderInfoLog(B));return}if(!P)return;if(t.linkProgram(P),!t.getProgramParameter(P,t.LINK_STATUS)){console.warn(t.getProgramInfoLog(P));return}k=t.getAttribLocation(P,"a_position"),W=t.getUniformLocation(P,"u_viewType");const pe=t.getUniformLocation(P,"u_texture"),Oe=t.getUniformLocation(P,"subpixelData"),Fe=t.getParameter(t.CURRENT_PROGRAM);t.useProgram(P),t.uniform1i(pe,0),t.uniform1fv(Oe,l.subpixelCells),t.useProgram(Fe)};l.addEventListener("on-config-changed",Q);const J=_?_.createVertexArrayOES():t.createVertexArray(),$=t.createBuffer(),I=t.getParameter(t.ARRAY_BUFFER_BINDING),G=t.getParameter(O);C(J),t.bindBuffer(t.ARRAY_BUFFER,$),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),t.STATIC_DRAW),t.enableVertexAttribArray(k),t.vertexAttribPointer(k,2,t.FLOAT,!1,0,0),C(G),t.bindBuffer(t.ARRAY_BUFFER,I);const L=()=>{console.assert(this[Le].LookingGlassEnabled),t.bindFramebuffer(t.FRAMEBUFFER,w);const se=t.getParameter(t.COLOR_CLEAR_VALUE),pe=t.getParameter(t.DEPTH_CLEAR_VALUE),Oe=t.getParameter(t.STENCIL_CLEAR_VALUE);t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(0),t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),t.clearColor(se[0],se[1],se[2],se[3]),t.clearDepth(pe),t.clearStencil(Oe)},S=t.canvas;let j,X;const Z=()=>{if(!this[Le].LookingGlassEnabled)return;(S.width!==l.calibration.screenW.value||S.height!==l.calibration.screenH.value)&&l.capturing===!1?(j=S.width,X=S.height,S.width=l.calibration.screenW.value,S.height=l.calibration.screenH.value):l.capturing===!0&&(j=S.width,X=S.height,S.width=l.framebufferWidth,S.height=l.framebufferHeight);const se=t.getParameter(O),pe=t.getParameter(t.CULL_FACE),Oe=t.getParameter(t.BLEND),Fe=t.getParameter(t.DEPTH_TEST),Ye=t.getParameter(t.STENCIL_TEST),Ne=t.getParameter(t.SCISSOR_TEST),ve=t.getParameter(t.VIEWPORT),ot=t.getParameter(t.FRAMEBUFFER_BINDING),ei=t.getParameter(t.RENDERBUFFER_BINDING),Gt=t.getParameter(t.CURRENT_PROGRAM),lt=t.getParameter(t.ACTIVE_TEXTURE);{const kt=t.getParameter(t.TEXTURE_BINDING_2D);t.bindFramebuffer(t.FRAMEBUFFER,null),t.useProgram(P),C(J),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,A),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),t.uniform1i(W,0),t.drawArrays(t.TRIANGLES,0,6),c==null||c.clearRect(0,0,l.calibration.screenW.value,l.calibration.screenH.value),c==null||c.drawImage(S,0,0),l.inlineView!==0&&(t.uniform1i(W,l.inlineView),t.drawArrays(t.TRIANGLES,0,6)),t.bindTexture(t.TEXTURE_2D,kt)}t.activeTexture(lt),t.useProgram(Gt),t.bindRenderbuffer(t.RENDERBUFFER,ei),t.bindFramebuffer(t.FRAMEBUFFER,ot),t.viewport(...ve),(Ne?E:D)(t.SCISSOR_TEST),(Ye?E:D)(t.STENCIL_TEST),(Fe?E:D)(t.DEPTH_TEST),(Oe?E:D)(t.BLEND),(pe?E:D)(t.CULL_FACE),C(se)};this[Le]={LookingGlassEnabled:!1,framebuffer:w,clearFramebuffer:L,blitTextureToDefaultFramebufferIfNeeded:Z,moveCanvasToWindow:ga,restoreOriginalCanvasDimensions:()=>{j&&X&&(S.width=j,S.height=X,j=X=void 0)}}}get framebuffer(){return this[Le].LookingGlassEnabled?this[Le].framebuffer:null}get framebufferWidth(){return Te().framebufferWidth}get framebufferHeight(){return Te().framebufferHeight}}const Xt=class extends Ci{constructor(i){super(i),this.sessions=new Map,this.viewSpaces=[],this.basePoseMatrix=He(),this.inlineProjectionMatrix=He(),this.inlineInverseViewMatrix=He(),this.LookingGlassProjectionMatrices=[],this.LookingGlassInverseViewMatrices=[],this.captureScreenshot=!1,this.screenshotCallback=null,Xt.instance||(Xt.instance=this)}static getInstance(){return Xt.instance}onBaseLayerSet(i,e){const t=this.sessions.get(i);t.baseLayer=e;const n=Te(),l=e[Le];l.LookingGlassEnabled=t.immersive,t.immersive&&(n.XRSession=this.sessions.get(i),n.popup==null?l.moveCanvasToWindow(!0,()=>{this.endSession(i)}):console.warn("attempted to assign baselayer twice?"))}isSessionSupported(i){return i==="inline"||i==="immersive-vr"}isFeatureSupported(i){switch(i){case"viewer":return!0;case"local":return!0;case"local-floor":return!0;case"bounded-floor":return!1;case"unbounded":return!1;default:return console.warn("LookingGlassXRDevice.isFeatureSupported: feature not understood:",i),!1}}async requestSession(i,e){if(!this.isSessionSupported(i))return Promise.reject();const t=i!=="inline",n=new Sa(i,e),l=Te();return this.sessions.set(n.id,n),t&&(this.dispatchEvent("@@webxr-polyfill/vr-present-start",n.id),window.addEventListener("unload",()=>{l.popup&&l.popup.close(),l.popup=null})),Promise.resolve(n.id)}requestAnimationFrame(i){return this.global.requestAnimationFrame(i)}cancelAnimationFrame(i){this.global.cancelAnimationFrame(i)}onFrameStart(i,e){const t=this.sessions.get(i),n=Te();if(t.immersive){const l=Math.tan(.5*n.fovy),c=.5*n.targetDiam/l,d=c-n.targetDiam,A=this.basePoseMatrix;fi(A,[n.targetX,n.targetY,n.targetZ]),lr(A,A,n.trackballX,[0,1,0]),lr(A,A,-n.trackballY,[1,0,0]),or(A,A,[0,0,c]);for(let m=0;m<n.numViews;++m){const f=(m+.5)/n.numViews-.5,w=Math.tan(n.viewCone*f),E=c*w,D=this.LookingGlassInverseViewMatrices[m]=this.LookingGlassInverseViewMatrices[m]||He();or(D,A,[E,0,0]),ar(D,D);const _=Math.max(d+e.depthNear,.01),O=d+e.depthFar,C=_*l,g=C,M=-C,P=_*-w,T=n.aspect*C,B=P+T,V=P-T,k=this.LookingGlassProjectionMatrices[m]=this.LookingGlassProjectionMatrices[m]||He();da(k,2*_/(B-V),0,0,0,0,2*_/(g-M),0,0,(B+V)/(B-V),(g+M)/(g-M),-(O+_)/(O-_),-1,0,0,-2*O*_/(O-_),0)}}else{const l=t.baseLayer.context,c=l.drawingBufferWidth/l.drawingBufferHeight;ua(this.inlineProjectionMatrix,e.inlineVerticalFieldOfView,c,e.depthNear,e.depthFar),fi(this.basePoseMatrix,[0,yi,0]),ar(this.inlineInverseViewMatrix,this.basePoseMatrix),t.baseLayer[Le].clearFramebuffer()}}onFrameEnd(i){this.sessions.get(i).baseLayer[Le].blitTextureToDefaultFramebufferIfNeeded(),this.captureScreenshot&&this.screenshotCallback&&(this.screenshotCallback(),this.captureScreenshot=!1)}async requestFrameOfReferenceTransform(i,e){const t=He();switch(i){case"viewer":case"local":return fi(t,[0,-yi,0]),t;case"local-floor":return t;default:throw new Error("XRReferenceSpaceType not understood")}}endSession(i){const e=this.sessions.get(i);e.immersive&&e.baseLayer&&(e.baseLayer[Le].moveCanvasToWindow(!1),e.baseLayer[Le].LookingGlassEnabled=!1,e.baseLayer[Le].restoreOriginalCanvasDimensions(),this.dispatchEvent("@@webxr-polyfill/vr-present-end",i)),e.ended=!0}doesSessionSupportReferenceSpace(i,e){const t=this.sessions.get(i);return t.ended?!1:t.enabledFeatures.has(e)}getViewSpaces(i){if(i==="immersive-vr"){const e=Te();for(let t=this.viewSpaces.length;t<e.numViews;++t)this.viewSpaces[t]=new _a(t);return this.viewSpaces.length=e.numViews,this.viewSpaces}}getViewport(i,e,t,n,l){if(l===void 0){const c=this.sessions.get(i).baseLayer.context;n.x=0,n.y=0,n.width=c.drawingBufferWidth,n.height=c.drawingBufferHeight}else{const c=Te(),d=l%c.quiltWidth,A=Math.floor(l/c.quiltWidth);n.x=c.framebufferWidth/c.quiltWidth*d,n.y=c.framebufferHeight/c.quiltHeight*A,n.width=c.framebufferWidth/c.quiltWidth,n.height=c.framebufferHeight/c.quiltHeight}return!0}getProjectionMatrix(i,e){return e===void 0?this.inlineProjectionMatrix:this.LookingGlassProjectionMatrices[e]||He()}getBasePoseMatrix(){return this.basePoseMatrix}getBaseViewMatrix(){return this.inlineInverseViewMatrix}_getViewMatrixByIndex(i){return this.LookingGlassInverseViewMatrices[i]=this.LookingGlassInverseViewMatrices[i]||He()}getInputSources(){return[]}getInputPose(i,e,t){return null}onWindowResize(){}};let Ti=Xt;Ee(Ti,"instance",null);let xa=0;class Sa{constructor(e,t){Ee(this,"mode"),Ee(this,"immersive"),Ee(this,"id"),Ee(this,"baseLayer"),Ee(this,"inlineVerticalFieldOfView"),Ee(this,"ended"),Ee(this,"enabledFeatures"),this.mode=e,this.immersive=e==="immersive-vr"||e==="immersive-ar",this.id=++xa,this.baseLayer=null,this.inlineVerticalFieldOfView=Math.PI*.5,this.ended=!1,this.enabledFeatures=t}}class _a extends nt{constructor(e){super(),Ee(this,"viewIndex"),this.viewIndex=e}get eye(){return"none"}_onPoseUpdate(e){this._inverseBaseMatrix=e._getViewMatrixByIndex(this.viewIndex)}}class Fi extends ta{constructor(e){super(),Ee(this,"vrButton"),Ee(this,"device"),Ee(this,"isPresenting",!1),cr(e),this.loadPolyfill()}static async init(e){new Fi(e)}async loadPolyfill(){this.overrideDefaultVRButton(),console.warn('Looking Glass WebXR "polyfill" overriding native WebXR API.');for(const e in Pt)this.global[e]=Pt[e];this.global.XRWebGLLayer=Ea,this.injected=!0,this.device=new Ti(this.global),this.xr=new Er(Promise.resolve(this.device)),Object.defineProperty(this.global.navigator,"xr",{value:this.xr,configurable:!0})}async overrideDefaultVRButton(){this.vrButton=await Ma("VRButton"),this.vrButton&&this.device?(this.device.addEventListener("@@webxr-polyfill/vr-present-start",()=>{this.isPresenting=!0,this.updateVRButtonUI()}),this.device.addEventListener("@@webxr-polyfill/vr-present-end",()=>{this.isPresenting=!1,this.updateVRButtonUI()}),this.vrButton.addEventListener("click",e=>{this.updateVRButtonUI()}),this.updateVRButtonUI()):console.warn("Unable to find VRButton")}async updateVRButtonUI(){if(this.vrButton){await Ra(100),this.isPresenting?this.vrButton.innerHTML="EXIT LOOKING GLASS":this.vrButton.innerHTML="ENTER LOOKING GLASS";const e=220;this.vrButton.style.width=`${e}px`,this.vrButton.style.left=`calc(50% - ${e/2}px)`}}update(e){cr(e)}}async function Ma(i){return new Promise(e=>{const t=new MutationObserver(function(n){n.forEach(function(l){l.addedNodes.forEach(function(c){const d=c;d.id===i&&(e(d),t.disconnect())})})});t.observe(document.body,{subtree:!1,childList:!0}),setTimeout(()=>{t.disconnect(),e(null)},5e3)})}function Ra(i){return new Promise(e=>setTimeout(e,i))}const Dt=Te();class at{static createButton(e,t={}){const n=document.createElement("button");function l(){let f=null;async function w(_){_.addEventListener("end",E),await e.xr.setSession(_),n.textContent="EXIT VR",f=_}function E(){f.removeEventListener("end",E),n.textContent="ENTER VR",f=null}n.style.display="",n.style.cursor="pointer",n.style.left="calc(50% - 50px)",n.style.width="100px",n.textContent="ENTER VR";const D={...t,optionalFeatures:["local-floor","bounded-floor","layers",...t.optionalFeatures||[]]};n.onmouseenter=function(){n.style.opacity="1.0"},n.onmouseleave=function(){n.style.opacity="0.5"},n.onclick=function(){f===null?navigator.xr.requestSession("immersive-vr",D).then(w):(f.end(),navigator.xr.offerSession!==void 0&&navigator.xr.offerSession("immersive-vr",D).then(w).catch(_=>{console.warn(_)}))},navigator.xr.offerSession!==void 0&&navigator.xr.offerSession("immersive-vr",D).then(w).catch(_=>{console.warn(_)})}function c(){n.style.display="",n.style.cursor="auto",n.style.left="calc(50% - 75px)",n.style.width="150px",n.onmouseenter=null,n.onmouseleave=null,n.onclick=null}function d(){c(),n.textContent="VR NOT SUPPORTED"}function A(f){c(),console.warn("Exception when trying to call xr.isSessionSupported",f),n.textContent="VR NOT ALLOWED"}function m(f){f.style.position="absolute",f.style.bottom="20px",f.style.padding="12px 6px",f.style.border="1px solid #fff",f.style.borderRadius="4px",f.style.background="rgba(0,0,0,0.1)",f.style.color="#fff",f.style.font="normal 13px sans-serif",f.style.textAlign="center",f.style.opacity="0.5",f.style.outline="none",f.style.zIndex="999"}if("xr"in navigator)return n.id="VRButton",n.style.display="none",m(n),navigator.xr.isSessionSupported("immersive-vr").then(function(f){f?l():d(),f&&at.xrSessionIsGranted&&n.click()}).catch(A),n;{const f=document.createElement("a");return window.isSecureContext===!1?(f.href=document.location.href.replace(/^http:/,"https:"),f.innerHTML="WEBXR NEEDS HTTPS"):(f.href="https://immersiveweb.dev/",f.innerHTML="WEBXR NOT AVAILABLE"),f.style.left="calc(50% - 90px)",f.style.width="180px",f.style.textDecoration="none",m(f),f}}static registerSessionGrantedListener(){if(typeof navigator<"u"&&"xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",()=>{at.xrSessionIsGranted=!0})}}}at.xrSessionIsGranted=!1;at.registerSessionGrantedListener();const Rt=420,Ot=560,Ca=.5,Vr=6.1*.0254,Ta=Vr*Rt/Ot,Fa="https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/aristea_wreck_puresky_2k.hdr",Pa="https://raw.githubusercontent.com/gkjohnson/ldraw-parts-library/master/colors/ldcfgalt.ldr",Da="https://raw.githubusercontent.com/gkjohnson/ldraw-parts-library/master/complete/ldraw/",Jt={"X-Wing":"https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/models/ldraw/officialLibrary/models/7140-1-X-wingFighter.mpd_Packed.mpd","UCS AT-ST":"https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/models/ldraw/officialLibrary/models/10174-1-ImperialAT-ST-UCS.mpd_Packed.mpd","Death Star":"https://raw.githubusercontent.com/gkjohnson/ldraw-parts-library/master/models/10143-1 - Death Star II.mpd","Lunar Vehicle":"https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/models/ldraw/officialLibrary/models/1621-1-LunarMPVVehicle.mpd_Packed.mpd"};["6814-1 - Ice Tunnelator.mpd","6861-2 - Super Model Building Instruction.mpd","75060 - Slave I.mpd","6983-1 - Ice Station Odyssey.mpd","6835-1 - Saucer Scout.mpd","21311 - Voltron - Voltron.mpd","21303 - WALLE.mpd","1180-1 - Space Port Moon Buggy.mpd","10179-1 - Millennium Falcon - UCS.mpd","6232-1 - Skeleton Crew.mpd","6235 - Buried Treasure.mpd"].forEach(i=>{const e=i.replace(/.+?\s-\s/,"").replace(/\.mpd$/,"");Jt[e]=`https://raw.githubusercontent.com/gkjohnson/ldraw-parts-library/master/models/${i}`});const hr=decodeURI(window.location.hash.replace(/^#/,"")),ie={enable:!0,model:hr in Jt?hr:"Voltron - Voltron",renderScale:1,tiles:1,samplesPerFrame:1,bounces:5,filterGlossyFactor:.5,pause:!1,tiltingPreview:!0,animationSpeed:1,numViews:54,viewCone:35,viewerDistance:Ca,saveQuilt:()=>{Ba()}};let Mt,Nr,Ur,qe,Ei,re,Ce,Y,Kt,Ct,dr,it,Wr;const ur=new pr;let Ue=zr(ie.numViews);Ia();async function Ia(){Ur=document.getElementById("distance"),Mt=document.getElementById("loading"),Nr=document.getElementById("samples"),re=new ys({antialias:!0}),re.toneMapping=bs,re.physicallyCorrectLights=!0,re.xr.enabled=!0,document.body.appendChild(re.domElement),it=new Es;const i=window.innerWidth/window.innerHeight;Ce=new zs(60,i,.025,500),Ce.position.set(.43,.06,-.2).normalize().multiplyScalar(.48),Ce.bokehSize=0,Y=new Ys(re),Y.tiles.set(ie.tiles,ie.tiles),Y.camera=Ce,Ce.fov=Y.viewFoV*Ht.RAD2DEG,Ce.updateProjectionMatrix(),Kt=new Gi(new xs({map:Y.target.texture,blending:fr})),Ct=new Gi(new Xs({quiltMap:Y.target.texture,quiltDimensions:Y.quiltDimensions,aspectRatio:Y.displayAspect})),dr=new Us(Ce,re.domElement),dr.addEventListener("change",()=>{Y.reset()}),new Ls().load(Fa,c=>{c.mapping=Ss,it.environment=c,it.background=c,Y.material.envMapInfo.updateFrom(c),Y.reset()});let e=!1;const t=new _s;t.onProgress=(c,d,A)=>{if(e)return;const m=Math.floor(100*d/A);Mt.innerText=`Loading : ${m}%`};let n;const l=new Bs(t);await l.preloadMaterials(Pa),l.setPartsLibraryPath(Da).loadAsync(Jt[ie.model]).then(c=>{const d=Os.mergeObject(c);d.rotation.set(Math.PI,0,0);const A=[];d.traverse(M=>{M.isLineSegments&&A.push(M),M.isMesh&&(M.material.roughness*=.25)}),A.forEach(M=>{M.parent.remove(M)}),Ga(d,1.4);const m=Vs(2048),f=new Ms(new Rs,new Cs({map:m,transparent:!0,color:1118481,roughness:.2,metalness:.2,side:Ts}));f.scale.setScalar(5),f.rotation.x=-Math.PI/2;const w=new Fs;w.setFromObject(d),d.position.addScaledVector(w.min,-.5).addScaledVector(w.max,-.5);const E=new Ps;w.getBoundingSphere(E);const D=Math.sqrt(w.min.x**2+w.min.z**2),_=.06/Math.min(D,E.radius),O=.14/(w.max.y-w.min.y),C=Math.min(_,O);d.scale.setScalar(C),d.position.multiplyScalar(C),d.updateMatrixWorld(),w.setFromObject(d);const g=new Ds;return f.position.y=w.min.y,g.add(d,f),g.updateMatrixWorld(!0),n=new Ns,n.generate(g,{onProgress:M=>{const P=Math.floor(100*M);Mt.innerText=`Building BVH : ${P}%`}})}).then(c=>{it.add(c.scene);const{bvh:d,textures:A,materials:m,geometry:f}=c,w=Y.material;w.bvh.updateFrom(d),w.attributesArray.updateFrom(f.attributes.normal,f.attributes.tangent,f.attributes.uv,f.attributes.color),w.materialIndexAttribute.updateFrom(f.attributes.materialIndex),w.textures.setTextures(re,A,2048,2048),w.materials.updateFrom(m,A),n.dispose(),Mt.style.visibility="hidden",re.domElement.style.visibility="visible",Y.reset(),new Fi,document.body.append(at.createButton(re)),re.setAnimationLoop(La)}).catch(c=>{e=!0,Mt.innerText="Failed to load model. "+c.message}),Ei=new ks,document.body.appendChild(Ei.dom),Dt.tileHeight=Ot,Dt.numViews=ie.numViews,Dt.inlineView=2,xi(),Tt(),Oa(),window.addEventListener("resize",xi)}function La(){if(it.environment){if(re.xr.enabled=!1,Ei.update(),(Y.samples<1||!ie.enable)&&re.render(it,Ce),ie.enable){if(Y.material.filterGlossyFactor=ie.filterGlossyFactor,Y.material.bounces=ie.bounces,Y.material.physicalCamera.updateFrom(Ce),Ce.updateMatrixWorld(),!ie.pause||Y.samples<1)for(let i=0,e=ie.samplesPerFrame;i<e;i++)Y.update();if(re.autoClear=!1,Y.samples>1&&ie.tiltingPreview&&!re.xr.isPresenting){const i=(.5+.5*Math.sin(ie.animationSpeed*window.performance.now()*.0025))*Y.viewCount;Ct.material.displayIndex=Math.floor(i),Ct.material.aspectRatio=Y.displayAspect*window.innerHeight/window.innerWidth,Ct.material.heightScale=Math.min(Ot/window.innerHeight,1),Ct.render(re)}else re.xr.isPresenting?(Dt.numViews=Y.samples<1?1:ie.numViews,re.getViewport(ur),re.setViewport(0,0,Ue.quiltWidth,Ue.quiltHeight),Kt.render(re),re.setViewport(ur)):Kt.render(re);re.autoClear=!0}Wr.disable(re.xr.isPresenting),re.xr.enabled=!0,Nr.innerText=`Samples: ${Math.floor(Y.samples)}`,Ur.innerText=`Distance: ${Ce.position.length().toFixed(2)}`}}function zr(i){const e=Rt*Ot*i,t=2**Math.ceil(Math.log2(Math.max(Math.sqrt(e),Rt))),n=Math.floor(t/Rt),l=Math.ceil(i/n),c=Rt*n,d=Ot*l;return{numViews:i,numPixels:e,bufferWidth:t,quiltTilesX:n,quiltTilesY:l,quiltWidth:c,quiltHeight:d}}function Tt(){const{renderScale:i,viewCone:e,viewerDistance:t}=ie;Ue=zr(ie.numViews),Dt.numViews=Ue.numViews,Y.viewCount=Ue.numViews,Y.viewCone=e*Ht.DEG2RAD,Y.setFromDisplayView(t,Ta,Vr),Y.setSize(i*Ue.quiltWidth,i*Ue.quiltHeight),Y.quiltDimensions.set(Ue.quiltTilesX,Ue.quiltTilesY)}function xi(){const i=window.innerWidth,e=window.innerHeight;re.setSize(i,e),re.setPixelRatio(window.devicePixelRatio);const t=i/e;Ce.aspect=t,Ce.updateProjectionMatrix()}function Ba(){re.setSize(Y.target.width,Y.target.height),Kt.render(re);const i=re.domElement.toDataURL("image/png"),e=document.createElement("a");e.href=i,e.download="preview.png",e.click(),e.remove(),xi()}function Oa(){qe=new Gs,qe.add(ie,"model",Object.keys(Jt)).onChange(n=>{window.location.hash=n,window.location.reload()}),qe.add(ie,"enable"),qe.add(ie,"renderScale",.1,1,.01).onChange(()=>{Tt(),Y.reset()}),Wr=qe.add(ie,"saveQuilt");const i=qe.addFolder("Path Tracing");i.add(ie,"pause"),i.add(ie,"bounces",1,20,1).onChange(()=>{Y.reset()}),i.add(ie,"filterGlossyFactor",0,1).onChange(()=>{Y.reset()}),i.add(ie,"samplesPerFrame",1,10,1),i.add(ie,"tiles",1,3,1).onChange(n=>{Y.tiles.setScalar(n)});const e=qe.addFolder("Looking Glass Views");e.add(ie,"numViews",1,100,1).onChange(()=>{Tt(),Y.reset()}),e.add(ie,"viewCone",10,70,.1).onChange(()=>{Tt(),Y.reset()}),e.add(ie,"viewerDistance",.2,2,.1).onChange(()=>{Tt(),Y.reset()});const t=qe.addFolder("Preview");t.add(ie,"tiltingPreview"),t.add(ie,"animationSpeed",0,2),t.open()}function Ga(i,e){i.traverse(t=>{if(t.material){const n=t.material;if(n.opacity<.65&&n.opacity>.2){const l=new Is;for(const d in n)if(d in n){if(n[d]===null)continue;n[d].isTexture?l[d]=n[d]:n[d].copy&&n[d].constructor===l[d].constructor?l[d].copy(n[d]):typeof n[d]=="number"&&(l[d]=n[d])}l.opacity=1,l.transmission=1,l.thickness=1,l.ior=e;const c={};l.color.getHSL(c),c.l=Math.max(c.l,.35),l.color.setHSL(c.h,c.s,c.l),t.material=l}}})}
