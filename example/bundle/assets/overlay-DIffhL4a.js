import"./modulepreload-polyfill-B5Qt9EMX.js";import{at as G,au as L,a1 as E,av as C,E as F,ah as R,aA as y,M as W,C as j,X as g,G as h,az as A}from"./MaterialBase-byhyp4gt.js";import{O as D}from"./OrbitControls-BDTesZS8.js";import{H}from"./HDRLoader-uXUM045B.js";import{g as T}from"./lil-gui.module.min-BH_YJbPT.js";import{G as k}from"./GLTFLoader-BYq4k_JA.js";import{M as O}from"./meshopt_decoder.module-j6OW_3Rk.js";import{P as B}from"./ParallelMeshBVHWorker-DmJoIDz8.js";import{g as I}from"./getScaledSettings-nzgggDDj.js";import{L as z}from"./LoaderElement-kg8-0xPv.js";import{W as _}from"./WebGLPathTracer-DzRjmE4y.js";import"./BufferGeometryUtils-DMgFFDwZ.js";import"./pcg.glsl-Dh-2-BlJ.js";import"./PathTracingRenderer-N-9Lxrjr.js";import"./ggx_functions.glsl-BPuHaSoe.js";const q="https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/equirectangular/royal_esplanade_1k.hdr",V="https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/sd-macross-city-standoff-diorama/scene.glb",U="Model by tipatat on Sketchfab";let e,t,m,o,r,f,p,c;const n={bounces:5,renderScale:1/window.devicePixelRatio,filterGlossyFactor:.5,tiles:1,multipleImportanceSampling:!0,enabled:!0,...I()};N();async function N(){c=new z,c.attach(document.body),t=new G({antialias:!0}),t.toneMapping=L,document.body.appendChild(t.domElement),e=new _(t),e.tiles.set(n.tiles,n.tiles),e.setBVHWorker(new B),r=new E(75,window.innerWidth/window.innerHeight,.025,500),r.position.set(2.996,3.795,.697),m=new D(r,t.domElement),m.target.set(.311,1.13,.489),m.addEventListener("change",()=>e.updateCamera()),m.update(),o=new C,f=new C;const[a,s]=await Promise.all([new H().loadAsync(q),new k().setMeshoptDecoder(O).loadAsync(V)]);a.mapping=F,o.background=a,o.environment=a;const M=new R;s.scene.traverse(i=>{i.material&&(i.material.map=null)}),s.scene.updateMatrixWorld(!0),M.setFromObject(s.scene),s.scene.position.y-=M.min.y,o.add(s.scene);const P=new y(3.5,3.5,.05,60),v=new W({color:new j(10066329),metalness:.2,roughness:.02}),b=new g(P,v);b.position.y=-.025,o.add(b),p=[];const u=new g(new y(.5,.5,.5,32),new h({color:16711680})),w=new g(new A(.3,.3,.3),new h({color:65280}));u.position.set(-1,0,1),w.position.set(1,0,-1),p.push(u,w),f.add(u,w),await e.setSceneAsync(o,r,{onProgress:i=>{c.setPercentage(i)}}),c.setCredits(U);const l=new T().addFolder("Path Tracer");l.add(n,"tiles",1,4,1).onChange(i=>{e.tiles.set(i,i)}),l.add(n,"filterGlossyFactor",0,1).onChange(d),l.add(n,"bounces",1,15,1).onChange(d),l.add(n,"renderScale",.1,1).onChange(d),l.add(n,"multipleImportanceSampling").onChange(d),l.close(),d(),S(),window.addEventListener("resize",S),x()}function d(){e.filterGlossyFactor=n.filterGlossyFactor,e.bounces=n.bounces,e.renderScale=n.renderScale,e.multipleImportanceSampling=n.multipleImportanceSampling}function S(){t.setSize(window.innerWidth,window.innerHeight),t.setPixelRatio(window.devicePixelRatio),r.aspect=window.innerWidth/window.innerHeight,r.updateProjectionMatrix(),e.updateCamera()}const X=new h({colorWrite:!1});function J(){for(let a=0;a<p.length;a++){const s=p[a];s.position.y=Math.sin(Date.now()*.001+a)}}function x(){requestAnimationFrame(x),J(),e.renderSample();const a=t.autoClear;t.autoClear=!1,o.overrideMaterial=X,t.clearDepth(),t.render(o,r),o.overrideMaterial=null,t.render(f,r),t.autoClear=a,c.setSamples(e.samples,e.isCompiling)}
