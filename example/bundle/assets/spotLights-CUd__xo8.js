import"./modulepreload-polyfill-B5Qt9EMX.js";import{e as _,H as D,aS as q,D as X,F as $,g as J,a as K,aT as Q,d as L,a2 as P,at as Y,aU as Z,au as ee,a1 as te,av as ae,E as ne,ah as oe,X as j,aA as re,M as R,az as se}from"./MaterialBase-byhyp4gt.js";import{G as ie}from"./GLTFLoader-BYq4k_JA.js";import{O as le}from"./OrbitControls-BDTesZS8.js";import{H as de}from"./HDRLoader-uXUM045B.js";import{g as ce}from"./lil-gui.module.min-BH_YJbPT.js";import{g as ue}from"./getScaledSettings-nzgggDDj.js";import{L as me}from"./LoaderElement-kg8-0xPv.js";import{P as he}from"./ParallelMeshBVHWorker-DmJoIDz8.js";import{W as ge}from"./WebGLPathTracer-DzRjmE4y.js";import{P as pe}from"./PhysicalSpotLight-MA5Lj-8W.js";import"./BufferGeometryUtils-DMgFFDwZ.js";import"./pcg.glsl-Dh-2-BlJ.js";import"./PathTracingRenderer-N-9Lxrjr.js";import"./ggx_functions.glsl-BPuHaSoe.js";class fe extends _{constructor(e){super(e),this.type=D}_getIESValues(e,s){const o=new Array(64800);function u(t,a){let m=0,A=0,S=0,N=0,V=0,k=0;for(let d=0;d<e.numHorAngles-1;++d)if(a<e.horAngles[d+1]||d==e.numHorAngles-2){A=d,S=e.horAngles[d],N=e.horAngles[d+1];break}for(let d=0;d<e.numVerAngles-1;++d)if(t<e.verAngles[d+1]||d==e.numVerAngles-2){m=d,V=e.verAngles[d],k=e.verAngles[d+1];break}const v=N-S,H=k-V;if(H===0)return 0;const M=v===0?0:(a-S)/v,W=(t-V)/H,E=v===0?A:A+1,B=P.lerp(e.candelaValues[A][m],e.candelaValues[E][m],M),O=P.lerp(e.candelaValues[A][m+1],e.candelaValues[E][m+1],M);return P.lerp(B,O,W)}const y=e.horAngles[0],f=e.horAngles[e.numHorAngles-1];for(let t=0;t<64800;++t){let a=t%360;const m=Math.floor(t/360);f-y!==0&&(a<y||a>=f)&&(a%=f*2,a>f&&(a=f*2-a)),o[m+a*180]=u(m,a)}let l=null;return s===q?l=Uint8Array.from(o.map(t=>Math.min(t*255,255))):s===D?l=Uint16Array.from(o.map(t=>X.toHalfFloat(t))):s===$?l=Float32Array.from(o):console.error("IESLoader: Unsupported type:",s),l}load(e,s,i,g){const r=new J(this.manager);r.setResponseType("text"),r.setCrossOrigin(this.crossOrigin),r.setWithCredentials(this.withCredentials),r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.load(e,o=>{s(this.parse(o))},i,g)}parse(e){const s=this.type,i=new we(e),g=this._getIESValues(i,s),r=new K(g,180,1,Q,s);return r.minFilter=L,r.magFilter=L,r.needsUpdate=!0,r}}function we(x){const e=this,s=x.split(`
`);let i=0,g;e.verAngles=[],e.horAngles=[],e.candelaValues=[],e.tiltData={},e.tiltData.angles=[],e.tiltData.mulFactors=[];function r(t){return t=t.replace(/^\s+|\s+$/g,""),t=t.replace(/,/g," "),t=t.replace(/\s\s+/g," "),t.split(" ")}function o(t,a){for(;;){const m=s[i++],A=r(m);for(let S=0;S<A.length;++S)a.push(Number(A[S]));if(a.length===t)break}}function u(){let t=s[i++],a=r(t);e.tiltData.lampToLumGeometry=Number(a[0]),t=s[i++],a=r(t),e.tiltData.numAngles=Number(a[0]),o(e.tiltData.numAngles,e.tiltData.angles),o(e.tiltData.numAngles,e.tiltData.mulFactors)}function y(){const t=[];o(10,t),e.count=Number(t[0]),e.lumens=Number(t[1]),e.multiplier=Number(t[2]),e.numVerAngles=Number(t[3]),e.numHorAngles=Number(t[4]),e.gonioType=Number(t[5]),e.units=Number(t[6]),e.width=Number(t[7]),e.length=Number(t[8]),e.height=Number(t[9])}function f(){const t=[];o(3,t),e.ballFactor=Number(t[0]),e.blpFactor=Number(t[1]),e.inputWatts=Number(t[2])}for(;g=s[i++],!g.includes("TILT"););g.includes("NONE")||g.includes("INCLUDE")&&u(),y(),f();for(let t=0;t<e.numHorAngles;++t)e.candelaValues.push([]);o(e.numVerAngles,e.verAngles),o(e.numHorAngles,e.horAngles);for(let t=0;t<e.numHorAngles;++t)o(e.numVerAngles,e.candelaValues[t]);for(let t=0;t<e.numHorAngles;++t)for(let a=0;a<e.numVerAngles;++a)e.candelaValues[t][a]*=e.candelaValues[t][a]*e.multiplier*e.ballFactor*e.blpFactor;let l=-1;for(let t=0;t<e.numHorAngles;++t)for(let a=0;a<e.numVerAngles;++a){const m=e.candelaValues[t][a];l=l<m?m:l}if(l>0)for(let t=0;t<e.numHorAngles;++t)for(let a=0;a<e.numVerAngles;++a)e.candelaValues[t][a]/=l}const be="https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/steampunk-robot/scene.gltf",ye="https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/equirectangular/royal_esplanade_1k.hdr",Ae="Model by Benedict Chew on Sketchfab",z=["https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/0646706b3d2d9658994fc4ad80681dec.ies","https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/06b4cfdc8805709e767b5e2e904be8ad.ies","https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/007cfb11e343e2f42e3b476be4ab684e.ies","https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/01dac7d6c646814dcda6780e7b7b4566.ies","https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/108b32f07d6d38a7a6528a6d307440df.ies","https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/1aec5958092c236d005093ca27ebe378.ies","https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/02a7562c650498ebb301153dbbf59207.ies","https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/1a936937a49c63374e6d4fbed9252b29.ies","https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/00c6ce79e1d2cdf3a1fb491aaaa47ae0.ies"];let c,w,T,h,C,n,G,F;const b={multipleImportanceSampling:!0,bounces:3,renderScale:1/window.devicePixelRatio,tiles:2,iesProfile:-1,...ue()};Se();async function Se(){F=new me,F.attach(document.body),w=new Y,w.shadowMap.enabled=!0,w.physicallyCorrectLights=!0,w.shadowMap.type=Z,w.toneMapping=ee,document.body.appendChild(w.domElement),c=new ge(w),c.setBVHWorker(new he),c.tiles.set(b.tiles,b.tiles),c.textureSize.set(2048,2048),c.filterGlossyFactor=.5;const x=window.innerWidth/window.innerHeight;C=new te(75,x,.025,500),C.position.set(-2,4,8).multiplyScalar(.8),T=new le(C,w.domElement),T.target.y=1.5,T.update(),T.addEventListener("change",()=>c.updateCamera()),h=new ae,h.backgroundBlurriness=.1,h.environmentIntensity=.1,h.backgroundIntensity=.1;const e=new fe,[s,i,g]=await Promise.all([new de().loadAsync(ye),new ie().loadAsync(be),Promise.all(z.map(a=>e.loadAsync(a)))]);G=g,s.mapping=ne,h.environment=s,h.background=s,i.scene.scale.setScalar(1),i.scene.updateMatrixWorld(),i.scene.traverse(a=>{a.castShadow=!0,a.receiveShadow=!0}),h.add(i.scene);const r=new oe;r.setFromObject(i.scene);const o=new j(new re(8,8,.5,200),new R({color:5592405,roughness:.05,metalness:.4}));o.geometry=o.geometry.toNonIndexed(),o.geometry.clearGroups(),o.position.y=r.min.y-.25,o.receiveShadow=!0,o.material.color.convertSRGBToLinear(),h.add(o);const u=new j(new se(14,6,.5),new R({color:10511460,roughness:.4,metalness:.1}));u.castShadow=!0,u.receiveShadow=!0,u.geometry=u.geometry.toNonIndexed(),u.geometry.clearGroups(),u.position.x=0,u.position.y=r.min.y+3,u.position.z=r.min.z-.5,u.material.color.convertSRGBToLinear(),h.add(u),n=new pe(16777215),n.position.set(0,7,4),n.angle=Math.PI/4.5,n.decay=0,n.penumbra=1,n.distance=0,n.intensity=50,n.radius=.5,n.shadow.mapSize.width=512,n.shadow.mapSize.height=512,n.shadow.camera.near=.1,n.shadow.camera.far=10,n.shadow.focus=1,n.castShadow=!0,h.add(n);const y=n.target;y.position.x=0,y.position.y=o.position.y+2,y.position.z=.05,h.add(y),await c.setSceneAsync(h,C,{onProgress:a=>F.setPercentage(a)}),F.setCredits(Ae),p(),I(),window.addEventListener("resize",I);const f=new ce,l=f.addFolder("Path Tracing");l.add(b,"multipleImportanceSampling").onChange(p),l.add(b,"tiles",1,4,1).onChange(a=>{c.tiles.set(a,a)}),l.add(b,"bounces",1,30,1).onChange(p),l.add(b,"renderScale",.1,1).onChange(I);const t=f.addFolder("Spot Light");t.addColor(n,"color").onChange(p),t.add(n,"intensity",0,200,.01).onChange(p),t.add(n,"radius",0,10).onChange(p),t.add(n,"decay",0,2).onChange(p),t.add(n,"distance",0,20).onChange(p),t.add(n,"angle",0,Math.PI/2).onChange(p),t.add(n,"penumbra",0,1).onChange(p),t.add(b,"iesProfile",-1,z.length-1,1).onChange(a=>{n.iesMap=a===-1?null:G[a],p()}),U()}function I(){w.setSize(window.innerWidth,window.innerHeight),w.setPixelRatio(window.devicePixelRatio*b.renderScale),C.aspect=window.innerWidth/window.innerHeight,C.updateProjectionMatrix(),c.updateCamera()}function p(){c.multipleImportanceSampling=b.multipleImportanceSampling,c.bounces=b.bounces,c.updateLights()}function U(){requestAnimationFrame(U),C.updateMatrixWorld(),c.renderSample(),F.setSamples(c.samples,c.isCompiling)}
