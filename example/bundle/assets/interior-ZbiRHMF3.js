import"./modulepreload-polyfill-B5Qt9EMX.js";import{aQ as E,at as P,au as S,a1 as L,av as k,E as I,ah as R,m as F}from"./MaterialBase-byhyp4gt.js";import{G as M}from"./GLTFLoader-BYq4k_JA.js";import{O as b}from"./OrbitControls-BDTesZS8.js";import{H as x}from"./HDRLoader-uXUM045B.js";import{M as W}from"./meshopt_decoder.module-j6OW_3Rk.js";import{g as j}from"./lil-gui.module.min-BH_YJbPT.js";import{g as q}from"./getScaledSettings-nzgggDDj.js";import{P as A}from"./ParallelMeshBVHWorker-DmJoIDz8.js";import{L as H}from"./LoaderElement-kg8-0xPv.js";import{W as T}from"./WebGLPathTracer-DzRjmE4y.js";import"./BufferGeometryUtils-DMgFFDwZ.js";import"./pcg.glsl-Dh-2-BlJ.js";import"./PathTracingRenderer-N-9Lxrjr.js";import"./ggx_functions.glsl-BPuHaSoe.js";class D extends E{constructor(){super(),this.isEquirectCamera=!0}}const G="https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/aristea_wreck_puresky_2k.hdr",V="https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/pathtracing-bathroom/modernbathroom.glb",_='Interior scene by <a href="https://twitter.com/charlesforman">Charles Forman</a>';let e,a,r,o,w,n,i,p,u;const t={environmentIntensity:1,emissiveIntensity:5,bounces:20,renderScale:1/window.devicePixelRatio,tiles:2,projection:"Perspective",...q()};O();async function O(){u=new H,u.attach(document.body),a=new P({antialias:!0}),a.toneMapping=S,document.body.appendChild(a.domElement),e=new T(a),e.dynamicLowRes=!0,e.filterGlossyFactor=.25,e.tiles.set(t.tiles,t.tiles),e.setBVHWorker(new A),i=new L(75,window.innerWidth/window.innerHeight,.025,500),i.position.set(.4,.6,2.65),p=new D,p.position.set(-.2,.33,.08),r=new b(i,a.domElement),r.target.set(-.15,.33,-.08),i.lookAt(r.target),r.update(),r.addEventListener("change",()=>e.updateCamera()),o=new b(p,a.domElement),o.target.set(-.15,.33,-.08),p.lookAt(o.target),o.update(),o.addEventListener("change",()=>e.updateCamera()),n=new k;const[s,c]=await Promise.all([new x().loadAsync(G),new M().setMeshoptDecoder(W).loadAsync(V)]);s.mapping=I,n.background=s,n.environment=s,c.scene.traverse(d=>{d.material&&(d.material.thickness=1)}),n.add(c.scene),n.updateMatrixWorld();const l=new R;l.setFromObject(c.scene);const f=new F;l.getCenter(f),c.scene.position.addScaledVector(f,-.5),await e.setSceneAsync(n,i,{onProgress:d=>u.setPercentage(d)}),u.setCredits(_),v(),m(),window.addEventListener("resize",v);const C=new j,h=C.addFolder("Path Tracer");h.add(t,"tiles",1,4,1).onChange(d=>{e.tiles.set(d,d)}),h.add(t,"bounces",1,30,1).onChange(m),h.add(t,"renderScale",.1,1).onChange(m);const g=C.addFolder("Scene");g.add(t,"projection",["Perspective","Equirectangular"]).onChange(m),g.add(t,"environmentIntensity",0,25).onChange(m),g.add(t,"emissiveIntensity",0,50).onChange(m),y()}function v(){a.setSize(window.innerWidth,window.innerHeight),a.setPixelRatio(window.devicePixelRatio),i.aspect=window.innerWidth/window.innerHeight,i.updateProjectionMatrix(),e.updateCamera()}function m(){const s=t.projection;s==="Perspective"?(w=i,o.enabled=!1,r.enabled=!0,r.update()):s==="Equirectangular"&&(w=p,r.enabled=!1,o.enabled=!0,o.update()),n.traverse(c=>{const l=c.material;l&&(l.emissiveIntensity=t.emissiveIntensity)}),n.environmentIntensity=t.environmentIntensity,n.backgroundIntensity=t.environmentIntensity,e.bounces=t.bounces,e.renderScale=t.renderScale,e.setScene(n,w)}function y(){requestAnimationFrame(y),e.renderSample(),u.setSamples(e.samples,e.isCompiling)}
