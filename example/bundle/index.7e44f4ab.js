let e,t,r,a,n,o,i,s,l,d,c,u,h;function p(e,t,r,a){Object.defineProperty(e,t,{get:r,set:a,enumerable:!0,configurable:!0})}var m=globalThis,f={},g={},b=m.parcelRequire5b70;null==b&&((b=function(e){if(e in f)return f[e].exports;if(e in g){var t=g[e];delete g[e];var r={id:e,exports:{}};return f[e]=r,t.call(r.exports,r,r.exports),r.exports}var a=Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){g[e]=t},m.parcelRequire5b70=b);var y=b.register;y("891vQ",function(e,t){p(e.exports,"RGBELoader",()=>a);var r=b("ilwiq");class a extends r.DataTextureLoader{constructor(e){super(e),this.type=r.HalfFloatType}parse(e){let t,a,n;let o=function(e,t){switch(e){case 1:throw Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw Error("THREE.RGBELoader: Memory Error: "+(t||""))}},i=function(e,t,r){t=t||1024;let a=e.pos,n=-1,o=0,i="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(a,a+128)));for(;0>(n=s.indexOf("\n"))&&o<t&&a<e.byteLength;)i+=s,o+=s.length,a+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(a,a+128)));return -1<n&&(!1!==r&&(e.pos+=o+n+1),i+s.slice(0,n))},s=new Uint8Array(e);s.pos=0;let l=function(e){let t,r;let a=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,n=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,l=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,d={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};for(!(e.pos>=e.byteLength)&&(t=i(e))||o(1,"no header found"),(r=t.match(/^#\?(\S+)/))||o(3,"bad initial token"),d.valid|=1,d.programtype=r[1],d.string+=t+"\n";!1!==(t=i(e));){if(d.string+=t+"\n","#"===t.charAt(0)){d.comments+=t+"\n";continue}if((r=t.match(a))&&(d.gamma=parseFloat(r[1])),(r=t.match(n))&&(d.exposure=parseFloat(r[1])),(r=t.match(s))&&(d.valid|=2,d.format=r[1]),(r=t.match(l))&&(d.valid|=4,d.height=parseInt(r[1],10),d.width=parseInt(r[2],10)),2&d.valid&&4&d.valid)break}return 2&d.valid||o(3,"missing format specifier"),4&d.valid||o(3,"missing image size specifier"),d}(s),d=l.width,c=l.height,u=function(e,t,r){if(t<8||t>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);t!==(e[2]<<8|e[3])&&o(3,"wrong scanline width");let a=new Uint8Array(4*t*r);a.length||o(4,"unable to allocate buffer space");let n=0,i=0,s=4*t,l=new Uint8Array(4),d=new Uint8Array(s),c=r;for(;c>0&&i<e.byteLength;){i+4>e.byteLength&&o(1),l[0]=e[i++],l[1]=e[i++],l[2]=e[i++],l[3]=e[i++],(2!=l[0]||2!=l[1]||(l[2]<<8|l[3])!=t)&&o(3,"bad rgbe scanline format");let r=0,u;for(;r<s&&i<e.byteLength;){let t=(u=e[i++])>128;if(t&&(u-=128),(0===u||r+u>s)&&o(3,"bad scanline data"),t){let t=e[i++];for(let e=0;e<u;e++)d[r++]=t}else d.set(e.subarray(i,i+u),r),r+=u,i+=u}for(let e=0;e<t;e++){let r=0;a[n]=d[e+r],r+=t,a[n+1]=d[e+r],r+=t,a[n+2]=d[e+r],r+=t,a[n+3]=d[e+r],n+=4}c--}return a}(s.subarray(s.pos),d,c);switch(this.type){case r.FloatType:let h=new Float32Array(4*(n=u.length/4));for(let e=0;e<n;e++)!function(e,t,r,a){let n=Math.pow(2,e[t+3]-128)/255;r[a+0]=e[t+0]*n,r[a+1]=e[t+1]*n,r[a+2]=e[t+2]*n,r[a+3]=1}(u,4*e,h,4*e);t=h,a=r.FloatType;break;case r.HalfFloatType:let p=new Uint16Array(4*(n=u.length/4));for(let e=0;e<n;e++)!function(e,t,a,n){let o=Math.pow(2,e[t+3]-128)/255;a[n+0]=(0,r.DataUtils).toHalfFloat(Math.min(e[t+0]*o,65504)),a[n+1]=(0,r.DataUtils).toHalfFloat(Math.min(e[t+1]*o,65504)),a[n+2]=(0,r.DataUtils).toHalfFloat(Math.min(e[t+2]*o,65504)),a[n+3]=(0,r.DataUtils).toHalfFloat(1)}(u,4*e,p,4*e);t=p,a=r.HalfFloatType;break;default:throw Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:d,height:c,data:t,header:l.string,gamma:l.gamma,exposure:l.exposure,type:a}}setDataType(e){return this.type=e,this}load(e,t,a,n){return super.load(e,function(e,a){switch(e.type){case r.FloatType:case r.HalfFloatType:e.colorSpace=r.LinearSRGBColorSpace,e.minFilter=r.LinearFilter,e.magFilter=r.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,a)},a,n)}}}),y("7MGRS",function(e,t){p(e.exports,"default",()=>a);var r=function(){var e=0,t=document.createElement("div");function a(e){return t.appendChild(e.dom),e}function n(r){for(var a=0;a<t.children.length;a++)t.children[a].style.display=a===r?"block":"none";e=r}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",function(r){r.preventDefault(),n(++e%t.children.length)},!1);var o=(performance||Date).now(),i=o,s=0,l=a(new r.Panel("FPS","#0ff","#002")),d=a(new r.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=a(new r.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:t,addPanel:a,showPanel:n,begin:function(){o=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(d.update(e-o,200),e>=i+1e3&&(l.update(1e3*s/(e-i),100),i=e,s=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){o=this.end()},domElement:t,setMode:n}};r.Panel=function(e,t,r){var a=1/0,n=0,o=Math.round,i=o(window.devicePixelRatio||1),s=80*i,l=48*i,d=3*i,c=2*i,u=3*i,h=15*i,p=74*i,m=30*i,f=document.createElement("canvas");f.width=s,f.height=l,f.style.cssText="width:80px;height:48px";var g=f.getContext("2d");return g.font="bold "+9*i+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=r,g.fillRect(0,0,s,l),g.fillStyle=t,g.fillText(e,d,c),g.fillRect(u,h,p,m),g.fillStyle=r,g.globalAlpha=.9,g.fillRect(u,h,p,m),{dom:f,update:function(l,b){a=Math.min(a,l),n=Math.max(n,l),g.fillStyle=r,g.globalAlpha=1,g.fillRect(0,0,s,h),g.fillStyle=t,g.fillText(o(l)+" "+e+" ("+o(a)+"-"+o(n)+")",d,c),g.drawImage(f,u+i,h,p-i,m,u,h,p-i,m),g.fillRect(u+p-i,h,i,m),g.fillStyle=r,g.globalAlpha=.9,g.fillRect(u+p-i,h,i,o((1-l/b)*m))}}};var a=r}),y("1EdOY",function(e,t){p(e.exports,"generateRadialFloorTexture",()=>a);var r=b("ilwiq");function a(e){let t=new Uint8Array(e*e*4);for(let r=0;r<e;r++)for(let a=0;a<e;a++){let n=Math.max(Math.min(1-Math.sqrt((2*(r/(e-1)-.5))**2+(2*(a/(e-1)-.5))**2),1),0);n=Math.min(n=n**2*1.5,1);let o=a*e+r;t[4*o+0]=255,t[4*o+1]=255,t[4*o+2]=255,t[4*o+3]=255*n}let a=new r.DataTexture(t,e,e);return a.format=r.RGBAFormat,a.type=r.UnsignedByteType,a.minFilter=r.LinearFilter,a.magFilter=r.LinearFilter,a.wrapS=r.RepeatWrapping,a.wrapT=r.RepeatWrapping,a.needsUpdate=!0,a}}),y("cE5k3",function(e,t){p(e.exports,"getScaledSettings",()=>r);function r(){let e=3,t=Math.max(1/window.devicePixelRatio,.5);return window.innerWidth/window.innerHeight<.65&&(e=4,t=.5/window.devicePixelRatio),{tiles:e,renderScale:t}}}),y("e2Pv4",function(e,t){let r;p(e.exports,"LoaderElement",()=>a);class a{constructor(){r||((r=document.createElement("style")).textContent=`

		.loader-container, .description {
			position: absolute;
			width: 100%;
			font-family: 'Courier New', Courier, monospace;
			color: white;
			font-weight: light;
			align-items: flex-start;
			font-size: 14px;
			pointer-events: none;
			user-select: none;
		}

		.loader-container {
			display: flex;
			flex-direction: column;
			bottom: 0;
		}

		.description {
			top: 0;
			width: 100%;
			text-align: center;
			padding: 5px 0;
		}

		.loader-container .bar {
			height: 2px;
			background: white;
			width: 100%;
		}

		.loader-container .credits,
		.loader-container .samples,
		.loader-container .percentage {
			padding: 5px;
			margin: 0 0 1px 1px;
			background: rgba( 0, 0, 0, 0.2 );
			border-radius: 2px;
			display: inline-block;
		}

		.loader-container:not(.loading) .bar,
		.loader-container:not(.loading) .percentage,
		.loader-container.loading .credits,
		.loader-container.loading .samples,
		.loader-container .credits:empty {
			display: none;
		}

		.loader-container .credits a,
		.loader-container .credits,
		.loader-container .samples {
			color: rgba( 255, 255, 255, 0.75 );
		}
	`,document.head.appendChild(r));let e=document.createElement("div");e.classList.add("loader-container");let t=document.createElement("div");t.classList.add("percentage"),e.appendChild(t);let a=document.createElement("div");a.classList.add("samples"),e.appendChild(a);let n=document.createElement("div");n.classList.add("credits"),e.appendChild(n);let o=document.createElement("div");o.classList.add("bar"),e.appendChild(o);let i=document.createElement("div");i.classList.add("description"),e.appendChild(i),this._description=i,this._loaderBar=o,this._percentage=t,this._credits=n,this._samples=a,this._container=e,this.setPercentage(0)}attach(e){e.appendChild(this._container),e.appendChild(this._description)}setPercentage(e){this._loaderBar.style.width=`${100*e}%`,0===e?this._percentage.innerText="Loading...":this._percentage.innerText=`${(100*e).toFixed(0)}%`,e>=1?this._container.classList.remove("loading"):this._container.classList.add("loading")}setSamples(e,t=!1){t?this._samples.innerText="compiling shader...":this._samples.innerText=`${Math.floor(e)} samples`}setCredits(e){this._credits.innerHTML=e}setDescription(e){this._description.innerHTML=e}}}),y("kqOCM",function(e,t){p(e.exports,"ParallelMeshBVHWorker",()=>c);var r=b("ilwiq"),a=b("6KVZ3"),n=b("3ePKg"),o=b("cSOJe"),i=b("a8VBx"),s=b("5Gkg5");let l="undefined"!=typeof navigator?navigator.hardwareConcurrency:4;class d extends n.WorkerBase{constructor(){if(super(new Worker(b("2tQrc"))),this.name="ParallelMeshBVHWorker",this.maxWorkerCount=Math.max(l,4),!(0,o.isSharedArrayBufferSupported)())throw Error("ParallelMeshBVHWorker: Shared Array Buffers are not supported.")}runTask(e,t,n={}){return new Promise((i,l)=>{if(t.index||n.indirect||(0,s.ensureIndex)(t,n),t.getAttribute("position").isInterleavedBufferAttribute||t.index&&t.index.isInterleavedBufferAttribute)throw Error("ParallelMeshBVHWorker: InterleavedBufferAttribute are not supported for the geometry attributes.");e.onerror=e=>{l(Error(`ParallelMeshBVHWorker: ${e.message}`))},e.onmessage=o=>{let{data:s}=o;if(s.error)l(Error(s.error)),e.onmessage=null;else if(s.serialized){let{serialized:o,position:l}=s,d=(0,a.MeshBVH).deserialize(o,t,{setIndex:!1}),c={setBoundingBox:!0,...n};if(t.attributes.position.array=l,o.index){if(t.index)t.index.array=o.index;else{let e=new r.BufferAttribute(o.index,1,!1);t.setIndex(e)}}c.setBoundingBox&&(t.boundingBox=d.getBoundingBox(new r.Box3)),n.onProgress&&n.onProgress(s.progress),i(d),e.onmessage=null}else n.onProgress&&n.onProgress(s.progress)};let d=t.index?t.index.array:null,c=t.attributes.position.array;e.postMessage({operation:"BUILD_BVH",maxWorkerCount:this.maxWorkerCount,index:(0,o.convertToBufferType)(d,SharedArrayBuffer),position:(0,o.convertToBufferType)(c,SharedArrayBuffer),options:{...n,onProgress:null,includedProgressCallback:!!n.onProgress,groups:[...t.groups]}})})}}class c{constructor(){if((0,o.isSharedArrayBufferSupported)())return new d;{console.warn("ParallelMeshBVHWorker: SharedArrayBuffers not supported. Falling back to single-threaded GenerateMeshBVHWorker.");let e=new i.GenerateMeshBVHWorker;return e.maxWorkerCount=l,e}}}}),y("3ePKg",function(e,t){p(e.exports,"WorkerBase",()=>r);class r{constructor(e){this.name="WorkerBase",this.running=!1,this.worker=e,this.worker.onerror=e=>{if(e.message)throw Error(`${this.name}: Could not create Web Worker with error "${e.message}"`);throw Error(`${this.name}: Could not create Web Worker.`)}}runTask(){}generate(...e){if(this.running)throw Error("GenerateMeshBVHWorker: Already running job.");if(null===this.worker)throw Error("GenerateMeshBVHWorker: Worker has been disposed.");this.running=!0;let t=this.runTask(this.worker,...e);return t.finally(()=>{this.running=!1}),t}dispose(){this.worker.terminate(),this.worker=null}}}),y("a8VBx",function(e,t){p(e.exports,"GenerateMeshBVHWorker",()=>o);var r=b("ilwiq"),a=b("6KVZ3"),n=b("3ePKg");class o extends n.WorkerBase{constructor(){super(new Worker(b("jVRlM"))),this.name="GenerateMeshBVHWorker"}runTask(e,t,n={}){return new Promise((o,i)=>{if(t.getAttribute("position").isInterleavedBufferAttribute||t.index&&t.index.isInterleavedBufferAttribute)throw Error("GenerateMeshBVHWorker: InterleavedBufferAttribute are not supported for the geometry attributes.");e.onerror=e=>{i(Error(`GenerateMeshBVHWorker: ${e.message}`))},e.onmessage=s=>{let{data:l}=s;if(l.error)i(Error(l.error)),e.onmessage=null;else if(l.serialized){let{serialized:i,position:s}=l,d=(0,a.MeshBVH).deserialize(i,t,{setIndex:!1}),c=Object.assign({setBoundingBox:!0},n);if(t.attributes.position.array=s,i.index){if(t.index)t.index.array=i.index;else{let e=new r.BufferAttribute(i.index,1,!1);t.setIndex(e)}}c.setBoundingBox&&(t.boundingBox=d.getBoundingBox(new r.Box3)),n.onProgress&&n.onProgress(l.progress),o(d),e.onmessage=null}else n.onProgress&&n.onProgress(l.progress)};let s=t.index?t.index.array:null,l=t.attributes.position.array,d=[l];s&&d.push(s),e.postMessage({index:s,position:l,options:{...n,onProgress:null,includedProgressCallback:!!n.onProgress,groups:[...t.groups]}},d.map(e=>e.buffer).filter(e=>"undefined"==typeof SharedArrayBuffer||!(e instanceof SharedArrayBuffer)))})}}}),y("jVRlM",function(e,t){var r=b("7ryUf");let a=new URL("generateMeshBVH.worker.373f3c58.js",import.meta.url);e.exports=r(a.toString(),a.origin,!0)}),y("7ryUf",function(e,t){e.exports=function(e,t,r){if(t===self.location.origin)return e;var a=r?"import "+JSON.stringify(e)+";":"importScripts("+JSON.stringify(e)+");";return URL.createObjectURL(new Blob([a],{type:"application/javascript"}))}}),y("2tQrc",function(e,t){var r=b("7ryUf");let a=new URL("parallelMeshBVH.worker.22cf4bb0.js",import.meta.url);e.exports=r(a.toString(),a.origin,!0)}),y("9fZ6X",function(e,t){p(e.exports,"MaterialBase",()=>a);var r=b("ilwiq");class a extends r.ShaderMaterial{set needsUpdate(e){super.needsUpdate=!0,this.dispatchEvent({type:"recompilation"})}constructor(e){for(let t in super(e),this.uniforms)Object.defineProperty(this,t,{get(){return this.uniforms[t].value},set(e){this.uniforms[t].value=e}})}setDefine(e,t){if(null==t){if(e in this.defines)return delete this.defines[e],this.needsUpdate=!0,!0}else if(this.defines[e]!==t)return this.defines[e]=t,this.needsUpdate=!0,!0;return!1}}}),y("fYvb1",function(e,t){p(e.exports,"math_functions",()=>r);let r=`

	// Fast arccos approximation used to remove banding artifacts caused by numerical errors in acos.
	// This is a cubic Lagrange interpolating polynomial for x = [-1, -1/2, 0, 1/2, 1].
	// For more information see: https://github.com/gkjohnson/three-gpu-pathtracer/pull/171#issuecomment-1152275248
	float acosApprox( float x ) {

		x = clamp( x, -1.0, 1.0 );
		return ( - 0.69813170079773212 * x * x - 0.87266462599716477 ) * x + 1.5707963267948966;

	}

	// An acos with input values bound to the range [-1, 1].
	float acosSafe( float x ) {

		return acos( clamp( x, -1.0, 1.0 ) );

	}

	float saturateCos( float val ) {

		return clamp( val, 0.001, 1.0 );

	}

	float square( float t ) {

		return t * t;

	}

	vec2 square( vec2 t ) {

		return t * t;

	}

	vec3 square( vec3 t ) {

		return t * t;

	}

	vec4 square( vec4 t ) {

		return t * t;

	}

	vec2 rotateVector( vec2 v, float t ) {

		float ac = cos( t );
		float as = sin( t );
		return vec2(
			v.x * ac - v.y * as,
			v.x * as + v.y * ac
		);

	}

	// forms a basis with the normal vector as Z
	mat3 getBasisFromNormal( vec3 normal ) {

		vec3 other;
		if ( abs( normal.x ) > 0.5 ) {

			other = vec3( 0.0, 1.0, 0.0 );

		} else {

			other = vec3( 1.0, 0.0, 0.0 );

		}

		vec3 ortho = normalize( cross( normal, other ) );
		vec3 ortho2 = normalize( cross( normal, ortho ) );
		return mat3( ortho2, ortho, normal );

	}

`}),y("dUUQZ",function(e,t){p(e.exports,"util_functions",()=>r);let r=`

	// TODO: possibly this should be renamed something related to material or path tracing logic

	#ifndef RAY_OFFSET
	#define RAY_OFFSET 1e-4
	#endif

	// adjust the hit point by the surface normal by a factor of some offset and the
	// maximum component-wise value of the current point to accommodate floating point
	// error as values increase.
	vec3 stepRayOrigin( vec3 rayOrigin, vec3 rayDirection, vec3 offset, float dist ) {

		vec3 point = rayOrigin + rayDirection * dist;
		vec3 absPoint = abs( point );
		float maxPoint = max( absPoint.x, max( absPoint.y, absPoint.z ) );
		return point + offset * ( maxPoint + 1.0 ) * RAY_OFFSET;

	}

	// https://github.com/KhronosGroup/glTF/blob/main/extensions/2.0/Khronos/KHR_materials_volume/README.md#attenuation
	vec3 transmissionAttenuation( float dist, vec3 attColor, float attDist ) {

		vec3 ot = - log( attColor ) / attDist;
		return exp( - ot * dist );

	}

	vec3 getHalfVector( vec3 wi, vec3 wo, float eta ) {

		// get the half vector - assuming if the light incident vector is on the other side
		// of the that it's transmissive.
		vec3 h;
		if ( wi.z > 0.0 ) {

			h = normalize( wi + wo );

		} else {

			// Scale by the ior ratio to retrieve the appropriate half vector
			// From Section 2.2 on computing the transmission half vector:
			// https://blog.selfshadow.com/publications/s2015-shading-course/burley/s2015_pbs_disney_bsdf_notes.pdf
			h = normalize( wi + wo * eta );

		}

		h *= sign( h.z );
		return h;

	}

	vec3 getHalfVector( vec3 a, vec3 b ) {

		return normalize( a + b );

	}

	// The discrepancy between interpolated surface normal and geometry normal can cause issues when a ray
	// is cast that is on the top side of the geometry normal plane but below the surface normal plane. If
	// we find a ray like that we ignore it to avoid artifacts.
	// This function returns if the direction is on the same side of both planes.
	bool isDirectionValid( vec3 direction, vec3 surfaceNormal, vec3 geometryNormal ) {

		bool aboveSurfaceNormal = dot( direction, surfaceNormal ) > 0.0;
		bool aboveGeometryNormal = dot( direction, geometryNormal ) > 0.0;
		return aboveSurfaceNormal == aboveGeometryNormal;

	}

	// ray sampling x and z are swapped to align with expected background view
	vec2 equirectDirectionToUv( vec3 direction ) {

		// from Spherical.setFromCartesianCoords
		vec2 uv = vec2( atan( direction.z, direction.x ), acos( direction.y ) );
		uv /= vec2( 2.0 * PI, PI );

		// apply adjustments to get values in range [0, 1] and y right side up
		uv.x += 0.5;
		uv.y = 1.0 - uv.y;
		return uv;

	}

	vec3 equirectUvToDirection( vec2 uv ) {

		// undo above adjustments
		uv.x -= 0.5;
		uv.y = 1.0 - uv.y;

		// from Vector3.setFromSphericalCoords
		float theta = uv.x * 2.0 * PI;
		float phi = uv.y * PI;

		float sinPhi = sin( phi );

		return vec3( sinPhi * cos( theta ), cos( phi ), sinPhi * sin( theta ) );

	}

	// power heuristic for multiple importance sampling
	float misHeuristic( float a, float b ) {

		float aa = a * a;
		float bb = b * b;
		return aa / ( aa + bb );

	}

	// tentFilter from Peter Shirley's 'Realistic Ray Tracing (2nd Edition)' book, pg. 60
	// erichlof/THREE.js-PathTracing-Renderer/
	float tentFilter( float x ) {

		return x < 0.5 ? sqrt( 2.0 * x ) - 1.0 : 1.0 - sqrt( 2.0 - ( 2.0 * x ) );

	}
`}),y("8keuf",function(e,t){p(e.exports,"ggx_functions",()=>r);let r=`

	// The GGX functions provide sampling and distribution information for normals as output so
	// in order to get probability of scatter direction the half vector must be computed and provided.
	// [0] https://www.cs.cornell.edu/~srm/publications/EGSR07-btdf.pdf
	// [1] https://hal.archives-ouvertes.fr/hal-01509746/document
	// [2] http://jcgt.org/published/0007/04/01/
	// [4] http://jcgt.org/published/0003/02/03/

	// trowbridge-reitz === GGX === GTR

	vec3 ggxDirection( vec3 incidentDir, vec2 roughness, vec2 uv ) {

		// TODO: try GGXVNDF implementation from reference [2], here. Needs to update ggxDistribution
		// function below, as well

		// Implementation from reference [1]
		// stretch view
		vec3 V = normalize( vec3( roughness * incidentDir.xy, incidentDir.z ) );

		// orthonormal basis
		vec3 T1 = ( V.z < 0.9999 ) ? normalize( cross( V, vec3( 0.0, 0.0, 1.0 ) ) ) : vec3( 1.0, 0.0, 0.0 );
		vec3 T2 = cross( T1, V );

		// sample point with polar coordinates (r, phi)
		float a = 1.0 / ( 1.0 + V.z );
		float r = sqrt( uv.x );
		float phi = ( uv.y < a ) ? uv.y / a * PI : PI + ( uv.y - a ) / ( 1.0 - a ) * PI;
		float P1 = r * cos( phi );
		float P2 = r * sin( phi ) * ( ( uv.y < a ) ? 1.0 : V.z );

		// compute normal
		vec3 N = P1 * T1 + P2 * T2 + V * sqrt( max( 0.0, 1.0 - P1 * P1 - P2 * P2 ) );

		// unstretch
		N = normalize( vec3( roughness * N.xy, max( 0.0, N.z ) ) );

		return N;

	}

	// Below are PDF and related functions for use in a Monte Carlo path tracer
	// as specified in Appendix B of the following paper
	// See equation (34) from reference [0]
	float ggxLamda( float theta, float roughness ) {

		float tanTheta = tan( theta );
		float tanTheta2 = tanTheta * tanTheta;
		float alpha2 = roughness * roughness;

		float numerator = - 1.0 + sqrt( 1.0 + alpha2 * tanTheta2 );
		return numerator / 2.0;

	}

	// See equation (34) from reference [0]
	float ggxShadowMaskG1( float theta, float roughness ) {

		return 1.0 / ( 1.0 + ggxLamda( theta, roughness ) );

	}

	// See equation (125) from reference [4]
	float ggxShadowMaskG2( vec3 wi, vec3 wo, float roughness ) {

		float incidentTheta = acos( wi.z );
		float scatterTheta = acos( wo.z );
		return 1.0 / ( 1.0 + ggxLamda( incidentTheta, roughness ) + ggxLamda( scatterTheta, roughness ) );

	}

	// See equation (33) from reference [0]
	float ggxDistribution( vec3 halfVector, float roughness ) {

		float a2 = roughness * roughness;
		a2 = max( EPSILON, a2 );
		float cosTheta = halfVector.z;
		float cosTheta4 = pow( cosTheta, 4.0 );

		if ( cosTheta == 0.0 ) return 0.0;

		float theta = acosSafe( halfVector.z );
		float tanTheta = tan( theta );
		float tanTheta2 = pow( tanTheta, 2.0 );

		float denom = PI * cosTheta4 * pow( a2 + tanTheta2, 2.0 );
		return ( a2 / denom );

	}

	// See equation (3) from reference [2]
	float ggxPDF( vec3 wi, vec3 halfVector, float roughness ) {

		float incidentTheta = acos( wi.z );
		float D = ggxDistribution( halfVector, roughness );
		float G1 = ggxShadowMaskG1( incidentTheta, roughness );

		return D * G1 * max( 0.0, dot( wi, halfVector ) ) / wi.z;

	}

`});var w=b("ilwiq"),v=b("kp7Te"),x=b("891vQ"),k=b("7lx9d"),w=(b("ilwiq"),b("ilwiq"));class T extends w.DataTextureLoader{constructor(e){super(e)}parse(e){if(e.length<19)throw Error("THREE.TGALoader: Not enough data to contain header.");let t=0,r=new Uint8Array(e),a={id_length:r[t++],colormap_type:r[t++],image_type:r[t++],colormap_index:r[t++]|r[t++]<<8,colormap_length:r[t++]|r[t++]<<8,colormap_size:r[t++],origin:[r[t++]|r[t++]<<8,r[t++]|r[t++]<<8],width:r[t++]|r[t++]<<8,height:r[t++]|r[t++]<<8,pixel_size:r[t++],flags:r[t++]};if(!function(e){switch(e.image_type){case 1:case 9:if(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)throw Error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case 2:case 3:case 10:case 11:if(e.colormap_type)throw Error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case 0:throw Error("THREE.TGALoader: No data.");default:throw Error("THREE.TGALoader: Invalid type "+e.image_type)}if(e.width<=0||e.height<=0)throw Error("THREE.TGALoader: Invalid image size.");if(8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size)throw Error("THREE.TGALoader: Invalid pixel size "+e.pixel_size)}(a),a.id_length+t>e.length)throw Error("THREE.TGALoader: No data.");t+=a.id_length;let n=!1,o=!1,i=!1;switch(a.image_type){case 9:n=!0,o=!0;break;case 1:o=!0;break;case 10:n=!0;break;case 2:break;case 11:n=!0,i=!0;break;case 3:i=!0}let s=new Uint8Array(a.width*a.height*4),l=function(e,t,r,a,n){let o,i;let s=r.pixel_size>>3,l=r.width*r.height*s;if(t&&(i=n.subarray(a,a+=r.colormap_length*(r.colormap_size>>3))),e){let e,t,r;o=new Uint8Array(l);let i=0,d=new Uint8Array(s);for(;i<l;)if(t=(127&(e=n[a++]))+1,128&e){for(r=0;r<s;++r)d[r]=n[a++];for(r=0;r<t;++r)o.set(d,i+r*s);i+=s*t}else{for(t*=s,r=0;r<t;++r)o[i+r]=n[a++];i+=t}}else o=n.subarray(a,a+=t?r.width*r.height:l);return{pixel_data:o,palettes:i}}(n,o,a,t,r);return!function(e,t,r,n,o){let s,l,d,c,u,h;switch((48&a.flags)>>4){default:case 2:s=0,d=1,u=t,l=0,c=1,h=r;break;case 0:s=0,d=1,u=t,l=r-1,c=-1,h=-1;break;case 3:s=t-1,d=-1,u=-1,l=0,c=1,h=r;break;case 1:s=t-1,d=-1,u=-1,l=r-1,c=-1,h=-1}if(i)switch(a.pixel_size){case 8:!function(e,t,r,n,o,i,s,l){let d,c=0,u,h,p=a.width;for(h=t;h!==n;h+=r)for(u=o;u!==s;u+=i,c++)d=l[c],e[(u+p*h)*4+0]=d,e[(u+p*h)*4+1]=d,e[(u+p*h)*4+2]=d,e[(u+p*h)*4+3]=255}(e,l,c,h,s,d,u,n);break;case 16:!function(e,t,r,n,o,i,s,l){let d=0,c,u,h=a.width;for(u=t;u!==n;u+=r)for(c=o;c!==s;c+=i,d+=2)e[(c+h*u)*4+0]=l[d+0],e[(c+h*u)*4+1]=l[d+0],e[(c+h*u)*4+2]=l[d+0],e[(c+h*u)*4+3]=l[d+1]}(e,l,c,h,s,d,u,n);break;default:throw Error("THREE.TGALoader: Format not supported.")}else switch(a.pixel_size){case 8:!function(e,t,r,n,o,i,s,l,d){let c,u=0,h,p,m=a.width;for(p=t;p!==n;p+=r)for(h=o;h!==s;h+=i,u++)c=l[u],e[(h+m*p)*4+3]=255,e[(h+m*p)*4+2]=d[3*c+0],e[(h+m*p)*4+1]=d[3*c+1],e[(h+m*p)*4+0]=d[3*c+2]}(e,l,c,h,s,d,u,n,o);break;case 16:!function(e,t,r,n,o,i,s,l){let d,c=0,u,h,p=a.width;for(h=t;h!==n;h+=r)for(u=o;u!==s;u+=i,c+=2)d=l[c+0]+(l[c+1]<<8),e[(u+p*h)*4+0]=(31744&d)>>7,e[(u+p*h)*4+1]=(992&d)>>2,e[(u+p*h)*4+2]=(31&d)<<3,e[(u+p*h)*4+3]=32768&d?0:255}(e,l,c,h,s,d,u,n);break;case 24:!function(e,t,r,n,o,i,s,l){let d=0,c,u,h=a.width;for(u=t;u!==n;u+=r)for(c=o;c!==s;c+=i,d+=3)e[(c+h*u)*4+3]=255,e[(c+h*u)*4+2]=l[d+0],e[(c+h*u)*4+1]=l[d+1],e[(c+h*u)*4+0]=l[d+2]}(e,l,c,h,s,d,u,n);break;case 32:!function(e,t,r,n,o,i,s,l){let d=0,c,u,h=a.width;for(u=t;u!==n;u+=r)for(c=o;c!==s;c+=i,d+=4)e[(c+h*u)*4+2]=l[d+0],e[(c+h*u)*4+1]=l[d+1],e[(c+h*u)*4+0]=l[d+2],e[(c+h*u)*4+3]=l[d+3]}(e,l,c,h,s,d,u,n);break;default:throw Error("THREE.TGALoader: Format not supported.")}}(s,a.width,a.height,l.pixel_data,l.palettes),{data:s,width:a.width,height:a.height,flipY:!0,generateMipmaps:!0,minFilter:w.LinearMipmapLinearFilter}}}class N extends w.Loader{load(e,t,r,a){let n=this,o=""===n.path?(0,w.LoaderUtils).extractUrlBase(e):n.path,i=new w.FileLoader(n.manager);i.setPath(n.path),i.setRequestHeader(n.requestHeader),i.setWithCredentials(n.withCredentials),i.load(e,function(r){try{t(n.parse(r,o))}catch(t){a?a(t):console.error(t),n.manager.itemError(e)}},r,a)}parse(e,t){var r,a,n,o;let i;function s(e,t){let r=[],a=e.childNodes;for(let e=0,n=a.length;e<n;e++){let n=a[e];n.nodeName===t&&r.push(n)}return r}function l(e){if(0===e.length)return[];let t=e.trim().split(/\s+/),r=Array(t.length);for(let e=0,a=t.length;e<a;e++)r[e]=parseFloat(t[e]);return r}function d(e){if(0===e.length)return[];let t=e.trim().split(/\s+/),r=Array(t.length);for(let e=0,a=t.length;e<a;e++)r[e]=parseInt(t[e]);return r}function c(e){return e.substring(1)}function u(e){return 0===Object.keys(e).length}function h(e,t,r,a){let n=s(e,t)[0];if(void 0!==n){let e=s(n,r);for(let t=0;t<e.length;t++)a(e[t])}}function p(e,t){for(let r in e)e[r].build=t(e[r])}function m(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function f(e){let t=[],r=e.channels,a=e.samplers,n=e.sources;for(let e in r)if(r.hasOwnProperty(e)){let o=r[e],i=a[o.sampler],s=i.inputs.INPUT,l=i.inputs.OUTPUT;!function(e,t){let r=e.keyframes,a=e.name,n=[],o=[],i=[],s=[];for(let e=0,t=r.length;e<t;e++){let t=r[e],a=t.time,l=t.value;q.fromArray(l).transpose(),q.decompose(b,v,y),n.push(a),o.push(b.x,b.y,b.z),i.push(v.x,v.y,v.z,v.w),s.push(y.x,y.y,y.z)}o.length>0&&t.push(new w.VectorKeyframeTrack(a+".position",n,o)),i.length>0&&t.push(new w.QuaternionKeyframeTrack(a+".quaternion",n,i)),s.length>0&&t.push(new w.VectorKeyframeTrack(a+".scale",n,s))}(function(e,t,r){let a,n,o,i,s,l;let d=el.nodes[e.id],c=X(d.id),u=d.transforms[e.sid],h=d.matrix.clone().transpose(),p={};switch(u){case"matrix":for(o=0,i=t.array.length;o<i;o++)if(a=t.array[o],n=o*r.stride,void 0===p[a]&&(p[a]={}),!0===e.arraySyntax){let t=r.array[n],o=e.indices[0]+4*e.indices[1];p[a][o]=t}else for(s=0,l=r.stride;s<l;s++)p[a][s]=r.array[n+s];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',u)}let m=function(e,t){let r=[];for(let t in e)r.push({time:parseFloat(t),value:e[t]});r.sort(function(e,t){return e.time-t.time});for(let e=0;e<16;e++)!function(e,t,r){let a,n,o;let i=!0;for(n=0,o=e.length;n<o;n++)void 0===(a=e[n]).value[t]?a.value[t]=null:i=!1;if(!0===i)for(n=0,o=e.length;n<o;n++)(a=e[n]).value[t]=r;else!function(e,t){let r,a;for(let n=0,o=e.length;n<o;n++){let o=e[n];if(null===o.value[t]){if(r=function(e,t,r){for(;t>=0;){let a=e[t];if(null!==a.value[r])return a;t--}return null}(e,n,t),a=function(e,t,r){for(;t<e.length;){let a=e[t];if(null!==a.value[r])return a;t++}return null}(e,n,t),null===r){o.value[t]=a.value[t];continue}if(null===a){o.value[t]=r.value[t];continue}!function(e,t,r,a){if(r.time-t.time==0){e.value[a]=t.value[a];return}e.value[a]=(e.time-t.time)*(r.value[a]-t.value[a])/(r.time-t.time)+t.value[a]}(o,r,a,t)}}}(e,t)}(r,e,t.elements[e]);return r}(p,h);return{name:c.uuid,keyframes:m}}(o,n[s],n[l]),t)}return t}function g(e){return m(el.animations[e],f)}let b=new w.Vector3,y=new w.Vector3,v=new w.Quaternion;function x(e){let t=[],r=e.name,a=e.end-e.start||-1,n=e.animations;for(let e=0,r=n.length;e<r;e++){let r=g(n[e]);for(let e=0,a=r.length;e<a;e++)t.push(r[e])}return new w.AnimationClip(r,a,t)}function k(e){let t={id:e.id},r=el.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){let t,r,a;let n={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},o=e.sources,i=e.vertexWeights,s=i.vcount,l=i.v,d=i.inputs.JOINT.offset,c=i.inputs.WEIGHT.offset,u=e.sources[e.joints.inputs.JOINT],h=e.sources[e.joints.inputs.INV_BIND_MATRIX],p=o[i.inputs.WEIGHT.id].array,m=0;for(t=0,a=s.length;t<a;t++){let e=s[t],a=[];for(r=0;r<e;r++){let e=l[m+d],t=p[l[m+c]];a.push({index:e,weight:t}),m+=2}for(a.sort(f),r=0;r<4;r++){let e=a[r];void 0!==e?(n.indices.array.push(e.index),n.weights.array.push(e.weight)):(n.indices.array.push(0),n.weights.array.push(0))}}for(e.bindShapeMatrix?n.bindMatrix=new(0,w.Matrix4)().fromArray(e.bindShapeMatrix).transpose():n.bindMatrix=new(0,w.Matrix4)().identity(),t=0,a=u.array.length;t<a;t++){let e=u.array[t],r=new(0,w.Matrix4)().fromArray(h.array,t*h.stride).transpose();n.joints.push({name:e,boneInverse:r})}return n;function f(e,t){return t.weight-e.weight}}(e.skin),r.sources.skinIndices=t.skin.indices,r.sources.skinWeights=t.skin.weights),t}function N(e){return void 0!==e.build?e.build:e.init_from}function A(e){let t=el.images[e];return void 0!==t?m(t,N):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function _(e){let t={};for(let r=0,a=e.childNodes.length;r<a;r++){let a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"color":t[a.nodeName]=l(a.textContent);break;case"float":t[a.nodeName]=parseFloat(a.textContent);break;case"texture":t[a.nodeName]={id:a.getAttribute("texture"),extra:E(a)}}}return t}function E(e){let t={technique:{}};for(let r=0,a=e.childNodes.length;r<a;r++){let a=e.childNodes[r];1===a.nodeType&&"extra"===a.nodeName&&function(e,t){for(let r=0,a=e.childNodes.length;r<a;r++){let a=e.childNodes[r];1===a.nodeType&&"technique"===a.nodeName&&function(e,t){for(let r=0,a=e.childNodes.length;r<a;r++){let a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[a.nodeName]=parseFloat(a.textContent);break;case"wrapU":case"wrapV":"TRUE"===a.textContent.toUpperCase()?t.technique[a.nodeName]=1:"FALSE"===a.textContent.toUpperCase()?t.technique[a.nodeName]=0:t.technique[a.nodeName]=parseInt(a.textContent);break;case"bump":t[a.nodeName]=M(a)}}}(a,t)}}(a,t)}return t}function C(e){let t={};for(let r=0,a=e.childNodes.length;r<a;r++){let a=e.childNodes[r];1===a.nodeType&&"technique"===a.nodeName&&(t.technique=function(e){let t={};for(let r=0,a=e.childNodes.length;r<a;r++){let a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"double_sided":t[a.nodeName]=parseInt(a.textContent);break;case"bump":t[a.nodeName]=M(a)}}return t}(a))}return t}function M(e){let t={};for(let r=0,a=e.childNodes.length;r<a;r++){let a=e.childNodes[r];1===a.nodeType&&"texture"===a.nodeName&&(t[a.nodeName]={id:a.getAttribute("texture"),texcoord:a.getAttribute("texcoord"),extra:E(a)})}return t}function S(e){return e}function R(e){var t;let r;let a=(t=e.url,m(el.effects[t],S)),n=a.profile.technique;switch(n.type){case"phong":case"blinn":r=new w.MeshPhongMaterial;break;case"lambert":r=new w.MeshLambertMaterial;break;default:r=new w.MeshBasicMaterial}function o(e,t=null){let r=a.profile.samplers[e.id],n=null;if(void 0!==r?n=A(a.profile.surfaces[r.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),n=A(e.id)),null===n)return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null;{var o;let r,a;let s="tga"===(o=n).slice((o.lastIndexOf(".")-1>>>0)+2).toLowerCase()?i:ea;if(void 0===s)return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",n),null;{let r=s.load(n),a=e.extra;if(void 0!==a&&void 0!==a.technique&&!1===u(a.technique)){let e=a.technique;r.wrapS=e.wrapU?w.RepeatWrapping:w.ClampToEdgeWrapping,r.wrapT=e.wrapV?w.RepeatWrapping:w.ClampToEdgeWrapping,r.offset.set(e.offsetU||0,e.offsetV||0),r.repeat.set(e.repeatU||1,e.repeatV||1)}else r.wrapS=w.RepeatWrapping,r.wrapT=w.RepeatWrapping;return null!==t&&(r.colorSpace=t),r}}}r.name=e.name||"";let s=n.parameters;for(let e in s){let t=s[e];switch(e){case"diffuse":t.color&&r.color.fromArray(t.color),t.texture&&(r.map=o(t.texture,w.SRGBColorSpace));break;case"specular":t.color&&r.specular&&r.specular.fromArray(t.color),t.texture&&(r.specularMap=o(t.texture));break;case"bump":t.texture&&(r.normalMap=o(t.texture));break;case"ambient":t.texture&&(r.lightMap=o(t.texture,w.SRGBColorSpace));break;case"shininess":t.float&&r.shininess&&(r.shininess=t.float);break;case"emission":t.color&&r.emissive&&r.emissive.fromArray(t.color),t.texture&&(r.emissiveMap=o(t.texture,w.SRGBColorSpace))}}r.color.convertSRGBToLinear(),r.specular&&r.specular.convertSRGBToLinear(),r.emissive&&r.emissive.convertSRGBToLinear();let l=s.transparent,d=s.transparency;if(void 0===d&&l&&(d={float:1}),void 0===l&&d&&(l={opaque:"A_ONE",data:{color:[1,1,1,1]}}),l&&d){if(l.data.texture)r.transparent=!0;else{let e=l.data.color;switch(l.opaque){case"A_ONE":r.opacity=e[3]*d.float;break;case"RGB_ZERO":r.opacity=1-e[0]*d.float;break;case"A_ZERO":r.opacity=1-e[3]*d.float;break;case"RGB_ONE":r.opacity=e[0]*d.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',l.opaque)}r.opacity<1&&(r.transparent=!0)}}if(void 0!==n.extra&&void 0!==n.extra.technique){let e=n.extra.technique;for(let t in e){let a=e[t];switch(t){case"double_sided":r.side=1===a?w.DoubleSide:w.FrontSide;break;case"bump":r.normalMap=o(a.texture),r.normalScale=new w.Vector2(1,1)}}}return r}function P(e){let t;switch(e.optics.technique){case"perspective":t=new w.PerspectiveCamera(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":let r=e.optics.parameters.ymag,a=e.optics.parameters.xmag,n=e.optics.parameters.aspect_ratio;a=void 0===a?r*n:a,r=void 0===r?a/n:r,a*=.5,r*=.5,t=new w.OrthographicCamera(-a,a,r,-r,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new w.PerspectiveCamera}return t.name=e.name||"",t}function L(e){let t;switch(e.technique){case"directional":t=new w.DirectionalLight;break;case"point":t=new w.PointLight;break;case"spot":t=new w.SpotLight;break;case"ambient":t=new w.AmbientLight}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function B(e){let t={array:[],stride:3};for(let r=0;r<e.childNodes.length;r++){let a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"float_array":t.array=l(a.textContent);break;case"Name_array":t.array=function(e){if(0===e.length)return[];let t=e.trim().split(/\s+/),r=Array(t.length);for(let e=0,a=t.length;e<a;e++)r[e]=t[e];return r}(a.textContent);break;case"technique_common":let n=s(a,"accessor")[0];void 0!==n&&(t.stride=parseInt(n.getAttribute("stride")))}}return t}function j(e){let t={},r=e.sources,a=e.vertices,n=e.primitives;if(0===n.length)return{};let o=function(e){let t={};for(let r=0;r<e.length;r++){let a=e[r];void 0===t[a.type]&&(t[a.type]=[]),t[a.type].push(a)}return t}(n);for(let e in o){let n=o[e];!function(e){let t=0;for(let r=0,a=e.length;r<a;r++)!0===e[r].hasUV&&t++;t>0&&t<e.length&&(e.uvsNeedsFix=!0)}(n),t[e]=function(e,t,r){let a={},n={array:[],stride:0},o={array:[],stride:0},i={array:[],stride:0},s={array:[],stride:0},l={array:[],stride:0},d={array:[],stride:4},c={array:[],stride:4},u=new w.BufferGeometry,h=[],p=0;for(let a=0;a<e.length;a++){let m=e[a],f=m.inputs,g=0;switch(m.type){case"lines":case"linestrips":g=2*m.count;break;case"triangles":g=3*m.count;break;case"polylist":for(let e=0;e<m.count;e++){let t=m.vcount[e];switch(t){case 3:g+=3;break;case 4:g+=6;break;default:g+=(t-2)*3}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",m.type)}for(let b in u.addGroup(p,g,a),p+=g,m.material&&h.push(m.material),f){let a=f[b];switch(b){case"VERTEX":for(let u in r){let h=r[u];switch(u){case"POSITION":let p=n.array.length;if(F(m,t[h],a.offset,n.array),n.stride=t[h].stride,t.skinWeights&&t.skinIndices&&(F(m,t.skinIndices,a.offset,d.array),F(m,t.skinWeights,a.offset,c.array)),!1===m.hasUV&&!0===e.uvsNeedsFix){let e=(n.array.length-p)/n.stride;for(let t=0;t<e;t++)i.array.push(0,0)}break;case"NORMAL":F(m,t[h],a.offset,o.array),o.stride=t[h].stride;break;case"COLOR":F(m,t[h],a.offset,l.array),l.stride=t[h].stride;break;case"TEXCOORD":F(m,t[h],a.offset,i.array),i.stride=t[h].stride;break;case"TEXCOORD1":F(m,t[h],a.offset,s.array),i.stride=t[h].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',u)}}break;case"NORMAL":F(m,t[a.id],a.offset,o.array),o.stride=t[a.id].stride;break;case"COLOR":F(m,t[a.id],a.offset,l.array,!0),l.stride=t[a.id].stride;break;case"TEXCOORD":F(m,t[a.id],a.offset,i.array),i.stride=t[a.id].stride;break;case"TEXCOORD1":F(m,t[a.id],a.offset,s.array),s.stride=t[a.id].stride}}}return n.array.length>0&&u.setAttribute("position",new w.Float32BufferAttribute(n.array,n.stride)),o.array.length>0&&u.setAttribute("normal",new w.Float32BufferAttribute(o.array,o.stride)),l.array.length>0&&u.setAttribute("color",new w.Float32BufferAttribute(l.array,l.stride)),i.array.length>0&&u.setAttribute("uv",new w.Float32BufferAttribute(i.array,i.stride)),s.array.length>0&&u.setAttribute("uv1",new w.Float32BufferAttribute(s.array,s.stride)),d.array.length>0&&u.setAttribute("skinIndex",new w.Float32BufferAttribute(d.array,d.stride)),c.array.length>0&&u.setAttribute("skinWeight",new w.Float32BufferAttribute(c.array,c.stride)),a.data=u,a.type=e[0].type,a.materialKeys=h,a}(n,r,a)}return t}function F(e,t,r,a,n=!1){let o=e.p,i=e.stride,s=e.vcount;function l(e){let t=o[e+r]*c,i=t+c;for(;t<i;t++)a.push(d[t]);if(n){let e=a.length-c-1;en.setRGB(a[e+0],a[e+1],a[e+2]).convertSRGBToLinear(),a[e+0]=en.r,a[e+1]=en.g,a[e+2]=en.b}}let d=t.array,c=t.stride;if(void 0!==e.vcount){let e=0;for(let t=0,r=s.length;t<r;t++){let r=s[t];if(4===r){let t=e+0*i,r=e+1*i,a=e+2*i,n=e+3*i;l(t),l(r),l(n),l(r),l(a),l(n)}else if(3===r){let t=e+0*i,r=e+1*i,a=e+2*i;l(t),l(r),l(a)}else if(r>4)for(let t=1,a=r-2;t<=a;t++){let r=e+0*i,a=e+i*t,n=e+i*(t+1);l(r),l(a),l(n)}e+=i*r}}else for(let e=0,t=o.length;e<t;e+=i)l(e)}function I(e){return m(el.geometries[e],j)}function G(e){return void 0!==e.build?e.build:e}function H(e){let t={type:e.nodeName},r=l(e.textContent);switch(t.type){case"matrix":t.obj=new w.Matrix4,t.obj.fromArray(r).transpose();break;case"translate":t.obj=new w.Vector3,t.obj.fromArray(r);break;case"rotate":t.obj=new w.Vector3,t.obj.fromArray(r),t.angle=(0,w.MathUtils).degToRad(r[3])}return t}function O(e){return void 0!==e.build?e.build:e}let q=new w.Matrix4,U=new w.Vector3;function V(e){let t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new w.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let r=0;r<e.childNodes.length;r++){let a;let n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"node":t.nodes.push(n.getAttribute("id")),V(n);break;case"instance_camera":t.instanceCameras.push(c(n.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(z(n));break;case"instance_light":t.instanceLights.push(c(n.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(z(n));break;case"instance_node":t.instanceNodes.push(c(n.getAttribute("url")));break;case"matrix":a=l(n.textContent),t.matrix.multiply(q.fromArray(a).transpose()),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"translate":a=l(n.textContent),U.fromArray(a),t.matrix.multiply(q.makeTranslation(U.x,U.y,U.z)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"rotate":a=l(n.textContent);let o=(0,w.MathUtils).degToRad(a[3]);t.matrix.multiply(q.makeRotationAxis(U.fromArray(a),o)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"scale":a=l(n.textContent),t.matrix.scale(U.fromArray(a)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"extra":break;default:console.log(n)}}return K(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):el.nodes[t.id]=t,t}function z(e){let t={id:c(e.getAttribute("url")),materials:{},skeletons:[]};for(let r=0;r<e.childNodes.length;r++){let a=e.childNodes[r];switch(a.nodeName){case"bind_material":let n=a.getElementsByTagName("instance_material");for(let e=0;e<n.length;e++){let r=n[e],a=r.getAttribute("symbol"),o=r.getAttribute("target");t.materials[a]=c(o)}break;case"skeleton":t.skeletons.push(c(a.textContent))}}return t}function D(e,t,r){e.traverse(function(e){if(!0===e.isBone){let a;for(let r=0;r<t.length;r++){let n=t[r];if(n.name===e.name){a=n.boneInverse;break}}void 0===a&&(a=new w.Matrix4),r.push({bone:e,boneInverse:a,processed:!1})}})}function W(e){let t;let r=[],a=e.matrix,n=e.nodes,o=e.type,i=e.instanceCameras,s=e.instanceControllers,l=e.instanceLights,d=e.instanceGeometries,c=e.instanceNodes;for(let e=0,t=n.length;e<t;e++)r.push(X(n[e]));for(let e=0,t=i.length;e<t;e++){let t=function(e){let t=el.cameras[e];return void 0!==t?m(t,P):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}(i[e]);null!==t&&r.push(t.clone())}for(let e=0,t=s.length;e<t;e++){var u;let t=s[e],a=(u=t.id,m(el.controllers[u],k)),n=$(I(a.id),t.materials),o=function(e,t){let r,a,n;let o=[],i=[];for(r=0;r<e.length;r++){let a=e[r];if(K(a))D(X(a),t,o);else if(void 0!==el.visualScenes[a]){let e=el.visualScenes[a].children;for(let r=0;r<e.length;r++){let a=e[r];"JOINT"===a.type&&D(X(a.id),t,o)}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",a)}for(r=0;r<t.length;r++)for(a=0;a<o.length;a++)if((n=o[a]).bone.name===t[r].name){i[r]=n,n.processed=!0;break}for(r=0;r<o.length;r++)!1===(n=o[r]).processed&&(i.push(n),n.processed=!0);let s=[],l=[];for(r=0;r<i.length;r++)n=i[r],s.push(n.bone),l.push(n.boneInverse);return new w.Skeleton(s,l)}(t.skeletons,a.skin.joints);for(let e=0,t=n.length;e<t;e++){let t=n[e];t.isSkinnedMesh&&(t.bind(o,a.skin.bindMatrix),t.normalizeSkinWeights()),r.push(t)}}for(let e=0,t=l.length;e<t;e++){let t=function(e){let t=el.lights[e];return void 0!==t?m(t,L):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}(l[e]);null!==t&&r.push(t.clone())}for(let e=0,t=d.length;e<t;e++){let t=d[e],a=$(I(t.id),t.materials);for(let e=0,t=a.length;e<t;e++)r.push(a[e])}for(let e=0,t=c.length;e<t;e++)r.push(X(c[e]).clone());if(0===n.length&&1===r.length)t=r[0];else{t="JOINT"===o?new w.Bone:new w.Group;for(let e=0;e<r.length;e++)t.add(r[e])}return t.name="JOINT"===o?e.sid:e.name,t.matrix.copy(a),t.matrix.decompose(t.position,t.quaternion,t.scale),t}let J=new w.MeshBasicMaterial({name:w.Loader.DEFAULT_MATERIAL_NAME,color:16711935});function $(e,t){let r=[];for(let a in e){let n;let o=e[a],i=function(e,t){let r=[];for(let a=0,n=e.length;a<n;a++){let n=t[e[a]];void 0===n?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[a]),r.push(J)):r.push(m(el.materials[n],R))}return r}(o.materialKeys,t);if(0===i.length&&("lines"===a||"linestrips"===a?i.push(new w.LineBasicMaterial):i.push(new w.MeshPhongMaterial)),"lines"===a||"linestrips"===a)for(let e=0,t=i.length;e<t;e++){let t=i[e];if(!0===t.isMeshPhongMaterial||!0===t.isMeshLambertMaterial){let r=new w.LineBasicMaterial;r.color.copy(t.color),r.opacity=t.opacity,r.transparent=t.transparent,i[e]=r}}let s=void 0!==o.data.attributes.skinIndex,l=1===i.length?i[0]:i;switch(a){case"lines":n=new w.LineSegments(o.data,l);break;case"linestrips":n=new w.Line(o.data,l);break;case"triangles":case"polylist":n=s?new w.SkinnedMesh(o.data,l):new w.Mesh(o.data,l)}r.push(n)}return r}function K(e){return void 0!==el.nodes[e]}function X(e){return m(el.nodes[e],W)}function Y(e){let t=new w.Group;t.name=e.name;let r=e.children;for(let e=0;e<r.length;e++){let a=r[e];t.add(X(a.id))}return t}function Z(e){return m(el.visualScenes[e],Y)}if(0===e.length)return{scene:new w.Scene};let Q=new DOMParser().parseFromString(e,"application/xml"),ee=s(Q,"COLLADA")[0],et=Q.getElementsByTagName("parsererror")[0];if(void 0!==et){let e=s(et,"div")[0];return console.error("THREE.ColladaLoader: Failed to parse collada file.\n",e?e.textContent:function(e){let t="",r=[e];for(;r.length;){let e=r.shift();e.nodeType===Node.TEXT_NODE?t+=e.textContent:(t+="\n",r.push.apply(r,e.childNodes))}return t.trim()}(et)),null}console.debug("THREE.ColladaLoader: File version",ee.getAttribute("version"));let er=(r=s(ee,"asset")[0],{unit:void 0!==(n=s(r,"unit")[0])&&!0===n.hasAttribute("meter")?parseFloat(n.getAttribute("meter")):1,upAxis:void 0!==(o=s(r,"up_axis")[0])?o.textContent:"Y_UP"}),ea=new w.TextureLoader(this.manager);ea.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),T&&(i=new T(this.manager)).setPath(this.resourcePath||t);let en=new w.Color,eo=[],ei={},es=0,el={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};h(ee,"library_animations","animation",function e(t){let r={sources:{},samplers:{},channels:{}},a=!1;for(let n=0,o=t.childNodes.length;n<o;n++){let o;let i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"source":o=i.getAttribute("id"),r.sources[o]=B(i);break;case"sampler":o=i.getAttribute("id"),r.samplers[o]=function(e){let t={inputs:{}};for(let r=0,a=e.childNodes.length;r<a;r++){let a=e.childNodes[r];if(1===a.nodeType&&"input"===a.nodeName){let e=c(a.getAttribute("source")),r=a.getAttribute("semantic");t.inputs[r]=e}}return t}(i);break;case"channel":o=i.getAttribute("target"),r.channels[o]=function(e){let t={},r=e.getAttribute("target").split("/"),a=r.shift(),n=r.shift(),o=-1!==n.indexOf("("),i=-1!==n.indexOf(".");if(i)n=(r=n.split(".")).shift(),t.member=r.shift();else if(o){let e=n.split("(");n=e.shift();for(let t=0;t<e.length;t++)e[t]=parseInt(e[t].replace(/\)/,""));t.indices=e}return t.id=a,t.sid=n,t.arraySyntax=o,t.memberSyntax=i,t.sampler=c(e.getAttribute("source")),t}(i);break;case"animation":e(i),a=!0;break;default:console.log(i)}}!1===a&&(el.animations[t.getAttribute("id")||(0,w.MathUtils).generateUUID()]=r)}),h(ee,"library_animation_clips","animation_clip",function(e){let t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]};for(let r=0,a=e.childNodes.length;r<a;r++){let a=e.childNodes[r];1===a.nodeType&&"instance_animation"===a.nodeName&&t.animations.push(c(a.getAttribute("url")))}el.clips[e.getAttribute("id")]=t}),h(ee,"library_controllers","controller",function(e){let t={};for(let r=0,a=e.childNodes.length;r<a;r++){let a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"skin":t.id=c(a.getAttribute("source")),t.skin=function(e){let t={sources:{}};for(let r=0,a=e.childNodes.length;r<a;r++){let a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=l(a.textContent);break;case"source":let n=a.getAttribute("id");t.sources[n]=B(a);break;case"joints":t.joints=function(e){let t={inputs:{}};for(let r=0,a=e.childNodes.length;r<a;r++){let a=e.childNodes[r];if(1===a.nodeType&&"input"===a.nodeName){let e=a.getAttribute("semantic"),r=c(a.getAttribute("source"));t.inputs[e]=r}}return t}(a);break;case"vertex_weights":t.vertexWeights=function(e){let t={inputs:{}};for(let r=0,a=e.childNodes.length;r<a;r++){let a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"input":let n=a.getAttribute("semantic"),o=c(a.getAttribute("source")),i=parseInt(a.getAttribute("offset"));t.inputs[n]={id:o,offset:i};break;case"vcount":t.vcount=d(a.textContent);break;case"v":t.v=d(a.textContent)}}return t}(a)}}return t}(a);break;case"morph":t.id=c(a.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}el.controllers[e.getAttribute("id")]=t}),h(ee,"library_images","image",function(e){let t={init_from:s(e,"init_from")[0].textContent};el.images[e.getAttribute("id")]=t}),h(ee,"library_effects","effect",function(e){let t={};for(let r=0,a=e.childNodes.length;r<a;r++){let a=e.childNodes[r];1===a.nodeType&&"profile_COMMON"===a.nodeName&&(t.profile=function(e){let t={surfaces:{},samplers:{}};for(let r=0,a=e.childNodes.length;r<a;r++){let a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"newparam":(function(e,t){let r=e.getAttribute("sid");for(let a=0,n=e.childNodes.length;a<n;a++){let n=e.childNodes[a];if(1===n.nodeType)switch(n.nodeName){case"surface":t.surfaces[r]=function(e){let t={};for(let r=0,a=e.childNodes.length;r<a;r++){let a=e.childNodes[r];1===a.nodeType&&"init_from"===a.nodeName&&(t.init_from=a.textContent)}return t}(n);break;case"sampler2D":t.samplers[r]=function(e){let t={};for(let r=0,a=e.childNodes.length;r<a;r++){let a=e.childNodes[r];1===a.nodeType&&"source"===a.nodeName&&(t.source=a.textContent)}return t}(n)}}})(a,t);break;case"technique":t.technique=function(e){let t={};for(let r=0,a=e.childNodes.length;r<a;r++){let a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=a.nodeName,t.parameters=function(e){let t={};for(let r=0,a=e.childNodes.length;r<a;r++){let a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[a.nodeName]=_(a);break;case"transparent":t[a.nodeName]={opaque:a.hasAttribute("opaque")?a.getAttribute("opaque"):"A_ONE",data:_(a)}}}return t}(a);break;case"extra":t.extra=C(a)}}return t}(a);break;case"extra":t.extra=C(a)}}return t}(a))}el.effects[e.getAttribute("id")]=t}),h(ee,"library_materials","material",function(e){let t={name:e.getAttribute("name")};for(let r=0,a=e.childNodes.length;r<a;r++){let a=e.childNodes[r];1===a.nodeType&&"instance_effect"===a.nodeName&&(t.url=c(a.getAttribute("url")))}el.materials[e.getAttribute("id")]=t}),h(ee,"library_cameras","camera",function(e){let t={name:e.getAttribute("name")};for(let r=0,a=e.childNodes.length;r<a;r++){let a=e.childNodes[r];1===a.nodeType&&"optics"===a.nodeName&&(t.optics=function(e){for(let t=0;t<e.childNodes.length;t++){let r=e.childNodes[t];if("technique_common"===r.nodeName)return function(e){let t={};for(let r=0;r<e.childNodes.length;r++){let a=e.childNodes[r];switch(a.nodeName){case"perspective":case"orthographic":t.technique=a.nodeName,t.parameters=function(e){let t={};for(let r=0;r<e.childNodes.length;r++){let a=e.childNodes[r];switch(a.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[a.nodeName]=parseFloat(a.textContent)}}return t}(a)}}return t}(r)}return{}}(a))}el.cameras[e.getAttribute("id")]=t}),h(ee,"library_lights","light",function(e){let t={};for(let r=0,a=e.childNodes.length;r<a;r++){let a=e.childNodes[r];1===a.nodeType&&"technique_common"===a.nodeName&&(t=function(e){let t={};for(let r=0,a=e.childNodes.length;r<a;r++){let a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=a.nodeName,t.parameters=function(e){let t={};for(let r=0,a=e.childNodes.length;r<a;r++){let a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"color":let n=l(a.textContent);t.color=new(0,w.Color)().fromArray(n).convertSRGBToLinear();break;case"falloff_angle":t.falloffAngle=parseFloat(a.textContent);break;case"quadratic_attenuation":let o=parseFloat(a.textContent);t.distance=o?Math.sqrt(1/o):0}}return t}(a)}}return t}(a))}el.lights[e.getAttribute("id")]=t}),h(ee,"library_geometries","geometry",function(e){let t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},r=s(e,"mesh")[0];if(void 0!==r){for(let e=0;e<r.childNodes.length;e++){let a=r.childNodes[e];if(1!==a.nodeType)continue;let n=a.getAttribute("id");switch(a.nodeName){case"source":t.sources[n]=B(a);break;case"vertices":t.vertices=function(e){let t={};for(let r=0;r<e.childNodes.length;r++){let a=e.childNodes[r];1===a.nodeType&&(t[a.getAttribute("semantic")]=c(a.getAttribute("source")))}return t}(a);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",a.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(function(e){let t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let r=0,a=e.childNodes.length;r<a;r++){let a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"input":let n=c(a.getAttribute("source")),o=a.getAttribute("semantic"),i=parseInt(a.getAttribute("offset")),s=parseInt(a.getAttribute("set")),l=s>0?o+s:o;t.inputs[l]={id:n,offset:i},t.stride=Math.max(t.stride,i+1),"TEXCOORD"===o&&(t.hasUV=!0);break;case"vcount":t.vcount=d(a.textContent);break;case"p":t.p=d(a.textContent)}}return t}(a));break;default:console.log(a)}}el.geometries[e.getAttribute("id")]=t}}),h(ee,"library_nodes","node",V),h(ee,"library_visual_scenes","visual_scene",function(e){let t={name:e.getAttribute("name"),children:[]};!function(e){let t=e.getElementsByTagName("node");for(let e=0;e<t.length;e++){let r=t[e];!1===r.hasAttribute("id")&&r.setAttribute("id","three_default_"+es++)}}(e);let r=s(e,"node");for(let e=0;e<r.length;e++)t.children.push(V(r[e]));el.visualScenes[e.getAttribute("id")]=t}),h(ee,"library_kinematics_models","kinematics_model",function(e){let t={name:e.getAttribute("name")||"",joints:{},links:[]};for(let r=0;r<e.childNodes.length;r++){let a=e.childNodes[r];1===a.nodeType&&"technique_common"===a.nodeName&&function(e,t){for(let r=0;r<e.childNodes.length;r++){let a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"joint":t.joints[a.getAttribute("sid")]=function(e){let t;for(let r=0;r<e.childNodes.length;r++){let a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"prismatic":case"revolute":t=function(e){let t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new w.Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let r=0;r<e.childNodes.length;r++){let a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"axis":let n=l(a.textContent);t.axis.fromArray(n);break;case"limits":let o=a.getElementsByTagName("max")[0],i=a.getElementsByTagName("min")[0];t.limits.max=parseFloat(o.textContent),t.limits.min=parseFloat(i.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}(a)}}return t}(a);break;case"link":t.links.push(function e(t){let r={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",attachments:[],transforms:[]};for(let a=0;a<t.childNodes.length;a++){let n=t.childNodes[a];if(1===n.nodeType)switch(n.nodeName){case"attachment_full":r.attachments.push(function(t){let r={joint:t.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let a=0;a<t.childNodes.length;a++){let n=t.childNodes[a];if(1===n.nodeType)switch(n.nodeName){case"link":r.links.push(e(n));break;case"matrix":case"translate":case"rotate":r.transforms.push(H(n))}}return r}(n));break;case"matrix":case"translate":case"rotate":r.transforms.push(H(n))}}return r}(a))}}}(a,t)}el.kinematicsModels[e.getAttribute("id")]=t}),h(ee,"library_physics_models","physics_model",function(e){let t={name:e.getAttribute("name")||"",rigidBodies:{}};for(let r=0;r<e.childNodes.length;r++){let a=e.childNodes[r];1===a.nodeType&&"rigid_body"===a.nodeName&&(t.rigidBodies[a.getAttribute("name")]={},function(e,t){for(let r=0;r<e.childNodes.length;r++){let a=e.childNodes[r];1===a.nodeType&&"technique_common"===a.nodeName&&function(e,t){for(let r=0;r<e.childNodes.length;r++){let a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"inertia":t.inertia=l(a.textContent);break;case"mass":t.mass=l(a.textContent)[0]}}}(a,t)}}(a,t.rigidBodies[a.getAttribute("name")]))}el.physicsModels[e.getAttribute("id")]=t}),h(ee,"scene","instance_kinematics_scene",function(e){let t={bindJointAxis:[]};for(let r=0;r<e.childNodes.length;r++){let a=e.childNodes[r];1===a.nodeType&&"bind_joint_axis"===a.nodeName&&t.bindJointAxis.push(function(e){let t={target:e.getAttribute("target").split("/").pop()};for(let r=0;r<e.childNodes.length;r++){let a=e.childNodes[r];if(1===a.nodeType&&"axis"===a.nodeName){let e=a.getElementsByTagName("param")[0];t.axis=e.textContent;let r=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=r.substring(0,r.length-1)}}return t}(a))}el.kinematicsScenes[c(e.getAttribute("url"))]=t}),p(el.animations,f),p(el.clips,x),p(el.controllers,k),p(el.images,N),p(el.effects,S),p(el.materials,R),p(el.cameras,P),p(el.lights,L),p(el.geometries,j),p(el.visualScenes,Y),function(){let e=el.clips;if(!0===u(e)){if(!1===u(el.animations)){let e=[];for(let t in el.animations){let r=g(t);for(let t=0,a=r.length;t<a;t++)e.push(r[t])}eo.push(new w.AnimationClip("default",-1,e))}}else for(let t in e)eo.push(m(el.clips[t],x))}(),function(){let e=Object.keys(el.kinematicsModels)[0],t=Object.keys(el.kinematicsScenes)[0],r=Object.keys(el.visualScenes)[0];if(void 0===e||void 0===t)return;let a=m(el.kinematicsModels[e],G),n=m(el.kinematicsScenes[t],O),o=Z(r),i=n.bindJointAxis,s={};for(let e=0,t=i.length;e<t;e++){let t=i[e],r=ee.querySelector('[sid="'+t.target+'"]');if(r){let e=r.parentElement;(function(e,t){let r=t.getAttribute("name"),n=a.joints[e];o.traverse(function(a){a.name===r&&(s[e]={object:a,transforms:function(e){let t=[],r=ee.querySelector('[id="'+e.id+'"]');for(let e=0;e<r.childNodes.length;e++){let a,n;let o=r.childNodes[e];if(1===o.nodeType)switch(o.nodeName){case"matrix":a=l(o.textContent);let i=new(0,w.Matrix4)().fromArray(a).transpose();t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:i});break;case"translate":case"scale":a=l(o.textContent),n=new(0,w.Vector3)().fromArray(a),t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:n});break;case"rotate":a=l(o.textContent),n=new(0,w.Vector3)().fromArray(a);let s=(0,w.MathUtils).degToRad(a[3]);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:n,angle:s})}}return t}(t),joint:n,position:n.zeroPosition})})})(t.jointIndex,e)}}let d=new w.Matrix4;ei={joints:a&&a.joints,getJointValue:function(e){let t=s[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){let r=s[e];if(r){let a=r.joint;if(t>a.limits.max||t<a.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+a.limits.min+", max: "+a.limits.max+").");else if(a.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{let n=r.object,o=a.axis,i=r.transforms;q.identity();for(let r=0;r<i.length;r++){let n=i[r];if(n.sid&&-1!==n.sid.indexOf(e))switch(a.type){case"revolute":q.multiply(d.makeRotationAxis(o,(0,w.MathUtils).degToRad(t)));break;case"prismatic":q.multiply(d.makeTranslation(o.x*t,o.y*t,o.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+a.type)}else switch(n.type){case"matrix":q.multiply(n.obj);break;case"translate":q.multiply(d.makeTranslation(n.obj.x,n.obj.y,n.obj.z));break;case"scale":q.scale(n.obj);break;case"rotate":q.multiply(d.makeRotationAxis(n.obj,n.angle))}}n.matrix.copy(q),n.matrix.decompose(n.position,n.quaternion,n.scale),s[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}();let ed=(a=s(ee,"scene")[0],Z(c(s(a,"instance_visual_scene")[0].getAttribute("url"))));return ed.animations=eo,"Z_UP"===er.upAxis&&(console.warn("THREE.ColladaLoader: You are loading an asset with a Z-UP coordinate system. The loader just rotates the asset to transform it into Y-UP. The vertex data are not converted, see #24289."),ed.rotation.set(-Math.PI/2,0,0)),ed.scale.multiplyScalar(er.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),eo},kinematics:ei,library:el,scene:ed}}}var A=b("cpS3d"),_=b("9hfHi"),E=b("jiuw3"),C=b("7MGRS"),M=b("1EdOY"),S=b("bHiTZ"),R=b("8mHfG"),P=b("5Rd1x"),L=b("cE5k3"),B=b("e2Pv4"),j=b("kqOCM");const F={"Royal Esplanade":"https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/equirectangular/royal_esplanade_1k.hdr","Moonless Golf":"https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/equirectangular/moonless_golf_1k.hdr",Overpass:"https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/equirectangular/pedestrian_overpass_1k.hdr","Venice Sunset":"https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/equirectangular/venice_sunset_1k.hdr","Small Studio":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/studio_small_05_1k.hdr","Pfalzer Forest":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/phalzer_forest_01_1k.hdr","Leadenhall Market":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/leadenhall_market_1k.hdr",Kloppenheim:"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/kloppenheim_05_1k.hdr","Hilly Terrain":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/hilly_terrain_01_1k.hdr","Circus Arena":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/circus_arena_1k.hdr","Chinese Garden":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/chinese_garden_1k.hdr",Autoshop:"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/autoshop_01_1k.hdr","Measuring Lab":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/vintage_measuring_lab_2k.hdr","Whale Skeleton":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/whale_skeleton_2k.hdr","Hall of Mammals":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/hall_of_mammals_2k.hdr","Drachenfels Cellar":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/drachenfels_cellar_2k.hdr","Adams Place Bridge":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/adams_place_bridge_2k.hdr","Sepulchral Chapel Rotunda":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/sepulchral_chapel_rotunda_2k.hdr","Peppermint Powerplant":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/peppermint_powerplant_2k.hdr","Noon Grass":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/noon_grass_2k.hdr","Narrow Moonlit Road":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/narrow_moonlit_road_2k.hdr","St Peters Square Night":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/st_peters_square_night_2k.hdr","Brown Photostudio 01":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/brown_photostudio_01_2k.hdr","Rainforest Trail":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/rainforest_trail_2k.hdr","Brown Photostudio 07":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/brown_photostudio_07_2k.hdr","Brown Photostudio 06":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/brown_photostudio_06_2k.hdr","Dancing Hall":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/dancing_hall_2k.hdr","Aristea Wreck Puresky":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/aristea_wreck_puresky_2k.hdr","Modern Buildings 2":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/modern_buildings_2_2k.hdr","Thatch Chapel":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/thatch_chapel_2k.hdr",Vestibule:"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/vestibule_2k.hdr","Blocky Photo Studio":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/blocky_photo_studio_1k.hdr","Christmas Photo Studio 07":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/christmas_photo_studio_07_2k.hdr","Aerodynamics Workshop":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/aerodynamics_workshop_1k.hdr"},I=window.MODEL_LIST||{},G={multipleImportanceSampling:!0,acesToneMapping:!0,renderScale:1/window.devicePixelRatio,tiles:2,model:"",envMap:F["Aristea Wreck Puresky"],gradientTop:"#bfd8ff",gradientBottom:"#ffffff",environmentIntensity:1,environmentRotation:0,cameraProjection:"Perspective",backgroundType:"Gradient",bgGradientTop:"#111111",bgGradientBottom:"#000000",backgroundBlur:0,transparentBackground:!1,checkerboardTransparency:!0,enable:!0,bounces:5,filterGlossyFactor:.5,pause:!1,floorColor:"#111111",floorOpacity:1,floorRoughness:.2,floorMetalness:.2,...(0,L.getScaledSettings)()};function H(){a.multipleImportanceSampling=G.multipleImportanceSampling,a.bounces=G.bounces,a.filterGlossyFactor=G.filterGlossyFactor,a.renderScale=G.renderScale,e.material.color.set(G.floorColor),e.material.roughness=G.floorRoughness,e.material.metalness=G.floorMetalness,e.material.opacity=G.floorOpacity,d.environmentIntensity=G.environmentIntensity,d.environmentRotation.y=G.environmentRotation,d.backgroundBlurriness=G.backgroundBlur,"Gradient"===G.backgroundType?(u.topColor.set(G.bgGradientTop),u.bottomColor.set(G.bgGradientBottom),u.update(),d.background=u,d.backgroundIntensity=1,d.environmentRotation.y=0):(d.background=d.environment,d.backgroundIntensity=G.environmentIntensity,d.backgroundRotation.y=G.environmentRotation),G.transparentBackground&&(d.background=null,n.setClearAlpha(0)),a.updateMaterials(),a.updateEnvironment()}function O(){let e="";if(window.location.hash){let t=decodeURI(window.location.hash.substring(1));t in I&&(e=t)}e in I||(e=Object.keys(I)[0]),G.model=e,z()}function q(){let e=window.innerWidth,t=window.innerHeight,r=window.devicePixelRatio;n.setSize(e,t),n.setPixelRatio(r);let s=e/t;i.aspect=s,i.updateProjectionMatrix();let l=2/s;o.top=l/2,o.bottom=-(l/2),o.updateProjectionMatrix(),a.updateCamera()}function U(){new(0,x.RGBELoader)().load(G.envMap,e=>{d.environment&&d.environment.dispose(),e.mapping=w.EquirectangularReflectionMapping,d.environment=e,a.updateEnvironment(),H()})}function V(e){s&&(i.position.copy(s.position),o.position.copy(s.position)),s="Perspective"===e?i:o,l.object=s,l.update(),a.setCamera(s)}async function z(){t&&(document.body.classList.remove("checkerboard"),t.destroy(),t=null);let r=I[G.model];n.domElement.style.visibility="hidden",h.setPercentage(0),c&&(c.traverse(e=>{if(e.material){let t=e.material;for(let e in t)t[e]&&t[e].isTexture&&t[e].dispose()}}),d.remove(c),c=null);try{c=await D(r.url,e=>{h.setPercentage(.5*e)})}catch(e){h.setCredits("Failed to load model:"+e.message),h.setPercentage(1)}r.removeEmission&&c.traverse(e=>{e.material&&(e.material.emissiveMap=null,e.material.emissiveIntensity=0)}),r.opacityToTransmission&&function(e,t){e.traverse(e=>{if(e.material){let r=e.material;if(r.opacity<.65&&r.opacity>.2){let a=new w.MeshPhysicalMaterial;for(let e in r)if(e in r){if(null===r[e])continue;r[e].isTexture?a[e]=r[e]:r[e].copy&&r[e].constructor===a[e].constructor?a[e].copy(r[e]):"number"==typeof r[e]&&(a[e]=r[e])}a.opacity=1,a.transmission=1,a.ior=t;let n={};a.color.getHSL(n),n.l=Math.max(n.l,.35),a.color.setHSL(n.h,n.s,n.l),e.material=a}}})}(c,r.ior||1.5),c.traverse(e=>{e.material&&(e.material.thickness=1)}),r.postProcess&&r.postProcess(c),r.rotation&&c.rotation.set(...r.rotation);let o=new w.Box3;o.setFromObject(c),c.position.addScaledVector(o.min,-.5).addScaledVector(o.max,-.5);let i=new w.Sphere;o.getBoundingSphere(i),c.scale.setScalar(1/i.radius),c.position.multiplyScalar(1/i.radius),o.setFromObject(c),e.position.y=o.min.y,d.add(c),await a.setSceneAsync(d,s,{onProgress:e=>h.setPercentage(.5+.5*e)}),h.setPercentage(1),h.setCredits(r.credit||""),G.bounces=r.bounces||5,G.floorColor=r.floorColor||"#111111",G.floorRoughness=r.floorRoughness||.2,G.floorMetalness=r.floorMetalness||.2,G.bgGradientTop=r.gradientTop||"#111111",G.bgGradientBottom=r.gradientBot||"#000000",function(){t&&t.destroy(),(t=new E.GUI).add(G,"model",Object.keys(I).sort()).onChange(e=>{window.location.hash=e});let e=t.addFolder("Path Tracer");e.add(G,"enable"),e.add(G,"pause"),e.add(G,"multipleImportanceSampling").onChange(H),e.add(G,"acesToneMapping").onChange(e=>{n.toneMapping=e?w.ACESFilmicToneMapping:w.NoToneMapping}),e.add(G,"bounces",1,20,1).onChange(H),e.add(G,"filterGlossyFactor",0,1).onChange(H),e.add(G,"renderScale",.1,1,.01).onChange(()=>{H()}),e.add(G,"tiles",1,10,1).onChange(e=>{a.tiles.set(e,e)}),e.add(G,"cameraProjection",["Perspective","Orthographic"]).onChange(e=>{V(e)}),e.open();let r=t.addFolder("environment");r.add(G,"envMap",F).name("map").onChange(U),r.add(G,"environmentIntensity",0,10).onChange(H).name("intensity"),r.add(G,"environmentRotation",0,2*Math.PI).onChange(H),r.open();let o=t.addFolder("background");o.add(G,"backgroundType",["Environment","Gradient"]).onChange(H),o.addColor(G,"bgGradientTop").onChange(H),o.addColor(G,"bgGradientBottom").onChange(H),o.add(G,"backgroundBlur",0,1).onChange(H),o.add(G,"transparentBackground",0,1).onChange(H),o.add(G,"checkerboardTransparency").onChange(e=>{e?document.body.classList.add("checkerboard"):document.body.classList.remove("checkerboard")});let i=t.addFolder("floor");i.addColor(G,"floorColor").onChange(H),i.add(G,"floorRoughness",0,1).onChange(H),i.add(G,"floorMetalness",0,1).onChange(H),i.add(G,"floorOpacity",0,1).onChange(H),i.close()}(),H(),n.domElement.style.visibility="visible",G.checkerboardTransparency&&document.body.classList.add("checkerboard")}async function D(e,t){let r=new w.LoadingManager;if(/dae$/i.test(e)){let a=new Promise(e=>r.onLoad=e),n=await new N(r).loadAsync(e,e=>{0!==e.total&&e.total>=e.loaded&&t(e.loaded/e.total)});return await a,n.scene.scale.setScalar(1),n.scene.traverse(e=>{let{material:t}=e;t&&t.isMeshPhongMaterial&&(e.material=new w.MeshStandardMaterial({color:t.color,roughness:t.roughness||0,metalness:t.metalness||0,map:t.map||null}))}),n.scene}if(/(gltf|glb)$/i.test(e)){let a=new Promise(e=>r.onLoad=e),n=await new(0,k.GLTFLoader)(r).setMeshoptDecoder(v.MeshoptDecoder).loadAsync(e,e=>{0!==e.total&&e.total>=e.loaded&&t(e.loaded/e.total)});return await a,n.scene}if(/mpd$/i.test(e)){r.onProgress=(e,r,a)=>{t(r/a)};let a=new Promise(e=>r.onLoad=e),n=new A.LDrawLoader(r);await n.preloadMaterials("https://raw.githubusercontent.com/gkjohnson/ldraw-parts-library/master/colors/ldcfgalt.ldr");let o=await n.setPartsLibraryPath("https://raw.githubusercontent.com/gkjohnson/ldraw-parts-library/master/complete/ldraw/").loadAsync(e);await a;let i=(0,_.LDrawUtils).mergeObject(o);i.rotation.set(Math.PI,0,0);let s=[];return i.traverse(e=>{e.isLineSegments&&s.push(e),e.isMesh&&(e.material.roughness*=.25)}),s.forEach(e=>{e.parent.remove(e)}),i}}!async function(){(h=new B.LoaderElement).attach(document.body),(n=new w.WebGLRenderer({antialias:!0})).toneMapping=w.ACESFilmicToneMapping,document.body.appendChild(n.domElement),(a=new R.WebGLPathTracer(n)).setBVHWorker(new j.ParallelMeshBVHWorker),a.physicallyCorrectLights=!0,a.tiles.set(G.tiles,G.tiles),a.multipleImportanceSampling=G.multipleImportanceSampling,a.transmissiveBounces=10;let t=window.innerWidth/window.innerHeight;(i=new w.PerspectiveCamera(60,t,.025,500)).position.set(-1,.25,1);let p=2/t;(o=new w.OrthographicCamera(-1,1,p/2,-(p/2),0,100)).position.set(-1,.25,1),(u=new S.GradientEquirectTexture).topColor.set(G.bgGradientTop),u.bottomColor.set(G.bgGradientBottom),u.update(),(l=new P.OrbitControls(i,n.domElement)).addEventListener("change",()=>{a.updateCamera()}),(d=new w.Scene).background=u;let m=(0,M.generateRadialFloorTexture)(2048);(e=new w.Mesh(new w.PlaneGeometry,new w.MeshStandardMaterial({map:m,transparent:!0,color:1118481,roughness:.1,metalness:0,side:w.DoubleSide}))).scale.setScalar(5),e.rotation.x=-Math.PI/2,d.add(e),r=new C.default,document.body.appendChild(r.dom),V(G.cameraProjection),O(),U(),q(),function e(){requestAnimationFrame(e),r.update(),c&&(G.enable?(!G.pause||a.samples<1)&&a.renderSample():n.render(d,s),h.setSamples(a.samples,a.isCompiling))}(),window.addEventListener("resize",q),window.addEventListener("hashchange",O)}();
//# sourceMappingURL=index.7e44f4ab.js.map
